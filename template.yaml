# Trigger based
#  - trigger:
#      - platform: state
#        entity_id: sensor.wirkungsgrad_wechselrichter
#        for: "00:00:05"
#    sensor:
#      - name: Wirkungsgrad Wechselrichter gefiltert
#        state: >-
#          {% if states("sensor.wirkungsgrad_wechselrichter") in ['unavailable', 'unknown', 'none'] %}
#            {{ 0.0 }}
#          {% else %}
#            {{ states("sensor.wirkungsgrad_wechselrichter") }}
#          {% endif %}
#        unit_of_measurement: '%'
  - trigger:
      - platform: state
        entity_id: binary_sensor.storung_heizaktor_eg
        for: "00:01:00"
    binary_sensor:
      - name: storung_heizaktor_eg_notify
        unique_id: 0f538a77-7e39-4bea-8f8d-9dc1b51dd21d
        state: '{{ states("binary_sensor.storung_heizaktor_eg") }}'
        device_class: problem
  - trigger:
      - platform: time_pattern
        minutes: "/2"
    sensor:
      - name: Windgeschwindigkeit Wetterstation kmh
        unique_id: 8d32a615-e6f2-423c-9fb1-987b2c7a72e2
        state: '{{ (states("sensor.windgeschwindigkeit_wetterstation_max") | float(0)) * 3.6 }}'
        unit_of_measurement: 'km/h'
        icon: mdi:weather-windy
#
# State based
  - sensor:
    # Mapping of "raw" sensors to constant names
      - unique_id: el_leistung_heizung_partyraum_vorne
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.0xa4c138be24f3a561_power') }}
        attributes:
          friendly_name: "El. Leistung Heizung Partyraum vorne"
      - unique_id: el_leistung_heizung_partyraum_hinten
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.0xa4c1382185708acf_power') }}
        attributes:
          friendly_name: "El. Leistung Heizung Partyraum hinten"
      - unique_id: el_leistung_luftentfeuchter_partyraum
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_esp_sd_6_2') }}
        attributes:
          friendly_name: "El. Leistung Luftentfeuchter Partyraum"
      - unique_id: el_leistung_luftentfeuchter_waschkueche
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.0x00158d0003891388_power') }}
        attributes:
          friendly_name: "El. Leistung Luftentfeuchter Waschküche"
      - unique_id: el_leistung_hebeanlage
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_shellyplug_s_169d16_power') }}
        attributes:
          friendly_name: "El. Leistung Hebeanlage"
      - unique_id: dummy_nuki_battery
        # name: change entity_id in UI after creation
        unit_of_measurement: "%"
        state: >
          {% if state_attr('lock.haustur','battery_critical') == true %}
            {{ 1 }}
          {% else %}
            {{ 100 }}
          {% endif %}
        attributes:
          friendly_name: "Batterie Nuki-Schloss"
      - unique_id: temp_windchill
        # name: change entity_id in UI after creation
        unit_of_measurement: "°C"
        state: >
          {% set temp = states('sensor.temp_aussen') | float(0) %}
          {% set wind_kmh = (states('sensor.windgeschwindigkeit_wetterstation_mittel') | float(0)) * 3.6 %}
          {% if wind_kmh > 5 %}
            {{ (13.12 + 0.6215*temp + (0.3965*temp - 11.37)*(wind_kmh**0.16)) | round(1) }}
          {% else %}
            {{ temp | round(1) }}
          {% endif %}
        attributes:
          friendly_name: "Temp. Windchill"
      - unique_id: temp_außen_gefuehlt
        # name: change entity_id in UI after creation
        unit_of_measurement: "°C"
        state: >
          {% set temp = states('sensor.temp_aussen') | float(0) %}
          {% set windchill = states('sensor.template_temp_windchill') | float(0) %}
          {% set heat_index = states('sensor.thermal_comfort_aussen_heat_index') | float(0) %}
          {% if temp < 10 %}
            {{ windchill | round(0) }}
          {% elif temp > 15 %}
            {{ heat_index | round(0) }}
          {% else %}
            {% set ratio_windchill = (15 - temp) / 5 %}
            {% set ratio_heat_index = 1 - ratio_windchill %}
            {{ (ratio_windchill * windchill + ratio_heat_index * heat_index) | round(0) }}
          {% endif %}
        attributes:
          friendly_name: "Temp. außen gefühlt"
      - default_entity_id: sensor.date_template
        name: Datum
        unique_id: 896e8abe-8b76-4f62-b116-dbd921d9f711
        state: >
          {{ as_timestamp(now()) | timestamp_custom("%d.%m.%Y", True) }}
      - default_entity_id: sensor.helligkeit_wetterstation_ersatz
        name: Helligkeit Wetterstation Ersatz
        unique_id: db4d4636-c258-4b05-b142-73bd2ef10daf
        unit_of_measurement: 'lx'
        icon_template: mdi:weather-sunny
        state: >
          {{ (states('sensor.el_leistung_pv_ac') | float(0)) * 5 }}
      - default_entity_id: sensor.temp_aussen
        name: Temp. Außen
        unique_id: fa5802f0-7917-41a9-85f3-ae839dfeeca7
        unit_of_measurement: '°C'
        device_class: temperature
        state: >
          {{ states('sensor.aussensensor_zigbee_temperature') }}
      - default_entity_id: sensor.luftfeuchtigkeit_aussen
        name: Luftfeuchtigkeit Außen
        unique_id: e783d11f-cafd-45ff-96dd-4b10a4577043
        unit_of_measurement: '%'
        device_class: humidity
        state: >
          {{ states('sensor.aussensensor_zigbee_humidity') }}
      - default_entity_id: sensor.luftfeuchtigkeit_kuche_aqara
        name: Luftfeuchtigkeit Küche
        unique_id: 5e8336f9-1450-4bcb-9d5a-387bc81cd446
        unit_of_measurement: '%'
        device_class: humidity
        state: >
          {{ (states('sensor.0x00158d00034d1e34_humidity') | float(0)) | round }}
      - default_entity_id: sensor.temp_kuche_aqara
        name: Temp. Küche Aqara
        unique_id: b5b11fef-8dbd-4c2a-bb93-2abb4c97f846
        unit_of_measurement: '°C'
        device_class: temperature
        state: >
          {{ (states('sensor.0x00158d00034d1e34_temperature') | float(0)) | round(1) }}





#      - default_entity_id: sensor.
#        name: 
#        unique_id: 
#        state: >
          

  - binary_sensor:
      - default_entity_id: binary_sensor.blockade_uhrzeitanzeige_glastaster_la
        name: Blockade Uhrzeitanzeige Glastaster La
        unique_id: 88184ba8-def4-4624-91db-468e15ff7521
        state: >
          {{ states('switch.la_schlaft') == "on" and (now().hour < 6 or now().hour > 14) }}
      - default_entity_id: binary_sensor.tag_nacht_wetterstation_ersatz
        name: Tag-Nacht Wetterstation Ersatz
        unique_id: c9a6c035-8b05-4333-9a82-b0fc1c55ddfd
        state: >-
          {% if (state_attr('sun.sun', 'elevation') | float(0)) > -5 %}
            {{ true }}
          {% else %}
            {{ false }}
          {% endif %}
      - default_entity_id: binary_sensor.la_und_le_schlafen
        name: Beide Mädels schlafen
        unique_id: 4c8fc921-7499-4116-b013-3fc6b546ad17
        state: >-
          {% if states('switch.la_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.le_schlaft') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.la_und_le_schlafen') }}
          {% else %}
            {{ is_state('switch.la_schlaft', 'on')
               and is_state('switch.le_schlaft', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.la_oder_le_schlafen
        name: Min. 1 Kind schläft
        unique_id: feb6b27e-624b-4828-ad47-3e7af9b3aa60
        state: >-
          {% if states('switch.la_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.le_schlaft') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.la_oder_le_schlafen') }}
          {% else %}
            {{ is_state('switch.la_schlaft', 'on')
               or is_state('switch.le_schlaft', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.alle_schlafen
        name: Alle schlafen
        unique_id: 701a0a6b-6808-4a98-873e-c26752024b31
        state: >-
          {% if states('switch.la_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.le_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.majo_schlafen') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.alle_schlafen') }}
          {% else %}
            {{ is_state('switch.la_schlaft', 'on')
              and is_state('switch.le_schlaft', 'on')
              and is_state('switch.majo_schlafen', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.jemand_schlaeft
        name: Jemand schläft
        unique_id: 6d779306-ab58-4c22-a9fb-462dc5645c85
        state: >-
          {% if states('switch.la_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.le_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.majo_schlafen') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.jemand_schlaeft') }}
          {% else %}
            {{ is_state('switch.la_schlaft', 'on')
              or is_state('switch.le_schlaft', 'on')
              or is_state('switch.majo_schlafen', 'on') }}
          {% endif %}
      # On = in der letzten Stunde weniger als 10 Minuten wach:
      - default_entity_id: binary_sensor.schlafen_oder_aufwachphase_la
        name: Schlafen oder Aufwachphase La
        unique_id: 2fdfe562-a679-4a6b-a0e0-6f9a5aeb8660
        state: >-
          {{ states('sensor.anteil_la_wach_letzte_stunde')|float(0) < 17 }}
      - default_entity_id: binary_sensor.schlafen_oder_aufwachphase_le
        name: Schlafen oder Aufwachphase Le
        unique_id: a8fac994-0e26-4a3f-a89a-f834257143a3
        state: >-
          {{ states('sensor.anteil_le_wach_letzte_stunde')|float(0) < 17 }}
      - default_entity_id: binary_sensor.schlafen_oder_aufwachphase_kinder
        name: Schlafen oder Aufwachphase Kinder
        unique_id: efaf1dfb-1dcd-43a6-aefa-8168b62b0b07
        state: >-
          {{ states('sensor.anteil_kinder_wach_letzte_stunde')|float(0) < 17 }}
      - default_entity_id: binary_sensor.aufwachphase_kinder
        name: Aufwachphase Kinder
        unique_id: d3801bab-0595-4a22-bb79-b0fd7036ad23
        state: >-
          {{ states('sensor.anteil_kinder_wach_letzte_stunde')|float(0) < 17 and is_state('binary_sensor.la_oder_le_schlafen','off') }}
      - default_entity_id: binary_sensor.schlafen_oder_aufwachphase_majo
        name: Schlafen oder Aufwachphase MaJo
        unique_id: 6a307a2e-0834-4b63-911b-ffcc5619dc4b
        state: >-
          {{ states('sensor.anteil_majo_wach_letzte_stunde')|float(0) < 34 }}
      - default_entity_id: binary_sensor.schlafen_oder_licht_gedimmt_majo
        name: Schlafen oder Licht gedimmt MaJo
        unique_id: 17d7bbaa-c2a0-4063-bbdc-e4277de5a274
        state: >-
          {{ states('sensor.anteil_majo_wach_letzte_stunde')|float(0) < 67 }}
      - default_entity_id: binary_sensor.schlafen_oder_licht_noch_aus_lassen_majo
        name: Schlafen oder Licht noch aus lassen MaJo
        unique_id: c87ac8be-a0a7-4cd5-ab54-f7dd76e88c28
        state: >-
          {{ (states('sensor.anteil_majo_wach_letzte_stunde')|float(0) < 67 and states('sensor.helligkeit_wetterstation')|float(0) > 20000) 
            or states('sensor.anteil_majo_wach_letzte_stunde')|float(0) < 34 }}
      - default_entity_id: binary_sensor.schlafen_oder_licht_bad_eg_noch_abgedunkelt
        name: Schlafen oder Licht Bad EG noch abgedunkelt
        unique_id: ef65ac0a-eb4c-4cf8-b167-85545fc9ad8e
        state: >-
          {{ states('sensor.anteil_majo_wach_letzte_stunde')|float(100) < 50
            and states('sensor.anteil_prasenz_bad_eg_letzte_stunde')|float(100) < 17 }}
      - default_entity_id: binary_sensor.nachtmodus_wc
        name: Nachtmodus WC
        unique_id: bef132a0-84ea-4504-9252-41a17485dd94
        state: >-
          {% if states('switch.majo_schlafen') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.nachtmodus_wc') }}
          {% else %}
            {{ states('sensor.anteil_majo_wach_letzte_stunde')|float(0) < 50 or is_state('switch.majo_schlafen', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.nachtmodus_wohnbereich_licht
        name: Nachtmodus Wohnbereich Licht
        unique_id: c66c91fa-63fa-400a-8ba2-1b3a87619e87
        state: >-
          {% if states('switch.majo_schlafen') in ['unavailable', 'unknown', 'none']
             or states('switch.kinder_schon_wach') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.nachtmodus_wohnbereich_licht') }}
          {% else %}
            {{ is_state('switch.majo_schlafen', 'on') and is_state('switch.kinder_schon_wach', 'off') }}
          {% endif %}
      - default_entity_id: binary_sensor.nachtmodus_wohnbereich_jalousie
        name: Nachtmodus Wohnbereich Jalousie
        unique_id: f6deb67e-7563-4100-a66a-e72145725bec
        state: >-
          {% if states('switch.majo_schlafen') in ['unavailable', 'unknown', 'none']
             or states('switch.kinder_schon_wach') in ['unavailable', 'unknown', 'none']
             or states('switch.la_schlaft') in ['unavailable', 'unknown', 'none']
             or states('switch.le_schlaft') in ['unavailable', 'unknown', 'none'] %}
            {{ this }}
          {% else %}
            {{ is_state('binary_sensor.jemand_schlaeft', 'on') and is_state('switch.kinder_schon_wach', 'off') }}
          {% endif %}
      - default_entity_id: binary_sensor.bodenstrahler_blumenbeet_ist_sichtbar
        name: Bodenstrahler Blumenbeet ist sichtbar
        unique_id: a42cd202-84a0-41a5-ae88-1a721a9971b2
        state: >-
          {{ (state_attr('cover.jalousie_hst','current_position')|float(0) < 40)
            or ((state_attr('cover.jalousie_hst','current_tilt_position')|float(0) > 25) and (state_attr('cover.jalousie_hst','current_tilt_position')|float(0) < 85)) }}
      - default_entity_id: binary_sensor.bodenstrahler_blumenbeet_soll_an_sein
        name: Bodenstrahler Blumenbeet soll an sein
        unique_id: d74797ce-4337-4edf-be7f-3ea8aadd99b4
        state: >-
          {{ (is_state('binary_sensor.bodenstrahler_blumenbeet_ist_sichtbar', 'on') and is_state('binary_sensor.standardzeit_bodenstrahler_blumenbeet', 'on'))
            or (is_state('binary_sensor.bodenstrahler_blumenbeet_ist_sichtbar', 'on') and is_state('input_boolean.gaeste_abends', 'on')) }}
      - default_entity_id: binary_sensor.tv_abends_an
        name: TV abends an
        unique_id: 88f29abd-32b4-43b7-9834-81a99e6e3982
        state: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('binary_sensor.tv_ist_an', 'on') }}
      - default_entity_id: binary_sensor.tv_pizza_abend
        name: TV Pizza Abend
        unique_id: c871cd35-8ed0-4bf9-9b3d-29bb26a0db11
        state: >-
          {{ is_state('binary_sensor.tv_abends_an', 'on')
             and is_state('binary_sensor.backofen_ist_an', 'on') }}
      - default_entity_id: binary_sensor.kein_tv_pizza_abend  # Umkehrung von tv_pizza_abend für Panels Bar, Licht soll dann aus bleiben
        name: kein TV Pizza Abend
        unique_id: b6b41008-616b-4741-b577-ac83b8a749a7
        state: >-
          {{ is_state('binary_sensor.tv_pizza_abend', 'off') }}
      - default_entity_id: binary_sensor.tv_abend_ohne_pizza
        name: TV Abend ohne Pizza
        unique_id: e4460570-af35-4f2d-83c7-4044169c5991
        state: >-
          {{ is_state('binary_sensor.tv_abends_an', 'on')
             and is_state('binary_sensor.backofen_ist_an', 'off') }}
      - default_entity_id: binary_sensor.kodi_abends
        name: Kodi abends
        unique_id: 70ab8d69-09ac-4f2a-bd74-476582f9cad8
        state: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('media_player.kodi_wz', 'playing') }}
      - default_entity_id: binary_sensor.abends_und_min_ein_kind_im_bett
        name: abends und min. 1 Kind im Bett
        unique_id: fee3ffb6-3e61-406a-be08-013167e3cc9a
        state: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('binary_sensor.la_oder_le_schlafen', 'on') }}
      - default_entity_id: binary_sensor.keine_gaeste
        name: keine Gäste
        unique_id: 80d1d7d2-c36e-45ac-bfc0-537a5275b0cc
        state: >-
          {{ is_state('input_boolean.gaeste_abends', 'off')
             and is_state('input_boolean.gaeste_gz', 'off') }}
      - default_entity_id: binary_sensor.gaeste_nur_abends
        name: Gäste nur abends
        unique_id: f779d342-f91f-4f10-9709-ec3378927168
        state: >-
          {{ is_state('input_boolean.gaeste_abends', 'on')
             and is_state('input_boolean.gaeste_gz', 'off') }}
      - default_entity_id: binary_sensor.pm_k_timer_magnetsensor_vorratsraum
        name: PM Timer Magnetsensor Vorratsraum
        unique_id: 0af050cb-b0b6-48d7-825e-a726ee079a35
        delay_off:
          minutes: 15
        state: >-
          {% if states('binary_sensor.0x00158d00045c1583_contact') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.pm_k_timer_magnetsensor_vorratsraum') }}
          {% else %}
            {{ is_state('binary_sensor.0x00158d00045c1583_contact', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.pm_k_timer_magnetsensor_werkelraum
        name: PM Timer Magnetsensor Werkelraum
        unique_id: a231a65b-8ce5-462f-952d-25055a7be5fd
        delay_off:
          hours: 1
        state: >-
          {% if states('binary_sensor.0x00158d00054d1e90_contact') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.0x00158d0001dfffc3_occupancy') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.pm_k_timer_magnetsensor_werkelraum') }}
          {% else %}
            {{ is_state('binary_sensor.0x00158d00054d1e90_contact', 'on') or is_state('binary_sensor.0x00158d0001dfffc3_occupancy','on') }}
          {% endif %}
      - default_entity_id: binary_sensor.pm_k_timer_bewegung_partyraum
        name: PM Timer Bewegung Partyraum
        unique_id: cd2bf956-bc79-46cc-81ef-f860a43aeb50
        delay_off:
          minutes: 30
        state: >-
          {% if states('binary_sensor.0x00158d00044e6936_contact') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.0x00158d00045d2e6f_occupancy') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.0x00158d000451908d_occupancy') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.pm_k_timer_bewegung_partyraum') }}
          {% else %}
            {{ is_state('binary_sensor.0x00158d00044e6936_contact', 'on')
               or is_state('binary_sensor.0x00158d00045d2e6f_occupancy', 'on')
               or is_state('binary_sensor.0x00158d000451908d_occupancy', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.reminder_tuer_partyraum
        name: Reminder Tür Partyraum
        unique_id: 14e2b607-d330-4b0e-b91d-98040c8410c8
        delay_on:
          minutes: 10
        state: >-
          {{ is_state('binary_sensor.0x00158d00044e6936_contact','on') and not
            (is_state('binary_sensor.0x00158d000451908d_occupancy','on') or is_state('binary_sensor.0x00158d00045d2e6f_occupancy','on')) }}
      - default_entity_id: binary_sensor.reminder_tuer_werkelraum
        name: Reminder Tür Werkelraum
        unique_id: 23fdc386-85dd-446d-b37e-be44ca0f2672
        delay_on:
          minutes: 30
        state: >-
          {{ is_state('binary_sensor.0x00158d00054d1e90_contact','on') and is_state('binary_sensor.0x00158d0001dfffc3_occupancy','off') }}
      - default_entity_id: binary_sensor.reminder_tuer_speis
        name: Reminder Tür Speis
        unique_id: 85e81a6f-4d96-42ca-b518-c370f0de9e49
        delay_on:
          minutes: 60
        state: >-
          {{ is_state('binary_sensor.0x00158d00045c1583_contact','on') }}
      - default_entity_id: binary_sensor.anwesenheit_bildschirm
        name: Anwesenheit Bildschirm
        unique_id: ef3db0c5-fcfc-47dc-87eb-47db7288b609
        state: >-
          {% if states('binary_sensor.pm_e_ba') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ez_bar_kuche') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ez_esstisch') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_fl_flur') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_fl_treppe_og') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_fl_windfang') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wf_flur') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wf_garderobe') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_o_fl_treppe') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ku_bar_ez') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ku_kuche') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wc') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wz_couch_links') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wz_couch_rechts') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wz_durchgang') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_ktr_treppe') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_ktr_flur') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.anwesenheit_bildschirm') }}
          {% else %}
            {{ is_state('binary_sensor.pm_e_ba', 'on')
               or is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
               or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
               or is_state('binary_sensor.pm_e_fl_flur', 'on')
               or is_state('binary_sensor.pm_e_fl_treppe_og', 'on')
               or is_state('binary_sensor.pm_e_fl_windfang', 'on')
               or is_state('binary_sensor.pm_e_wf_flur', 'on')
               or is_state('binary_sensor.pm_e_wf_garderobe', 'on')
               or is_state('binary_sensor.pm_o_fl_treppe', 'on')
               or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
               or is_state('binary_sensor.pm_e_ku_kuche', 'on')
               or is_state('binary_sensor.pm_e_wc', 'on')
               or is_state('binary_sensor.pm_e_wz_couch_links', 'on')
               or is_state('binary_sensor.pm_e_wz_couch_rechts', 'on')
               or is_state('binary_sensor.pm_e_wz_durchgang', 'on')
               or is_state('binary_sensor.pm_ktr_treppe', 'on')
               or is_state('binary_sensor.pm_ktr_flur', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.anwesenheit_wohnbereich
        name: Anwesenheit Wohnbereich
        unique_id: 40db0ca1-0232-4329-a0ec-e7e5fd39ab3a
        state: >-
          {% if states('binary_sensor.pm_e_ez_bar_kuche') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ez_esstisch') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ku_bar_ez') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_ku_kuche') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wz_couch_links') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wz_couch_rechts') in ['unavailable', 'unknown', 'none']
             or states('binary_sensor.pm_e_wz_durchgang') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.anwesenheit_wohnbereich') }}
          {% else %}
            {{ is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
               or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
               or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
               or is_state('binary_sensor.pm_e_ku_kuche', 'on')
               or is_state('binary_sensor.pm_e_wz_couch_links', 'on')
               or is_state('binary_sensor.pm_e_wz_couch_rechts', 'on')
               or is_state('binary_sensor.pm_e_wz_durchgang', 'on') }}
          {% endif %}
      - default_entity_id: binary_sensor.anwesenheit_eg
        name: Anwesenheit EG
        unique_id: e321d99e-a656-4385-a077-52e4aad97c3a
        state: >-
          {{ is_state('binary_sensor.pm_e_ba', 'on')
             or is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
             or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
             or is_state('binary_sensor.pm_e_fl_flur', 'on')
             or is_state('binary_sensor.pm_e_fl_treppe_og', 'on')
             or is_state('binary_sensor.pm_e_fl_windfang', 'on')
             or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
             or is_state('binary_sensor.pm_e_ku_kuche', 'on')
             or is_state('binary_sensor.pm_e_sz_bett', 'on')
             or is_state('binary_sensor.pm_e_sz_gang', 'on')
             or is_state('binary_sensor.pm_e_wc', 'on')
             or is_state('binary_sensor.pm_e_wf_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_haustur', 'on')
             or is_state('binary_sensor.pm_e_wz_couch_links', 'on')
             or is_state('binary_sensor.pm_e_wz_couch_rechts', 'on')
             or is_state('binary_sensor.pm_e_wz_durchgang', 'on')
             or is_state('binary_sensor.pm_ktr_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_garderobe', 'on') }}
      - default_entity_id: binary_sensor.anwesenheit_og
        name: Anwesenheit OG
        unique_id: 9517dc68-b9bf-4f0c-a6fd-010f5e98afa2
        state: >-
          {{ is_state('binary_sensor.pm_o_ba', 'on')
             or is_state('binary_sensor.pm_o_fl_flur', 'on')
             or is_state('binary_sensor.pm_o_fl_treppe', 'on')
             or is_state('binary_sensor.pm_o_gz', 'on')
             or is_state('binary_sensor.pm_o_ko_la_raum', 'on')
             or is_state('binary_sensor.pm_o_ko_la_tuer', 'on')
             or is_state('binary_sensor.pm_o_kw_le_raum', 'on')
             or is_state('binary_sensor.pm_o_kw_le_tuer', 'on')
             or is_state('binary_sensor.pm_o_nz', 'on') }}
      - default_entity_id: binary_sensor.anwesenheit_haus
        name: Anwesenheit Haus
        unique_id: 0f1abe1d-9c8e-4510-9c2c-dde217113799
        state: >-
          {{ is_state('binary_sensor.anwesenheit_eg', 'on')
            or is_state('binary_sensor.anwesenheit_og', 'on')
            or is_state('binary_sensor.pm_ktr_treppe', 'on') }}
      - default_entity_id: binary_sensor.heizstab_ist_an
        name: Heizstab an
        unique_id: b273be57-3b71-4404-9c31-092390e8a01e
        state: >-
          {{ states('sensor.el_leistung_wp_heizstab')|float(0) > 11 }}
      - default_entity_id: binary_sensor.tv_ist_an
        name: TV an
        unique_id: c8959c37-fd81-4e28-8c24-0f67ce2e3a90
        delay_off:
          seconds: 6
        state: >-
          {% if states('sensor.el_leistung_tv_scheinleistung') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.tv_ist_an') }}
          {% else %}
            {{ states('sensor.el_leistung_tv_scheinleistung')|float(0) > 31 }}
          {% endif %}
      - default_entity_id: binary_sensor.mixi_ist_an
        name: Mixi an
        unique_id: dc1898a4-5b3c-4d96-a2fa-52db3cc40e0a
        state: >-
          {{ states('sensor.el_leistung_mixi')|float(0) > 5 }}
      - default_entity_id: binary_sensor.backofen_ist_an
        name: Backofen an
        unique_id: 6e16acf7-3038-43e0-a124-eb4b13d03181
        state: >-
          {% if states('sensor.el_leistung_backofen') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.backofen_ist_an') }}
          {% else %}
            {{ states('sensor.el_leistung_backofen')|float(0) > 2 }}
          {% endif %}
      - default_entity_id: binary_sensor.waschmaschine_ist_an
        name: Waschmaschine läuft
        unique_id: 5ce285d6-a896-4347-b300-47bb866b194c
        delay_on:
          minutes: 1
        state: >-
          {% if states('sensor.el_leistung_waschmaschine_scheinleistung') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.waschmaschine_ist_an') }}
          {% else %}
            {{ states('sensor.el_leistung_waschmaschine_scheinleistung')|float(0) > 12.5 }}
          {% endif %}
      - default_entity_id: binary_sensor.trockner_zieht_strom
        name: Trockner zieht Strom
        unique_id: 14b51500-e385-45dd-8b7e-066182139e62
        delay_on:
          seconds: 10
        delay_off:
          minutes: 4
        state: >-
          {% if states('sensor.el_leistung_trockner_scheinleistung') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.trockner_zieht_strom') }}
          {% else %}
            {{ states('sensor.el_leistung_trockner_scheinleistung')|float(7) > 10 }}
          {% endif %}
      - default_entity_id: binary_sensor.trockner_ist_an
        name: Trockner läuft
        unique_id: bfdb2813-b99e-430d-90dd-7db60ac09316
        delay_off:
          seconds: 10
        state: >-
          {{ is_state('binary_sensor.trockner_zieht_strom', 'on')
             and not is_state('binary_sensor.trockner_ist_geleert', 'on') }}
      - default_entity_id: binary_sensor.trockner_ist_geleert
        name: Trockner geleert
        unique_id: f1aef501-fe6d-4bb3-b3ec-60bcd87bcd09
        state: >-
          {% if states('sensor.el_leistung_trockner_scheinleistung') in ['unavailable', 'unknown', 'none'] %}
            {{ states('binary_sensor.trockner_ist_geleert') }}
          {% else %}
            {{ states('sensor.el_leistung_trockner_scheinleistung')|float(7) < 5 }}
          {% endif %}
      - default_entity_id: binary_sensor.zeige_eisschutz_jalousien
        name: Zeige Eisschutz Jalousien
        unique_id: ed90bf0f-6489-40b9-9927-137f4fcdf244
        state: >-
          {{ now().month in [11, 12, 1, 2, 3, 4] }}





#      - default_entity_id: binary_sensor.
#        name: 
#        unique_id: 
#        state: >-

