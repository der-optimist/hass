# Trigger based
  - trigger:
      - platform: state
        entity_id: sensor.wirkungsgrad_wechselrichter
        for: "00:00:05"
    sensor:
      - name: Wirkungsgrad Wechselrichter gefiltert
        state: '{{ states("sensor.wirkungsgrad_wechselrichter") }}'
        unit_of_measurement: '%'
  - trigger:
      - platform: state
        entity_id: binary_sensor.storung_heizaktor_eg
        for: "00:01:00"
    binary_sensor:
      - name: storung_heizaktor_eg_notify
        state: '{{ states("binary_sensor.storung_heizaktor_eg") }}'
        device_class: problem
#
# State based
  - sensor:
    # Mapping of "raw" sensors to constant names
      - unique_id: el_leistung_heizung_partyraum_vorne
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_esp_sd_4') }}
        attributes:
          friendly_name: "El. Leistung Heizung Partyraum vorne"
      - unique_id: el_leistung_heizung_partyraum_hinten
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_esp_sd_5') }}
        attributes:
          friendly_name: "El. Leistung Heizung Partyraum hinten"
      - unique_id: el_leistung_luftentfeuchter_partyraum
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_esp_sd_6') }}
        attributes:
          friendly_name: "El. Leistung Luftentfeuchter Partyraum"
      - unique_id: el_leistung_luftentfeuchter_waschkueche
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_innr_sp_120_luftentfeuchter_waschkuche') }}
        attributes:
          friendly_name: "El. Leistung Luftentfeuchter Waschküche"
      - unique_id: el_leistung_hebeanlage
        # name: change entity_id in UI after creation
        unit_of_measurement: "W"
        state: >
          {{ states('sensor.el_leistung_shellyplug_s_169d16_power') }}
        attributes:
          friendly_name: "El. Leistung Hebeanlage"
    # Garbage
      - unique_id: abfall_naechste_restmuelltonne_template
        # name: change entity_id in UI after creation
        state: >
          {% set day_dt = as_datetime(state_attr('calendar.restmuelltonne','end_time')) %}
          {% set day_ts = as_timestamp(day_dt) %}
          {% set today_ts = as_timestamp(today_at("00:00")) %}
          {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
          {% set day = {"Mon":"Mo", "Tue":"Di", "Wed":"Mi", "Thu":"Do", "Fri":"Fr", "Sat":"Sa", "Sun":"So"} %}
          {% if daysTo == 0 %}
            heute
          {% elif daysTo == 1 %}
            morgen
          {% else %}
            {{day[day_dt.strftime("%a")]}}. {{day_dt.strftime("%d.%m.")}} ({{daysTo}} T.)
          {% endif %}
        attributes:
          friendly_name: "Restmüll"
          entity_picture: "/local/icons/garbage/tonne_grau.svg"
          daysTo: >
            {% set day_dt = as_datetime(state_attr('calendar.restmuelltonne','end_time')) %}
            {% set day_ts = as_timestamp(day_dt) %}
            {% set today_ts = as_timestamp(today_at("00:00")) %}
            {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
            {{daysTo}}
      - unique_id: abfall_naechste_biotonne_template
        # name: change entity_id in UI after creation
        state: >
          {% set day_dt = as_datetime(state_attr('calendar.biotonne','end_time')) %}
          {% set day_ts = as_timestamp(day_dt) %}
          {% set today_ts = as_timestamp(today_at("00:00")) %}
          {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
          {% set day = {"Mon":"Mo", "Tue":"Di", "Wed":"Mi", "Thu":"Do", "Fri":"Fr", "Sat":"Sa", "Sun":"So"} %}
          {% if daysTo == 0 %}
            heute
          {% elif daysTo == 1 %}
            morgen
          {% else %}
            {{day[day_dt.strftime("%a")]}}. {{day_dt.strftime("%d.%m.")}} ({{daysTo}} T.)
          {% endif %}
        attributes:
          friendly_name: "Biotonne"
          entity_picture: "/local/icons/garbage/tonne_braun.svg"
          daysTo: >
            {% set day_dt = as_datetime(state_attr('calendar.biotonne','end_time')) %}
            {% set day_ts = as_timestamp(day_dt) %}
            {% set today_ts = as_timestamp(today_at("00:00")) %}
            {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
            {{daysTo}}
      - unique_id: abfall_naechste_papiertonne_template
        # name: change entity_id in UI after creation
        state: >
          {% set day_dt = as_datetime(state_attr('calendar.papiertonne','end_time')) %}
          {% set day_ts = as_timestamp(day_dt) %}
          {% set today_ts = as_timestamp(today_at("00:00")) %}
          {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
          {% set day = {"Mon":"Mo", "Tue":"Di", "Wed":"Mi", "Thu":"Do", "Fri":"Fr", "Sat":"Sa", "Sun":"So"} %}
          {% if daysTo == 0 %}
            heute
          {% elif daysTo == 1 %}
            morgen
          {% else %}
            {{day[day_dt.strftime("%a")]}}. {{day_dt.strftime("%d.%m.")}} ({{daysTo}} T.)
          {% endif %}
        attributes:
          friendly_name: "Papiertonne"
          entity_picture: "/local/icons/garbage/tonne_blau.svg"
          daysTo: >
            {% set day_dt = as_datetime(state_attr('calendar.papiertonne','end_time')) %}
            {% set day_ts = as_timestamp(day_dt) %}
            {% set today_ts = as_timestamp(today_at("00:00")) %}
            {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
            {{daysTo}}
      - unique_id: abfall_naechste_gelbe_tonne_template
        # name: change entity_id in UI after creation
        state: >
          {% set day_dt = as_datetime(state_attr('calendar.gelbe_tonne','end_time')) %}
          {% set day_ts = as_timestamp(day_dt) %}
          {% set today_ts = as_timestamp(today_at("00:00")) %}
          {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
          {% set day = {"Mon":"Mo", "Tue":"Di", "Wed":"Mi", "Thu":"Do", "Fri":"Fr", "Sat":"Sa", "Sun":"So"} %}
          {% if daysTo == 0 %}
            heute
          {% elif daysTo == 1 %}
            morgen
          {% else %}
            {{day[day_dt.strftime("%a")]}}. {{day_dt.strftime("%d.%m.")}} ({{daysTo}} T.)
          {% endif %}
        attributes:
          friendly_name: "Gelbe Tonne"
          entity_picture: "/local/icons/garbage/tonne_gelb.svg"
          daysTo: >
            {% set day_dt = as_datetime(state_attr('calendar.gelbe_tonne','end_time')) %}
            {% set day_ts = as_timestamp(day_dt) %}
            {% set today_ts = as_timestamp(today_at("00:00")) %}
            {% set daysTo = ((day_ts - today_ts) / (3600*24)) | round(0, "floor", 100) %}
            {{daysTo}}