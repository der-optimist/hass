###############################################
#####    KNX rel. dimming Stehlampe WZ    #####
###############################################
- alias: KNX relative dimming Stehlampe WZ
  id: 'knx_relative_dimming_stehlampe_wz'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e27_color_stehlampe_wz_level_light_color_on_off
      switch_address: '1/6/80'
      dimm_address: '1/6/82'
      dimm_time: 5
      dimm_steps: 10
#
###############################################
#####   KNX rel. dimming Stehlampe Lea    #####
###############################################
- alias: KNX relative dimming Stehlampe Lea
  id: 'knx_relative_dimming_stehlampe_lea'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e14_tw_stehlampe_lea_level_light_color_on_off
      switch_address: '1/6/0'
      dimm_address: '1/6/2'
      dimm_time: 5
      dimm_steps: 10
#
###############################################
#####   KNX rel. dimming Stehlampe Lara   #####
###############################################
- alias: KNX relative dimming Stehlampe Lara
  id: 'knx_relative_dimming_stehlampe_lara'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e14_ww_stehlampe_lara_level_on_off
      switch_address: '1/5/200'
      dimm_address: '1/5/202'
      dimm_time: 5
      dimm_steps: 10
#
###############################################
#####    KNX relative dimming Panel AZ    #####
###############################################
- alias: KNX relative dimming Panel Arbeitszimmer
  id: 'knx_relative_dimming_panel_arbeitszimmer'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.ikea_panel_arbeitszimmer_esphome
      switch_address: '1/6/120'
      dimm_address: '1/6/122'
      dimm_time: 5
      dimm_steps: 10
#
###############################################
#####    KNX relative dimming Decke GZ    #####
###############################################
- alias: KNX relative dimming Decke GZ
  id: 'knx_relative_dimming_decke_gz'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e14_ww_decke_gastezimmer_level_on_off
      switch_address: '1/6/40'
      dimm_address: '1/6/42'
      dimm_time: 5
      dimm_steps: 10
#
###############################################
#####           Play on Kodi WZ           #####
###############################################
- id: '1639043665489'
  alias: Play on Kodi WZ
  description: ''
  trigger:
    - platform: event
      event_type: play_on_kodi_wz
      id: play_on_kodi_wz
  condition: []
  action:
    - service: media_player.turn_on
      target:
        entity_id: media_player.samsung_7_series_55
    - service: media_player.play_media
      data:
        media_content_id: '{{ trigger.event.data.filepath }}'
        media_content_type: file
      target:
        entity_id: media_player.kodi_wz_2
    - service: media_player.volume_set
      target:
        entity_id: media_player.beam
      data:
        volume_level: 0.2
  mode: restart
#
###############################################
#####         ZigBee Taster Lara          #####
###############################################
- id: '1640156192211'
  alias: ZigBee Taster Lara
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:06:72:6e:97
  trigger:
    - platform: event
      event_type: zha_event
      id: zha_event_single
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: single
    - platform: event
      event_type: zha_event
      id: zha_event_double
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: double
  condition: []
  action:
    - service: switch.toggle
      target:
        entity_id: switch.la_schlaft
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
  mode: single
#
###############################################
#####         ZigBee Taster Lea           #####
###############################################
- id: '1640156192212'
  alias: ZigBee Taster Lea
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:06:6f:9b:9d
  trigger:
    - platform: event
      event_type: zha_event
      id: zha_event_single
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: single
    - platform: event
      event_type: zha_event
      id: zha_event_double
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: double
  condition: []
  action:
    - service: switch.toggle
      target:
        entity_id: switch.le_schlaft
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
  mode: single
#
###############################################
#####         ZigBee Taster Gäste         #####
###############################################
- id: '1640156192213'
  alias: ZigBee Taster Gäste
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:02:5f:22:62
  trigger:
    - platform: event
      event_type: zha_event
      id: zha_event_single
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: single
    - platform: event
      event_type: zha_event
      id: zha_event_double
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: double
  condition: []
  action:
  #  - service: light.turn_on
  #    target:
  #      entity_id: light.panels_schlafzimmer
  #    data:
  #      brightness_pct: 15
    - service: switch.toggle
      target:
        entity_id: switch.gaste_schlafen
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
  mode: single
#
###############################################
#####              Cube WC                #####
###############################################
- id: '08f25ae6-5ade-46ae-b571-7596cc14c01a'
  alias: Cube WC
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:02:7d:45:07
  trigger:
    - platform: event
      event_type: zha_event
      id: shake
      event_data:
        device_ieee: "{{ device_ieee }}"
        command: shake
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: shake
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: light.spiegel_wc
              state: 'on'
            sequence:
            - service: light.turn_on
              target:
                entity_id: light.panels_wc
              data:
                brightness_pct: 5
            - service: light.turn_off
              target:
                entity_id: light.spiegel_wc
          - conditions:
            - condition: state
              entity_id: light.spiegel_wc
              state: 'off'
            sequence:
            - service: light.turn_on
              target:
                entity_id: light.panels_wc
              data:
                brightness_pct: 70
            - service: light.turn_on
              target:
                entity_id: light.spiegel_wc
          default: []
      default: []
  mode: single
#
###############################################
#####  Erinnerung Heizung Partyr. vorne   #####
###############################################
- id: '3f8caab8-7874-4d85-a0a6-13a83dd0fcc0'
  alias: Erinnerung Heizung Partyraum vorne lange an
  description: ''
  trigger:
    - platform: numeric_state
      entity_id: sensor.el_leistung_heizung_partyraum_vorne
      above: 100
      for:
        hours: 4
        minutes: 0
        seconds: 0
  condition: []
  action:
    - repeat:
        while:
          - condition: numeric_state
            entity_id: sensor.el_leistung_heizung_partyraum_vorne
            above: 100
        sequence:
          - service: notify.telegram_jo
            data:
              message: Heizung Partyraum vorne ist noch an
          - delay:
              hours: 2
              minutes: 0
              seconds: 0
              milliseconds: 0
  mode: single
#
###############################################
#####  Erinnerung Heizung Partyr. hinten  #####
###############################################
- id: 'e1fa2ab4-17ee-476d-9cde-02c450ad93b9'
  alias: Erinnerung Heizung Partyraum hinten lange an
  description: ''
  trigger:
    - platform: numeric_state
      entity_id: sensor.el_leistung_heizung_partyraum_hinten
      above: 100
      for:
        hours: 4
        minutes: 0
        seconds: 0
  condition: []
  action:
    - repeat:
        while:
          - condition: numeric_state
            entity_id: sensor.el_leistung_heizung_partyraum_hinten
            above: 100
        sequence:
          - service: notify.telegram_jo
            data:
              message: Heizung Partyraum hinten ist noch an
          - delay:
              hours: 2
              minutes: 0
              seconds: 0
              milliseconds: 0
  mode: single
#
###############################################
#####  Erinnerung Batterie Hochzeitsbild  #####
###############################################
- id: '8fc7df48-115a-44a8-ab48-8f8a514563f1'
  alias: Erinnerung Batterie Hochzeitsbild
  description: ''
  trigger:
    - platform: template
      value_template: "{% if states.sensor.esp_wemos_d1_2_wlan_signal.last_updated is defined %}{{ ((as_timestamp(now()) - as_timestamp(states.sensor.esp_wemos_d1_2_wlan_signal.last_updated)) / 3600) > 12 }}{% else %}{{ false }}{% endif %}"
  condition: []
  action:
    - repeat:
        while:
          - condition: template
            value_template: "{% if states.sensor.esp_wemos_d1_2_wlan_signal.last_updated is defined %}{{ ((as_timestamp(now()) - as_timestamp(states.sensor.esp_wemos_d1_2_wlan_signal.last_updated)) / 3600) > 12 }}{% else %}{{ false }}{% endif %}"
        sequence:
          - service: notify.telegram_jo
            data:
              message: Batterie Hochzeitsbild ist leer
          - delay:
              hours: 8
              minutes: 0
              seconds: 0
              milliseconds: 0
  mode: single
#
###############################################
#####             KNX Scenes              #####
###############################################
- id: 'f59f075d-d8f6-4b8e-b8e8-23c39b261b5c'
  alias: KNX Scenes
  description: ''
  mode: queued
  trigger:
    - platform: event
      event_type: knx_event
      event_data:
        destination: 15/0/50
  condition: []
  action:
    - choose:
      - conditions:
        - condition: template
          value_template: '{{ trigger.event.data.data[0] == 0 }}'
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lara geht ins Bett
        - service: light.turn_on
          target:
            entity_id: light.innr_e14_ww_stehlampe_lara_level_on_off
          data:
            brightness_pct: 100
      - conditions:
        - condition: template
          value_template: '{{ trigger.event.data.data[0] == 1 }}'
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lea geht ins Bett
        - service: light.turn_on
          target:
            entity_id: light.innr_e14_tw_stehlampe_lea_level_light_color_on_off
          data:
            brightness_pct: 100
      - conditions:
        - condition: template
          value_template: '{{ trigger.event.data.data[0] == 4 }}'
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lara steht auf
        - service: switch.turn_off
          target:
            entity_id: switch.la_schlaft
      - conditions:
        - condition: template
          value_template: '{{ trigger.event.data.data[0] == 5 }}'
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lea steht auf
        - service: switch.turn_off
          target:
            entity_id: switch.le_schlaft
      - conditions:
        - condition: template
          value_template: '{{ trigger.event.data.data[0] == 21 }}'
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lüftung Stoß
        - service: modbus.write_register
          data:
            address: 1103
            unit: 1
            value: 30
            hub: lueftungsanlage
        - delay: 1
        - service: modbus.write_register
          data:
            address: 1161
            unit: 1
            value: 4
            hub: lueftungsanlage
      - conditions:
        - condition: template
          value_template: '{{ trigger.event.data.data[0] == 22 }}'
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lüftung Auto
        - service: modbus.write_register
          data:
            address: 1161
            unit: 1
            value: 1
            hub: lueftungsanlage
      default: []
#
###############################################
#####         Nachtmodus Bad OG           #####
###############################################
- id: '9dfe5e71-06f3-44f6-944a-c9702203e72b'
  alias: Nachtmodus Bad OG
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: binary_sensor.la_oder_le_schlafen
      id: to_on
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.la_oder_le_schlafen
      id: to_off
      from: "on"
      to: "off"
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: to_off
        sequence:
        - service: switch.turn_off
          target:
            entity_id: switch.bad_og_nachtmodus
      - conditions:
        - condition: trigger
          id: to_on
        sequence:
        - service: switch.turn_on
          target:
            entity_id: switch.bad_og_nachtmodus
      default: []
#
###############################################
#####      Lüftung hoch wenn Gäste        #####
###############################################
- id: '0a4738a0-494a-49f7-90e2-1a9d89c87149'
  alias: Lüftung hoch wenn Gäste
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: input_boolean.gaeste_abends
      id: to_on
      from: "off"
      to: "on"
    - platform: state
      entity_id: input_boolean.gaeste_abends
      id: to_off
      from: "on"
      to: "off"
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: to_on
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lüftung Party
        - service: modbus.write_register
          data:
            address: 1104
            unit: 1
            value: 8
            hub: lueftungsanlage
        - delay: 1
        - service: modbus.write_register
          data:
            address: 1161
            unit: 1
            value: 3
            hub: lueftungsanlage
      - conditions:
        - condition: trigger
          id: to_off
        sequence:
        - service: notify.telegram_jo
          data:
            message: KNX Szene - Lüftung Auto
        - service: modbus.write_register
          data:
            address: 1161
            unit: 1
            value: 1
            hub: lueftungsanlage
      default: []
#
###############################################
#####          Bewegungsalarm             #####
###############################################
- id: 'fd83d1a0-de60-4abf-9efa-87a1ed31f6f0'
  alias: Bewegungsalarm
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: binary_sensor.pm_o_ko_la_tuer
      id: la_tuer
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_o_kw_le_tuer
      id: le_tuer
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_o_fl_flur
      id: flur_og
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_o_fl_treppe
      id: treppe_oben
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_e_fl_treppe_og
      id: treppe_unten
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_e_fl_flur
      id: flur_eg
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_e_wf_garderobe
      id: garderobe
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_e_wf_haustur
      id: haustuer
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_e_sz_gang
      id: sz_gang
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.pm_ktr_treppe
      id: kellertreppe
      from: "off"
      to: "on"
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: la_tuer
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Tür Lara
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Tür Lara
          default: []
      - conditions:
        - condition: trigger
          id: le_tuer
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Tür Lea
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Tür Lea
          default: []
      - conditions:
        - condition: trigger
          id: flur_og
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Flur OG
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Flur OG
          default: []
      - conditions:
        - condition: trigger
          id: treppe_oben
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Treppe oben
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Treppe oben
          default: []
      - conditions:
        - condition: trigger
          id: treppe_unten
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Treppe unten
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Treppe unten
          default: []
      - conditions:
        - condition: trigger
          id: flur_eg
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Flur EG
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Flur EG
          default: []
      - conditions:
        - condition: trigger
          id: garderobe
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Garderobe
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Garderobe
          default: []
      - conditions:
        - condition: trigger
          id: haustuer
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Haustür
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Haustür
          default: []
      - conditions:
        - condition: trigger
          id: sz_gang
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Schlafzimmer Gang
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Schlafzimmer Gang
          default: []
      - conditions:
        - condition: trigger
          id: kellertreppe
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_jo
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: Bewegung! => Kellertreppe
        - choose:
          - conditions:
            - condition: state
              entity_id: input_boolean.flur_alarm_ma
              state: 'on'
            sequence:
            - service: notify.telegram_ma
              data:
                message: Bewegung! => Kellertreppe
          default: []
      default: []
#
###############################################
#####           Waschmaschine             #####
###############################################
- id: '72050f03-17bc-40d6-b20b-ef7836d5a830'
  alias: Waschmaschine
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: binary_sensor.waschmaschine_ist_an
      id: wm_ended
      from: "on"
      to: "off"
    - platform: state
      entity_id: binary_sensor.waschmaschine_ist_an
      id: wm_run
      to: "on"
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.wm_door_delay
      id: wm_door_delay_finished
    - platform: state
      entity_id: binary_sensor.lumi_lumi_sensor_magnet_aq2_on_off
      id: wm_opened
      to: "on"
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.wm_reminder
      id: wm_reminder
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: wm_ended
        sequence:
        - service: timer.start
          target:
            entity_id: timer.wm_door_delay
          data:
            duration: '00:03:00'
      - conditions:
        - condition: trigger
          id: wm_door_delay_finished
        sequence:
        - service: timer.start
          target:
            entity_id: timer.wm_reminder
          data:
            duration: '01:00:00'
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.reminder_wm
      - conditions:
        - condition: trigger
          id: wm_reminder
        sequence:
        - service: notify.telegram_ma
          data:
            message: 'Waschmaschine ist seit einer Stunde fertig'
        - service: notify.telegram_jo
          data:
            message: 'Waschmaschine ist seit einer Stunde fertig'
      - conditions:
        - condition: trigger
          id: wm_opened
        sequence:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.reminder_wm
        - service: timer.cancel
          target:
            entity_id: timer.wm_reminder
        - service: timer.cancel
          target:
            entity_id: timer.wm_door_delay
      - conditions:
        - condition: trigger
          id: wm_run
        sequence:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.reminder_wm
        - service: timer.cancel
          target:
            entity_id: timer.wm_reminder
        - service: timer.cancel
          target:
            entity_id: timer.wm_door_delay
      default: []
#
###############################################
#####             Trockner               #####
###############################################
- id: 'f9bf2e02-9e91-4e02-8fbf-55048f9a1343'
  alias: Trockner
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: binary_sensor.trockner_ist_an
      id: dryer_ended
      from: "on"
      to: "off"
    - platform: state
      entity_id: binary_sensor.trockner_ist_geleert
      id: dryer_opened
      to: "on"
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.dryer_reminder
      id: dryer_reminder
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: dryer_ended
        - condition: state
          entity_id: binary_sensor.trockner_ist_geleert
          state: 'off'
        sequence:
        - service: timer.start
          target:
            entity_id: timer.dryer_reminder
          data:
            duration: '02:00:00'
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.reminder_dryer
      - conditions:
        - condition: trigger
          id: dryer_reminder
        sequence:
        - service: notify.telegram_ma
          data:
            message: 'Trockner ist seit 2 Stunden fertig'
        - service: notify.telegram_jo
          data:
            message: 'Trockner ist seit 2 Stunden fertig'
      - conditions:
        - condition: trigger
          id: dryer_opened
        sequence:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.reminder_dryer
        - service: timer.cancel
          target:
            entity_id: timer.dryer_reminder
      default: []
#
###############################################
#####   Wasserventil wöchentlich bewegen  #####
###############################################
- id: '584a5dce-458c-48db-afb9-65ac55606847'
  alias: Wasserventil wöchentlich bewegen
  description: ''
  mode: queued
  trigger:
    - platform: time
      at: "03:38:02"
      id: time_daily
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.water_valve_weekly
      id: timer_finished
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: time_daily
        - condition: time
          weekday:
            - wed
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: binary_sensor.pm_e_ba
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: 'Wasserventil konnte nicht bewegt werden, da noch jemand im Bad EG unterwegs war'
          - conditions:
            - condition: state
              entity_id: binary_sensor.pm_e_wc
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: 'Wasserventil konnte nicht bewegt werden, da noch jemand im WC unterwegs war'
          - conditions:
            - condition: state
              entity_id: binary_sensor.pm_e_ku_kuche
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: 'Wasserventil konnte nicht bewegt werden, da noch jemand in der Küche unterwegs war'
          - conditions:
            - condition: state
              entity_id: binary_sensor.pm_o_ba
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: 'Wasserventil konnte nicht bewegt werden, da noch jemand im Bad OG unterwegs war'
          - conditions:
            - condition: state
              entity_id: binary_sensor.waschmaschine_ist_an
              state: 'on'
            sequence:
            - service: notify.telegram_jo
              data:
                message: 'Wasserventil konnte nicht bewegt werden, da die Waschmaschine läuft'
          - conditions:
            - condition: numeric_state
              entity_id: sensor.el_leistung_spulmaschine
              above: 0.1
            sequence:
            - service: notify.telegram_jo
              data:
                message: 'Wasserventil konnte nicht bewegt werden, da die Spülmaschine läuft'
          default: 
          - service: switch.turn_off
            target:
              entity_id: switch.wasserabsperrventil
          - service: timer.start
            target:
              entity_id: timer.water_valve_weekly
            data:
              duration: '00:00:45'
          - service: notify.telegram_jo
            data:
              message: 'Wasserventil wöchentlich zu'
      - conditions:
        - condition: trigger
          id: timer_finished
        sequence:
        - service: switch.turn_on
          target:
            entity_id: switch.wasserabsperrventil
        - service: notify.telegram_jo
          data:
            message: 'Wasserventil wieder auf'
      default: []
#
###############################################
#####         Bildschirm Theke            #####
###############################################
- id: '8e8ef7aa-b20b-436c-8110-94030f1069b8'
  alias: Bildschirm Theke
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: binary_sensor.anwesenheit_bildschirm
      to: "on"
      id: presence_on
    - platform: state
      entity_id: binary_sensor.anwesenheit_bildschirm
      to: "off"
      id: presence_off
    - platform: state
      entity_id: sensor.helligkeit_kuche_pm
      to:
      id: brightness
    - platform: time_pattern
      minutes: "*"
      seconds: 23
      id: regularly
    - platform: state
      entity_id: sensor.kiosk_browser_bildschirm_theke
      to: "unavailable"
      for: "00:10:00"
      id: no_connection
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: presence_on
        sequence:
        - service: rest_command.bildschirm_theke_command
          data:
            cmd: screenOn
            key: ''
            value: ''
      - conditions:
        - condition: trigger
          id: presence_off
        sequence:
        - service: rest_command.bildschirm_theke_command
          data:
            cmd: screenOff
            key: ''
            value: ''
      - conditions:
        - condition: trigger
          id: brightness
        sequence:
        - choose:
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 5
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 51
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 10
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 77
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 15
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 102
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 20
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 128
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 25
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 153
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 40
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 178
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 80
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 204
          - conditions:
            - condition: numeric_state
              entity_id: sensor.helligkeit_kuche_pm
              below: 200
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: setStringSetting
                key: screenBrightness
                value: 230
          default:
          - service: rest_command.bildschirm_theke_command
            data:
              cmd: setStringSetting
              key: screenBrightness
              value: 245
      - conditions:
        - condition: trigger
          id: regularly
        sequence:
        - choose:
          - conditions:
            - condition: state
              entity_id: binary_sensor.anwesenheit_bildschirm
              state: 'off'
            sequence:
            - service: rest_command.bildschirm_theke_command
              data:
                cmd: screenOff
                key: ''
                value: ''
          default:
          - service: rest_command.bildschirm_theke_command
            data:
              cmd: screenOn
              key: ''
              value: ''
      - conditions:
        - condition: trigger
          id: no_connection
        sequence:
        - service: switch.turn_off
          target:
            entity_id: switch.esp_sd_3_relais
        - delay: 5
        - service: switch.turn_on
          target:
            entity_id: switch.esp_sd_3_relais
      default: []
#
###############################################
#####        Download Meteogram           #####
###############################################
- id: '4461323f-ee9a-423e-8819-61efb3f9357d'
  alias: Download Meteogram
  description: ''
  mode: queued
  trigger:
    - platform: time
      at: "04:04:20"
  condition: []
  action:
    - service: downloader.download_file
      data:
        subdir: meteograms
        url: !secret url_meteogram
        filename: meteogram.png
        overwrite: true
#
###############################################
#####      Notify KNX unavailable         #####
###############################################
- id: '61987d8a-44d0-4def-8580-b9acfc7f23ab'
  alias: Notify KNX unavailable
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: binary_sensor.pm_o_ko_la_raum
      to: "unavailable"
    - platform: state
      entity_id: binary_sensor.pm_o_ko_la_raum
      to: "unknown"
  condition: []
  action:
    - service: notify.telegram_jo
      data:
        message: 'KNX unavailable'
#
###############################################
#####            Pizza-Knopf              #####
###############################################
- id: '90891b56-958a-4460-a66d-389f3cab690c'
  alias: Pizza-Knopf
  description: ''
  mode: queued
  trigger:
    - platform: state
      entity_id: input_number.pizza_timer_2
      to: ~
      id: input_number_changed
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.pizza_timer_ha
      id: timer_finished
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: input_number_changed
        sequence:
        - service: timer.cancel
          target:
            entity_id: timer.pizza_timer_ha
        - choose:
          - conditions:
            - condition: template
              value_template: >
                {{ (trigger.to_state.state | float(0)) == 0 }}
            sequence:
            - choose:
              - conditions:
                - condition: state
                  entity_id: timer.pizza_timer_ha
                  state: 'idle'
                sequence:
                - service: notify.telegram_jo
                  data:
                    message: 'Pizza ist fertig'
                - service: rest_command.bildschirm_theke_speak
                  data:
                    text: Pizza%20ist%20fertig%2E%20Lasst%20es%20euch%20schmecken
                - service: media_player.media_pause
                  entity_id: media_player.kodi_wz_2
                - service: notify.kodi_wz_2
                  title: Pizza
                  message: ist fertig
                  data:
                    displaytime: 15000
                    icon: "http://odroidxu4/sonstiges/pizza2.jpg"
              default:
              - service: notify.telegram_jo
                data:
                  message: 'Pizza-Timer abgebrochen'
          - conditions:
            - condition: template
              value_template: >
                {{ (trigger.to_state.state | float(0)) > 0 }}
            sequence:
            - service: timer.start
              target:
                entity_id: timer.pizza_timer_ha
              data:
                duration: '00:01:00'
          default: []
      - conditions:
        - condition: trigger
          id: timer_finished
        - condition: template
          value_template: >
            {{ (states('input_number.pizza_timer_2') | float(0)) > 0 }}
        sequence:
        - service: input_number.decrement
          entity_id: input_number.pizza_timer_2
      default: []
#
###############################################
#####        Hochzeitsbild an aus         #####
###############################################
- id: '899e72d8-444a-4aef-9ef5-a7b908705177'
  alias: Hochzeitsbild an aus
  description: ''
  mode: queued
  trigger:
    - platform: time
      at: "16:55:00"
      id: time_on
    - platform: time
      at: "23:00:00"
      id: time_off
  condition: []
  action:
    - choose:
      - conditions:
        - condition: trigger
          id: time_on
        sequence:
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.beleuchtung_hochzeitsbild
      - conditions:
        - condition: trigger
          id: time_off
        sequence:
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.beleuchtung_hochzeitsbild
      default: []