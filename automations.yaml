- alias: KNX relative dimming Stehlampe WZ
  id: 'knx_relative_dimming_stehlampe_wz'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e27_color_stehlampe_wz_level_light_color_on_off
      switch_address: '1/6/80'
      dimm_address: '1/6/82'
      dimm_time: 5
      dimm_steps: 10
- alias: KNX relative dimming Stehlampe Lea
  id: 'knx_relative_dimming_stehlampe_lea'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e14_tw_stehlampe_lea_level_light_color_on_off
      switch_address: '1/6/0'
      dimm_address: '1/6/2'
      dimm_time: 5
      dimm_steps: 10
- alias: KNX relative dimming Stehlampe Lara
  id: 'knx_relative_dimming_stehlampe_lara'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.innr_e14_ww_stehlampe_lara_level_on_off
      switch_address: '1/5/200'
      dimm_address: '1/5/202'
      dimm_time: 5
      dimm_steps: 10
- alias: KNX relative dimming Panel Arbeitszimmer
  id: 'knx_relative_dimming_panel_arbeitszimmer'
  description: ''
  use_blueprint:
    path: /config/blueprints/knx_relative_dimming_farmio.yaml
    input:
      target_lights:
        entity_id: light.ikea_panel_arbeitszimmer_esphome
      switch_address: '1/6/120'
      dimm_address: '1/6/122'
      dimm_time: 5
      dimm_steps: 10
- id: '1639043665489'
  alias: Play on Kodi WZ
  description: ''
  trigger:
  - platform: event
    event_type: play_on_kodi_wz
    id: play_on_kodi_wz
  condition: []
  action:
  - service: media_player.turn_on
    target:
      entity_id: media_player.samsung_7_series_55
  - service: media_player.play_media
    data:
      media_content_id: '{{ trigger.event.data.filepath }}'
      media_content_type: video
    target:
      entity_id: media_player.kodi_wz_2
  - service: media_player.volume_set
    target:
      entity_id: media_player.beam
    data:
      volume_level: 0.2
  mode: restart
- id: '1640156192211'
  alias: ZigBee Taster Lara
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:06:72:6e:97
  trigger:
  - platform: event
    event_type: zha_event
    id: zha_event
    event_data:
      device_ieee: "{{ device_ieee }}"
  condition: []
  action:
  - service: switch.toggle
    target:
      entity_id: switch.la_schlaft
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  mode: single
- id: '1640156192212'
  alias: ZigBee Taster Lea
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:06:6f:9b:9d
  trigger:
  - platform: event
    event_type: zha_event
    id: zha_event
    event_data:
      device_ieee: "{{ device_ieee }}"
  condition: []
  action:
  - service: switch.toggle
    target:
      entity_id: switch.le_schlaft
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  mode: single
- id: '1640156192213'
  alias: ZigBee Taster GÃ¤ste
  description: ''
  trigger_variables:
      device_ieee: 00:15:8d:00:02:5f:22:62
  trigger:
  - platform: event
    event_type: zha_event
    id: zha_event
    event_data:
      device_ieee: "{{ device_ieee }}"
  condition: []
  action:
  - service: switch.toggle
    target:
      entity_id: switch.gaste_schlafen
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  mode: single
#
#
#
# --- Licht GZ 2 ---
#
#
- id: '1637055201020'
  alias: Test Licht GZ 2
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.automation_switch_light_o_gz_deckenlicht
    id: app_switch
    to: 'on'
  - platform: homeassistant
    event: start
    id: ha_start
  - platform: state
    entity_id: binary_sensor.helper_light_trigger_o_gz_deckenlicht
    id: motion
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
          - condition: trigger
            id: app_switch
          - condition: trigger
            id: ha_start
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.helper_light_auto_switched_o_gz_deckenlicht
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.helper_light_keeping_fix_entities_o_gz_deckenlicht
            state: 'off'
          sequence:
          - choose:
            - conditions:
              - condition: state
                entity_id: binary_sensor.helper_light_trigger_o_gz_deckenlicht
                state: 'on'
              sequence:
              - choose:
                - conditions:
                  - condition: state
                    entity_id: binary_sensor.helper_light_is_too_dark_o_gz_deckenlicht
                    state: 'on'
                  sequence:
                  - condition: state
                    entity_id: input_boolean.automation_switch_light_o_gz_deckenlicht
                    state: 'on'
                  - condition: state
                    state: 'off'
                    entity_id: binary_sensor.helper_light_keeping_off_entities_o_gz_deckenlicht
                  - condition: state
                    state: 'off'
                    entity_id: input_boolean.helper_light_manually_switched_off_o_gz_deckenlicht
                  - choose:
                    - conditions:
                      - condition: state
                        entity_id: light.innr_e14_ww_decke_gastezimmer_level_on_off
                        state: 'off'
                      sequence:
                      - service: input_boolean.turn_on
                        target:
                          entity_id: input_boolean.helper_light_auto_switched_o_gz_deckenlicht
                    default: []
                  - service: light.turn_on
                    target:
                      entity_id: light.innr_e14_ww_decke_gastezimmer_level_on_off
                    data:
                      transition: 2
                      brightness_pct: 75
                default: []
            default: []
        default: []
    default: []
  mode: queued
  max: 10
#
#
#
# --- Regal ---
#
#
- id: '1637055201021'
  alias: Test Licht Regal Bad EG
  description: ''
  variables:
    transition_time: 1
  trigger:
  - platform: state
    entity_id: input_boolean.automation_switch_light_e_ba_regal
    id: app_switch
    to: 'on'
  - platform: homeassistant
    event: start
    id: ha_start
  - platform: state
    entity_id: binary_sensor.helper_light_trigger_e_ba_regal
    id: motion_on
    from: "off"
    to: "on"
  - platform: state
    entity_id: binary_sensor.helper_light_trigger_e_ba_regal
    id: motion_off
    from: "on"
    to: "off"
  - platform: state
    entity_id: sensor.helper_light_switching_off_entities_e_ba_regal
    id: switching_off_entities
  - platform: state
    entity_id: binary_sensor.helper_light_is_too_dark_e_ba_regal
    id: too_dark
    to: "on"
  - platform: state
    entity_id: binary_sensor.helper_light_is_too_bright_e_ba_regal
    id: too_bright
    to: "on"
  - platform: state
    entity_id: light.regal_bad_eg
    id: light_on_or_off
  - platform: state
    entity_id: binary_sensor.helper_light_keeping_on_entities_e_ba_regal
    id: keeping_on_ended
    to: "off"
  - platform: state
    entity_id: binary_sensor.helper_light_keeping_off_entities_e_ba_regal
    id: keeping_off_ended
    to: "off"
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
          - condition: trigger
            id: app_switch
          - condition: trigger
            id: ha_start
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
            state: 'off'
          sequence:
          - choose:
            - conditions:
              - condition: state
                entity_id: binary_sensor.helper_light_trigger_e_ba_regal
                state: 'on'
              sequence:
              - choose:
                - conditions:
                  - condition: state
                    entity_id: binary_sensor.helper_light_is_too_dark_e_ba_regal
                    state: 'on'
                  sequence:
                  - condition: state
                    entity_id: input_boolean.automation_switch_light_e_ba_regal
                    state: 'on'
                  - condition: state
                    state: 'off'
                    entity_id: binary_sensor.helper_light_keeping_off_entities_e_ba_regal
                  - condition: state
                    state: 'off'
                    entity_id: input_boolean.helper_light_manually_switched_off_e_ba_regal
                  - choose:
                    - conditions:
                      - condition: state
                        entity_id: light.regal_bad_eg
                        state: 'off'
                      sequence:
                      - service: input_boolean.turn_on
                        target:
                          entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
                    default: []
                  - service: light.turn_on
                    target:
                      entity_id: light.regal_bad_eg
                    data_template:
                      brightness: >
                        {{ states('sensor.helper_light_effective_brightness_e_ba_regal') | int(80) }}
                      transition: >
                        {{ transition_time }}
                # path 2
                - conditions:
                  - condition: state
                    entity_id: binary_sensor.helper_light_is_too_bright_e_ba_regal
                    state: 'on'
                  sequence:
                  - condition: state
                    entity_id: input_boolean.automation_switch_light_e_ba_regal
                    state: 'on'
                  - condition: state
                    state: 'off'
                    entity_id: binary_sensor.helper_light_keeping_on_entities_e_ba_regal
                  - condition: state
                    state: 'off'
                    entity_id: input_boolean.helper_light_manually_switched_on_e_ba_regal
                  - choose:
                    - conditions:
                      - condition: state
                        entity_id: light.regal_bad_eg
                        state: 'on'
                      sequence:
                      - service: input_boolean.turn_on
                        target:
                          entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
                    default: []
                  - service: light.turn_off
                    target:
                      entity_id: light.regal_bad_eg
                default: []
            - conditions:
              - condition: state
                entity_id: binary_sensor.helper_light_trigger_e_ba_regal
                state: 'off'
              sequence:
              - condition: state
                entity_id: input_boolean.automation_switch_light_e_ba_regal
                state: 'on'
              - condition: state
                state: 'off'
                entity_id: binary_sensor.helper_light_keeping_on_entities_e_ba_regal
              - choose:
                - conditions:
                  - condition: state
                    entity_id: light.regal_bad_eg
                    state: 'on'
                  sequence:
                  - service: input_boolean.turn_on
                    target:
                      entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
                default: []
              - service: light.turn_off
                target:
                  entity_id: light.regal_bad_eg
            default: []
        # path 4
        - conditions:
          - condition: state
            entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
            state: 'on'
          sequence:
          - condition: state
            entity_id: input_boolean.automation_switch_light_e_ba_regal
            state: 'on'
          - choose:
            - conditions:
              - condition: state
                entity_id: light.regal_bad_eg
                state: 'off'
              sequence:
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
            default: []
          - service: light.turn_on
            target:
              entity_id: light.regal_bad_eg
            data_template:
              brightness: >
                {{ states('sensor.helper_light_effective_brightness_e_ba_regal') | int(80) }}
              transition: >
                {{ transition_time }}
        default: []
    # path 5
    - conditions:
      - condition: trigger
        id: motion_on
      sequence:
      - condition: state
        entity_id: input_boolean.automation_switch_light_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_off_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: input_boolean.helper_light_manually_switched_off_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: binary_sensor.helper_light_is_too_dark_e_ba_regal
        state: 'on'
      - choose:
        - conditions:
          - condition: state
            entity_id: light.regal_bad_eg
            state: 'off'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
      - service: light.turn_on
        target:
          entity_id: light.regal_bad_eg
        data_template:
          brightness: >
            {{ states('sensor.helper_light_effective_brightness_e_ba_regal') | int(80) }}
          transition: >
            {{ transition_time }}
    # path 6
    - conditions:
      - condition: trigger
        id: motion_off
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.helper_light_manually_switched_on_e_ba_regal
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.helper_light_manually_switched_off_e_ba_regal
      - condition: state
        entity_id: input_boolean.automation_switch_light_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_on_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
        state: 'off'
      - choose:
        - conditions:
          - condition: state
            entity_id: light.regal_bad_eg
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
      - service: light.turn_off
        target:
          entity_id: light.regal_bad_eg
    # path 7
    - conditions:
      - condition: trigger
        id: switching_off_entities
      sequence:
      - condition: template
        value_template: '{{ is_number(trigger.to_state.state) }}'
      - condition: template
        value_template: '{{ is_number(trigger.from_state.state) }}'
      - condition: template
        value_template: '{{ (trigger.to_state.state | float(0)) > (trigger.from_state.state | float(1)) }}'
      - condition: state
        entity_id: input_boolean.automation_switch_light_e_ba_regal
        state: 'on'
      - choose:
        - conditions:
          - condition: state
            entity_id: light.regal_bad_eg
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
      - service: light.turn_off
        target:
          entity_id: light.regal_bad_eg
    # path 8
    - conditions:
      - condition: trigger
        id: too_dark
      sequence:
      - condition: state
        entity_id: input_boolean.automation_switch_light_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_trigger_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_off_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: input_boolean.helper_light_manually_switched_off_e_ba_regal
        state: 'off'
      - choose:
        - conditions:
          - condition: state
            entity_id: light.regal_bad_eg
            state: 'off'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
      - service: light.turn_on
        target:
          entity_id: light.regal_bad_eg
        data_template:
          brightness: >
            {{ states('sensor.helper_light_effective_brightness_e_ba_regal') | int(80) }}
          transition: >
            {{ transition_time }}
    # path 9
    - conditions:
      - condition: trigger
        id: too_bright
      sequence:
      - condition: state
        entity_id: input_boolean.automation_switch_light_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_on_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: input_boolean.helper_light_manually_switched_on_e_ba_regal
        state: 'off'
      - choose:
        - conditions:
          - condition: state
            entity_id: light.regal_bad_eg
            state: 'on'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
      - service: light.turn_off
        target:
          entity_id: light.regal_bad_eg
    # path 10
    - conditions:
      - condition: trigger
        id: light_on_or_off
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
            state: 'off'
          sequence:
          - choose:
            - conditions:
              - condition: template
                value_template: >
                  {{ trigger.to_state.state == 'on' }}
              sequence:
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.helper_light_manually_switched_on_e_ba_regal
            # path 11
            - conditions:
              - condition: template
                value_template: >
                  {{ trigger.to_state.state == 'off' }}
              sequence:
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.helper_light_manually_switched_off_e_ba_regal
            default: []
        # path 12
        - conditions:
          - condition: state
            entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
            state: 'on'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
    # path 13
    - conditions:
      - condition: trigger
        id: keeping_on_ended
      sequence:
      - condition: state
        entity_id: input_boolean.automation_switch_light_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_trigger_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: binary_sensor.helper_light_is_too_dark_e_ba_regal
        state: 'on'
      - condition: state
        entity_id: input_boolean.helper_light_manually_switched_off_e_ba_regal
        state: 'off'
      - condition: state
        entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
        state: 'off'
      - choose:
        - conditions:
          - condition: state
            entity_id: light.regal_bad_eg
            state: 'off'
          sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
        default: []
      - service: light.turn_on
        target:
          entity_id: light.regal_bad_eg
        data_template:
          brightness: >
            {{ states('sensor.helper_light_effective_brightness_e_ba_regal') | int(80) }}
          transition: >
            {{ transition_time }}
    # path 14
    - conditions:
      - condition: trigger
        id: keeping_off_ended
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.helper_light_trigger_e_ba_regal
            state: 'on'
          sequence:
          - condition: state
            entity_id: input_boolean.automation_switch_light_e_ba_regal
            state: 'on'
          - condition: state
            entity_id: binary_sensor.helper_light_is_too_dark_e_ba_regal
            state: 'off'
          - condition: state
            entity_id: input_boolean.helper_light_manually_switched_on_e_ba_regal
            state: 'off'
          - condition: state
            entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
            state: 'off'
          - choose:
            - conditions:
              - condition: state
                entity_id: light.regal_bad_eg
                state: 'on'
              sequence:
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
            default: []
          - service: light.turn_off
            target:
              entity_id: light.regal_bad_eg
        # path 15
        - conditions:
          - condition: state
            entity_id: binary_sensor.helper_light_trigger_e_ba_regal
            state: 'off'
          sequence:
          - condition: state
            entity_id: input_boolean.automation_switch_light_e_ba_regal
            state: 'on'
          - condition: state
            entity_id: binary_sensor.helper_light_keeping_fix_entities_e_ba_regal
            state: 'off'
          - choose:
            - conditions:
              - condition: state
                entity_id: light.regal_bad_eg
                state: 'on'
              sequence:
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.helper_light_auto_switched_e_ba_regal
            default: []
          - service: light.turn_off
            target:
              entity_id: light.regal_bad_eg
    default: []
  mode: queued
  max: 10
