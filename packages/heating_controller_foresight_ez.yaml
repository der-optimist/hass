sensor:
  - platform: derivative
    source: sensor.temp_esszimmer_pm
    name: Steigung Temp. EZ
    unit_time: h
    time_window: "02:30:00"

template:
  - sensor:
      - name: helper_heating_ez_shift_kelvin_limited
        unit_of_measurement: "K"
        state: >
          {% set multipicator = 6 %}
          {% set limit_upper = 1.0 %}
          {% set limit_lower = -1.0 %}
          {% set shift_kelvin = -1*multipicator*(states('sensor.steigung_temp_ez_median') | float(0)) %}
          {% if shift_kelvin > limit_upper %}
            {{ limit_upper }}
          {% elif shift_kelvin < limit_lower %}
            {{ limit_lower }}
          {% else %}
            {{ shift_kelvin }}
          {% endif %}
      - name: helper_heating_ez_shift_kelvin_bytes
        unit_of_measurement: "bytes"
        # shift_value is the value, that is set in the heating actuator via ETS
        state: >
          {% set shift_value = 0.1 %}
          {% set shift_points = ((states('sensor.helper_heating_ez_shift_kelvin_limited') | float(0)) / shift_value) | round(0) %}
          {% if shift_points > 0 %}
            {{ shift_points }}
          {% elif shift_points < 0 %}
            {{ 256 + shift_points }}
          {% else %}
            {{ 0 }}
          {% endif %}