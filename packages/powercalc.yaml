sensor:
  - platform: powercalc
    create_group: Bekannte Verbraucher
    unique_id: 5da77d06-d4e6-11ec-bcd5-533ea3dd1b9a
    entities:
      - create_group: Alle Lichter
        unique_id: 81f777e4-d4df-11ec-85d0-dfb4ae2aa83a
        entities:
          - create_group: Lichter Küche
            entities:
              - entity_id: light.arbeitsplatte
                linear:
                  min_power: 2
                  max_power: 90
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.panels_kuche
                linear:
                  min_power: 1
                  max_power: 24
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.panels_bar
                linear:
                  min_power: 1
                  max_power: 16
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.sockelbeleuchtung
                linear:
                  min_power: 2
                  max_power: 28
                  gamma_curve: 4
                disable_standby_power: true
          - create_group: Lichter Esszimmer
            entities:
              - entity_id: light.panels_esszimmer
                linear:
                  min_power: 1
                  max_power: 32
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.wandleuchten_esszimmer_hell
                linear:
                  min_power: 1
                  max_power: 34
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.wandleuchten_esszimmer_gemutlich
                linear:
                  min_power: 1
                  max_power: 25
                  gamma_curve: 4
                disable_standby_power: true
          - create_group: Lichter Wohnzimmer
            entities:
              - entity_id: light.panels_wohnzimmer
                linear:
                  min_power: 1
                  max_power: 32
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.schrankbeleuchtung_wohnzimmer
                linear:
                  min_power: 1
                  max_power: 21
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.innr_e27_color_stehlampe_wz_level_light_color_on_off
                name: Stehlampe Wohnzimmer
                manufacturer: innr
                model: 'RB 285 C'
          - create_group: Lichter Schlafzimmer
            entities:
              - entity_id: light.panels_schlafzimmer
                linear:
                  min_power: 1
                  max_power: 48
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.bettbeleuchtung
                linear:
                  min_power: 1
                  max_power: 28
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.innr_e14_tw_kugellampe_schlafzimmer_level_light_color_on_off
                name: Kugellampe Schlafzimmer
                linear:
                  min_power: 0.5
                  max_power: 5.8
                standby_power: 0.4
          - create_group: Lichter Bad EG
            entities:
              - entity_id: light.panels_bad_eg
                linear:
                  min_power: 1
                  max_power: 40
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.regal_bad_eg
                linear:
                  min_power: 1
                  max_power: 15
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.led_auf_spiegelschrank_bad_eg
                linear:
                  min_power: 1
                  max_power: 17
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.spiegel_bad_eg
                fixed:
                  power: 12
          - create_group: Lichter Flur EG und Windfang
            entities:
              - entity_id: light.panels_flur_eg
                linear:
                  min_power: 1
                  max_power: 24
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.panels_windfang
                linear:
                  min_power: 1
                  max_power: 16
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.brettlicht_windfang
                linear:
                  min_power: 1
                  max_power: 29
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.0x00158d0005019c5c
                name: Stehlampe Flur EG oben
                manufacturer: innr
                model: 'RB 285 C'
              - entity_id: light.0x00158d0005019b3f
                name: Stehlampe Flur EG unten
                manufacturer: innr
                model: 'RB 285 C'
          - create_group: Lichter WC
            entities:
              - entity_id: light.panels_wc
                linear:
                  min_power: 1
                  max_power: 8
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.spiegel_wc
                fixed:
                  power: 20
          - create_group: Lichter Lara
            entities:
              - entity_id: light.panels_la
                linear:
                  min_power: 1
                  max_power: 40
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.wandwurfel_la
                linear:
                  min_power: 1
                  max_power: 12
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.innr_e14_ww_stehlampe_lara_level_on_off
                name: Stehlampe Lara
                linear:
                  min_power: 0.5
                  max_power: 5.3
                standby_power: 0.4
          - create_group: Lichter Arbeitszimmer
            entities:
              - entity_id: light.schreibtisch_decke
                fixed:
                  power: 24
              - entity_id: light.ikea_panel_arbeitszimmer_esphome
                linear:
                  min_power: 2
                  max_power: 30
                  gamma_curve: 2.8
                standby_power: 1
          - create_group: Lichter Lea
            entities:
              - entity_id: light.panels_le
                linear:
                  min_power: 1
                  max_power: 40
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.wandwurfel_le
                linear:
                  min_power: 1
                  max_power: 12
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.innr_e14_tw_stehlampe_lea_level_light_color_on_off
                name: Stehlampe Lea
                linear:
                  min_power: 0.5
                  max_power: 5.8
                standby_power: 0.4
          - create_group: Lichter Gästezimmer
            entities:
              - entity_id: light.innr_e14_ww_decke_gastezimmer_level_on_off
                linear:
                  min_power: 0.5
                  max_power: 5.3
                standby_power: 0.4
          - create_group: Lichter Flur und Treppe OG
            entities:
              - entity_id: light.panels_flur_og
                linear:
                  min_power: 1
                  max_power: 40
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.panels_treppe_og
                linear:
                  min_power: 1
                  max_power: 16
                  gamma_curve: 4
                disable_standby_power: true
          - create_group: Lichter Bad OG
            entities:
              - entity_id: light.panels_bad_og
                linear:
                  min_power: 1
                  max_power: 48
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.led_auf_spiegelschrank_bad_og
                linear:
                  min_power: 1
                  max_power: 17
                  gamma_curve: 4
                disable_standby_power: true
              - entity_id: light.spiegel_bad_og
                fixed:
                  power: 12
          - create_group: Lichter Keller
            entities:
              - entity_id: light.shellydimmer_d472fe_light_0
                power_sensor_id: sensor.el_leistung_shellydimmer_d472fe_power
                name: Licht Kellertreppe
              - name: Standby Dimmer Kellertreppe
                daily_fixed_energy:
                  value: 1
                  unit_of_measurement: W
              - entity_id: light.flur_keller
                fixed:
                  power: 20
              - entity_id: light.vorratsraum
                fixed:
                  power: 20
              - entity_id: light.technikraum
                fixed:
                  power: 20
              - entity_id: light.lagerraum
                name: Licht Partyraum
                fixed:
                  power: 22
              - entity_id: light.werkelraum
                fixed:
                  power: 60
          - create_group: Lichter Aussen
            entities:
              - create_group: Lichter Carport
                entities:
                  - entity_id: light.led_streifen_carport
                    linear:
                      min_power: 1
                      max_power: 67
                      gamma_curve: 4
                    disable_standby_power: true
                  - entity_id: light.bodenlicht_eingang
                    linear:
                      min_power: 1
                      max_power: 16
                      gamma_curve: 4
                    disable_standby_power: true
                  - entity_id: light.spots_carport_2
                    linear:
                      min_power: 1
                      max_power: 22
                      gamma_curve: 4
                    disable_standby_power: true
                  - entity_id: light.abstellraum_carport
                    fixed:
                      power: 24
              - create_group: Lichter Garten und Terrasse
                entities:
                  - entity_id: light.wandwurfel_suden
                    fixed:
                      power: 21
                  - entity_id: light.wandwurfel_westen
                    fixed:
                      power: 21
                  - entity_id: light.bodenstrahler_blumenbeet
                    fixed:
                      power: 6
                  - entity_id: light.innr_rb_285_c_7cc30105_level_light_color_on_off
                    name: Leuchtwürfel Ecke gross
                    manufacturer: innr
                    model: 'RB 285 C'
                  - entity_id: light.innr_rb_285_c_55f50405_level_light_color_on_off
                    name: Leuchtwürfel Ecke klein
                    manufacturer: innr
                    model: 'RB 285 C'
                  - entity_id: light.innr_e27_color_terrasse_feuerplatz_level_light_color_on_off
                    name: Leuchtwürfel Feuerplatz
                    manufacturer: innr
                    model: 'RB 285 C'
      - create_group: Wärmepumpe gesamt
        unique_id: 6a8a5e3a-d4e6-11ec-9412-17d6662e547e
        entities:
          - entity_id: sensor.el_leistung_wp_aussenteil
            power_sensor_id: sensor.el_leistung_wp_aussenteil
            name: WP Aussenteil
          - entity_id: sensor.el_leistung_wp_innenteil
            power_sensor_id: sensor.el_leistung_wp_innenteil
            name: WP Innenteil
          - entity_id: sensor.el_leistung_wp_heizstab
            power_sensor_id: sensor.el_leistung_wp_heizstab
            name: WP Heizstab
      - create_group: Küchengeräte ohne Kühlschrank
        unique_id: 6f642698-d4e6-11ec-b5ff-5ffffcb302c4
        entities:
          - entity_id: sensor.el_leistung_backofen
            power_sensor_id: sensor.el_leistung_backofen
            name: Backofen
          - entity_id: sensor.el_leistung_kochfeld
            power_sensor_id: sensor.el_leistung_kochfeld
            name: Kochfeld
          - entity_id: sensor.el_leistung_mixi
            power_sensor_id: sensor.el_leistung_mixi
            name: Mixi
          - entity_id: sensor.el_leistung_spulmaschine
            power_sensor_id: sensor.el_leistung_spulmaschine
            name: Spülmaschine
      - create_group: Kühlgeräte
        unique_id: 761da14e-d4e6-11ec-b986-8f23f43c4cdb
        entities:
          - entity_id: sensor.el_leistung_kuhlschrank_kuche
            power_sensor_id: sensor.el_leistung_kuhlschrank_kuche
            name: Kühlschrank Küche
          - entity_id: sensor.el_leistung_gefrierschrank
            power_sensor_id: sensor.el_leistung_gefrierschrank
            name: Gefrierschrank
      - create_group: Multimedia
        unique_id: 7a29b700-d4e6-11ec-aa95-b7163cea96da
        entities:
          - entity_id: sensor.el_leistung_tv
            power_sensor_id: sensor.el_leistung_tv
            name: TV
          - entity_id: media_player.beam
            fixed:
              power: 6.5
          - entity_id: media_player.sonos_move
            fixed:
              power: 3.5
          - entity_id: media_player.sonos_one_1
            fixed:
              power: 3.5
          - entity_id: media_player.kodi_wz_2
            fixed:
              power: 2
          - name: Digibit Receiver
            daily_fixed_energy:
              value: 8
              unit_of_measurement: W
          - name: Radio Lea
            daily_fixed_energy:
              value: 1
              unit_of_measurement: W
          - name: Echo Arbeitszimmer
            daily_fixed_energy:
              value: 2
              unit_of_measurement: W
#          - name: Echo Lea
#            daily_fixed_energy:
#              value: 1.8
#              unit_of_measurement: W
#          - name: Echo Lara
#            daily_fixed_energy:
#              value: 1.8
#              unit_of_measurement: W
      - create_group: Waschmaschine und Trockner
        unique_id: 81e1e81e-d4e6-11ec-bbf4-9b13a3184af9
        entities:
          - entity_id: sensor.el_leistung_waschmaschine
            power_sensor_id: sensor.el_leistung_waschmaschine
            name: Waschmaschine
          - entity_id: sensor.el_leistung_trockner
            power_sensor_id: sensor.el_leistung_trockner
            name: Trockner
      - create_group: Haustechnik
        unique_id: 85c0c770-d4e6-11ec-839f-13ded9df0121
        entities:
          - entity_id: sensor.el_leistung_luftungsanlage
            power_sensor_id: sensor.el_leistung_luftungsanlage
            name: Lüftungsanlage
          - entity_id: sensor.el_leistung_hebeanlage
            power_sensor_id: sensor.el_leistung_hebeanlage
            name: Hebeanlage
          - entity_id: sensor.el_leistung_bildschirm_theke
            power_sensor_id: sensor.el_leistung_bildschirm_theke
            name: Bildschirm Theke
          - entity_id: sensor.el_leistung_dauerverbraucher_haustechnik
            power_sensor_id: sensor.el_leistung_dauerverbraucher_haustechnik
            name: Dauerverbraucher Haustechnik
      - create_group: Netzwerk Telefon und Computer
        unique_id: 8be33bc4-d4e6-11ec-ab34-a3a9cd3e3430
        entities:
          - entity_id: sensor.el_leistung_dauerverbraucher_netzwerk
            power_sensor_id: sensor.el_leistung_dauerverbraucher_netzwerk
            name: Netzwerk
          - entity_id: sensor.el_leistung_dauerverbraucher_telefon_und_computer
            power_sensor_id: sensor.el_leistung_dauerverbraucher_telefon_und_computer
            name: Telefon und Computer
      - create_group: Luftentfeuchter und Befeuchter
        unique_id: 8fe3bad2-d4e6-11ec-9b29-07ac1d4aaea7
        entities:
          - entity_id: sensor.el_leistung_luftentfeuchter_waschkueche
            power_sensor_id: sensor.el_leistung_luftentfeuchter_waschkueche
            name: Luftentfeuchter Waschküche
          - entity_id: sensor.el_leistung_luftentfeuchter_partyraum
            power_sensor_id: sensor.el_leistung_luftentfeuchter_partyraum
            name: Luftentfeuchter Partyraum
          - entity_id: sensor.el_leistung_luftentf_vorratsraum
            power_sensor_id: sensor.el_leistung_luftentf_vorratsraum
            name: Luftentfeuchter Speis
          - entity_id: sensor.el_leistung_esp_sd_2
            power_sensor_id: sensor.el_leistung_esp_sd_2
            name: Luftbefeuchter WZ
      - create_group: Heizung Partyraum
        unique_id: 95ab1c9e-d4e6-11ec-a181-7ba9e587eb94
        entities:
          - entity_id: sensor.el_leistung_heizung_partyraum_vorne
            power_sensor_id: sensor.el_leistung_heizung_partyraum_vorne
            name: Heizung Partyraum vorne
#          - entity_id: sensor.el_leistung_heizung_partyraum_hinten
#            power_sensor_id: sensor.el_leistung_heizung_partyraum_hinten
#            name: Heizung Partyraum hinten
  - platform: powercalc
    entity_id: sensor.el_leistung_unbekannte_verbraucher
    power_sensor_id: sensor.el_leistung_unbekannte_verbraucher
    name: Unbekannte Verbraucher
    unique_id: cd1ad446-d5c5-11ec-942a-23b0e6b2ad5a
  - platform: powercalc
    entity_id: sensor.el_leistung_verbrauch_gesamt
    power_sensor_id: sensor.el_leistung_verbrauch_gesamt
    name: Verbrauch gesamt
    unique_id: ec589adc-d5c5-11ec-9457-0f7bfd653fe7
  - platform: powercalc
    entity_id: sensor.el_leistung_pv_ac
    power_sensor_id: sensor.el_leistung_pv_ac
    name: PV Leistung
    unique_id: 2a44499a-d5c6-11ec-b073-5381474628d7
  - platform: powercalc
    entity_id: sensor.el_leistung_einspeisung
    power_sensor_id: sensor.el_leistung_einspeisung
    name: PV Einspeisung
    unique_id: 58cebbba-d5c6-11ec-96c1-637159bb0824
  # -----------------------------------------------------------
  # ----------------- Integration of Costs --------------------
  # -----------------------------------------------------------
  # ohne PV
  - platform: integration
    source: sensor.template_euro_pro_stunde_alle_lichter_ohne_pv
    name: kostenzaehler_alle_lichter_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_bekannte_verbraucher_ohne_pv
    name: kostenzaehler_bekannte_verbraucher_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_haustechnik_ohne_pv
    name: kostenzaehler_haustechnik_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_heizung_partyraum_ohne_pv
    name: kostenzaehler_heizung_partyraum_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_kuchengerate_ohne_kuhlschrank_ohne_pv
    name: kostenzaehler_kuchengerate_ohne_kuhlschrank_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_kuhlgerate_ohne_pv
    name: kostenzaehler_kuhlgerate_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_luftentfeuchter_und_befeuchter_ohne_pv
    name: kostenzaehler_luftentfeuchter_und_befeuchter_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_multimedia_ohne_pv
    name: kostenzaehler_multimedia_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_netzwerk_telefon_und_computer_ohne_pv
    name: kostenzaehler_netzwerk_telefon_und_computer_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_unbekannte_verbraucher_ohne_pv
    name: kostenzaehler_unbekannte_verbraucher_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_verbrauch_gesamt_ohne_pv
    name: kostenzaehler_verbrauch_gesamt_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_waermepumpe_gesamt_ohne_pv
    name: kostenzaehler_waermepumpe_gesamt_ohne_pv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_waschmaschine_und_trockner_ohne_pv
    name: kostenzaehler_waschmaschine_und_trockner_ohne_pv
    round: 2
    unit_time: h
    method: left
  # mit PV - effektiv
  - platform: integration
    source: sensor.template_euro_pro_stunde_alle_lichter_mit_pv_effektiv
    name: kostenzaehler_alle_lichter_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_bekannte_verbraucher_mit_pv_effektiv
    name: kostenzaehler_bekannte_verbraucher_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_haustechnik_mit_pv_effektiv
    name: kostenzaehler_haustechnik_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_heizung_partyraum_mit_pv_effektiv
    name: kostenzaehler_heizung_partyraum_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
    name: kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_kuhlgerate_mit_pv_effektiv
    name: kostenzaehler_kuhlgerate_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_luftentfeuchter_und_befeuchter_mit_pv_effektiv
    name: kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_multimedia_mit_pv_effektiv
    name: kostenzaehler_multimedia_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_netzwerk_telefon_und_computer_mit_pv_effektiv
    name: kostenzaehler_netzwerk_telefon_und_computer_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_unbekannte_verbraucher_mit_pv_effektiv
    name: kostenzaehler_unbekannte_verbraucher_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_verbrauch_gesamt_mit_pv_effektiv
    name: kostenzaehler_verbrauch_gesamt_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_waermepumpe_gesamt_mit_pv_effektiv
    name: kostenzaehler_waermepumpe_gesamt_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_waschmaschine_und_trockner_mit_pv_effektiv
    name: kostenzaehler_waschmaschine_und_trockner_mit_pv_effektiv
    round: 2
    unit_time: h
    method: left
  # mit PV - Abrechnung
  - platform: integration
    source: sensor.template_euro_pro_stunde_alle_lichter_mit_pv_abrechnung
    name: kostenzaehler_alle_lichter_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_bekannte_verbraucher_mit_pv_abrechnung
    name: kostenzaehler_bekannte_verbraucher_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_haustechnik_mit_pv_abrechnung
    name: kostenzaehler_haustechnik_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_heizung_partyraum_mit_pv_abrechnung
    name: kostenzaehler_heizung_partyraum_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
    name: kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_kuhlgerate_mit_pv_abrechnung
    name: kostenzaehler_kuhlgerate_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
    name: kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_multimedia_mit_pv_abrechnung
    name: kostenzaehler_multimedia_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_netzwerk_telefon_und_computer_mit_pv_abrechnung
    name: kostenzaehler_netzwerk_telefon_und_computer_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_unbekannte_verbraucher_mit_pv_abrechnung
    name: kostenzaehler_unbekannte_verbraucher_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_verbrauch_gesamt_mit_pv_abrechnung
    name: kostenzaehler_verbrauch_gesamt_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_waermepumpe_gesamt_mit_pv_abrechnung
    name: kostenzaehler_waermepumpe_gesamt_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left
  - platform: integration
    source: sensor.template_euro_pro_stunde_waschmaschine_und_trockner_mit_pv_abrechnung
    name: kostenzaehler_waschmaschine_und_trockner_mit_pv_abrechnung
    round: 2
    unit_time: h
    method: left



template:
  - sensor:
      - unique_id: el_leistung_unbekannte_verbraucher
        unit_of_measurement: "W"
        state: >
          {{ (states('sensor.el_leistung_verbrauch_gesamt') | float(0)) - (states('sensor.el_leistung_powercalc_bekannte_verbraucher') | float(0)) }}
        attributes:
          friendly_name: "El. Leistung unbekannte Verbraucher"
      # -------------------------------
      # ------  Dauerverbraucher ------
      # -------------------------------
      - unique_id: el_leistung_dauerverbraucher_haustechnik
          # KNX Netzteil:                   12    (Abschätzung)
          # Wetterstation:                   2    (Datenblatt)
          # Wasserabsperrhahn:               0.5
          # Wechselrichter:                 10    (Datenblatt)
          # Modbus Gateway Lüftungsanlage:   1.5  (Datenblatt + Netzteil)
          # Entkalkungsanlage:               3    (geschätzt)
          # Klingel:                         5    (geschätzt)
          # Relais Sicherung Keller:         1    (geschätzt)
          # Shelly Schalter Bett-Steckdosen: 1
          # Shelly Steckdose Hebeanlage:     1
          # WLAN-Steckdosen:                 3    (3 x 1 W geschätzt - Bildschirm, 2x Heizung Partyraum)
          # Zigbee-Steckdosen                2    (4 x 0.5 - Luftentfeuchter Waschk. + Partyraum, 2x Zigbee-Repeater)
          # ESP-Sensoren                     5    (ca 5 x 1 W)
          # Onewirepi                        2
          # Robbi                            1
        state: >
          {{ (now().minute | float(0) / 1000) + 12 + 2 + 0.5 + 10 + 1.5 + 3 + 5 + 1 + 1 + 1 + 3 + 2 + 5 + 2 + 1 }}
        attributes:
          friendly_name: 'El. Leistung Dauerverbraucher Haustechnik'
          unit_of_measurement: 'W'
          icon_template: mdi:speedometer
      - unique_id: el_leistung_dauerverbraucher_netzwerk
          # an USV:                         51    (gemessen. USV, Fritzbox, Kabelmodem, Repeater Keller)
          # Repeater WZ                      4    (online-Test)
          # OdroidXU4 inkl. Platte           9.5  (4.5 Odroid, 5 Festplatte)
        state: >
          {{ (now().minute | float(0) / 1000) + 51 + 4 + 9.5 }}
        attributes:
          friendly_name: 'El. Leistung Dauerverbraucher Netzwerk'
          unit_of_measurement: 'W'
          icon_template: mdi:speedometer
      - unique_id: el_leistung_dauerverbraucher_telefon_und_computer
          # Telefon                          1    (<1 gemessen bzw nicht messbar)
          # Drucker                          1.5  (gemessen, an)
          # Netzteil Laptop Ma               1    (geschätzt)
          # Netzteil Laptop Jo               1    (geschätzt)
          # Netzteil Laptop MaJo             1    (geschätzt)
          # Standyby Monitor                 3    (3 x 1 geschätzt)
          # Raspi Bilderrahmen Flur          2
        state: >
          {{ (now().minute | float(0) / 1000) + 1 + 1.5 + 1 + 1 + 1 + 3 + 2 }}
        attributes:
          friendly_name: 'El. Leistung Dauerverbraucher Telefon und Computer'
          unit_of_measurement: 'W'
          icon_template: mdi:speedometer
      # -------------------------------
      # ------ Kosten pro Stunde ------
      # -------------------------------
      # Euro pro Stunde ohne PV
      - unique_id: euro_pro_stunde_bekannte_verbraucher_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_bekannte_verbraucher') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde bekannte Verbraucher - ohne PV"
      - unique_id: euro_pro_stunde_unbekannte_verbraucher_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_unbekannte_verbraucher') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde unbekannte Verbraucher - ohne PV"
      - unique_id: euro_pro_stunde_verbrauch_gesamt_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_verbrauch_gesamt') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Verbrauch gesamt - ohne PV"
      - unique_id: euro_pro_stunde_alle_lichter_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_alle_lichter') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde alle Lichter - ohne PV"
      - unique_id: euro_pro_stunde_waermepumpe_gesamt_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_warmepumpe_gesamt') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Wärmepumpe gesamt - ohne PV"
      - unique_id: euro_pro_stunde_kuchengerate_ohne_kuhlschrank_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_kuchengerate_ohne_kuhlschrank') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Küchengeräte ohne Kühlschrank - ohne PV"
      - unique_id: euro_pro_stunde_kuhlgerate_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_kuhlgerate') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Kühlgeräte - ohne PV"
      - unique_id: euro_pro_stunde_multimedia_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_multimedia') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Multimedia - ohne PV"
      - unique_id: euro_pro_stunde_waschmaschine_und_trockner_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_waschmaschine_und_trockner') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Waschmaschine und Trockner - ohne PV"
      - unique_id: euro_pro_stunde_haustechnik_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_haustechnik') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Haustechnik - ohne PV"
      - unique_id: euro_pro_stunde_netzwerk_telefon_und_computer_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_netzwerk_telefon_und_computer') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Netzwerk Telefon und Computer - ohne PV"
      - unique_id: euro_pro_stunde_luftentfeuchter_und_befeuchter_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_luftentfeuchter_und_befeuchter') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Luftentfeuchter und Befeuchter - ohne PV"
      - unique_id: euro_pro_stunde_heizung_partyraum_ohne_pv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_heizung_partyraum') | float(0) * states('input_number.strompreis') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Heizung Partyraum - ohne PV"
      # Euro pro Stunde mit PV - effektiv
      - unique_id: euro_pro_stunde_bekannte_verbraucher_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_bekannte_verbraucher') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde bekannte Verbraucher - mit PV - effektiv"
      - unique_id: euro_pro_stunde_unbekannte_verbraucher_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_unbekannte_verbraucher') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde unbekannte Verbraucher - mit PV - effektiv"
      - unique_id: euro_pro_stunde_verbrauch_gesamt_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_verbrauch_gesamt') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Verbrauch gesamt - mit PV - effektiv"
      - unique_id: euro_pro_stunde_alle_lichter_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_alle_lichter') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde alle Lichter - mit PV - effektiv"
      - unique_id: euro_pro_stunde_waermepumpe_gesamt_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_warmepumpe_gesamt') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Wärmepumpe gesamt - mit PV - effektiv"
      - unique_id: euro_pro_stunde_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_kuchengerate_ohne_kuhlschrank') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Küchengeräte ohne Kühlschrank - mit PV - effektiv"
      - unique_id: euro_pro_stunde_kuhlgerate_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_kuhlgerate') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Kühlgeräte - mit PV - effektiv"
      - unique_id: euro_pro_stunde_multimedia_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_multimedia') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Multimedia - mit PV - effektiv"
      - unique_id: euro_pro_stunde_waschmaschine_und_trockner_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_waschmaschine_und_trockner') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Waschmaschine und Trockner - mit PV - effektiv"
      - unique_id: euro_pro_stunde_haustechnik_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_haustechnik') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Haustechnik - mit PV - effektiv"
      - unique_id: euro_pro_stunde_netzwerk_telefon_und_computer_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_netzwerk_telefon_und_computer') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Netzwerk Telefon und Computer - mit PV - effektiv"
      - unique_id: euro_pro_stunde_luftentfeuchter_und_befeuchter_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_luftentfeuchter_und_befeuchter') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Luftentfeuchter und Befeuchter - mit PV - effektiv"
      - unique_id: euro_pro_stunde_heizung_partyraum_mit_pv_effektiv
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_heizung_partyraum') | float(0) * states('sensor.strompreis_aktuell_effektiv_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Heizung Partyraum - mit PV - effektiv"
      # Euro pro Stunde mit PV - Abrechnung
      - unique_id: euro_pro_stunde_bekannte_verbraucher_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_bekannte_verbraucher') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde bekannte Verbraucher - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_unbekannte_verbraucher_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_unbekannte_verbraucher') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde unbekannte Verbraucher - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_verbrauch_gesamt_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_verbrauch_gesamt') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Verbrauch gesamt - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_alle_lichter_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_alle_lichter') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde alle Lichter - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_waermepumpe_gesamt_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_warmepumpe_gesamt') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Wärmepumpe gesamt - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_kuchengerate_ohne_kuhlschrank') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Küchengeräte ohne Kühlschrank - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_kuhlgerate_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_kuhlgerate') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Kühlgeräte - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_multimedia_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_multimedia') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Multimedia - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_waschmaschine_und_trockner_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_waschmaschine_und_trockner') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Waschmaschine und Trockner - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_haustechnik_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_haustechnik') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Haustechnik - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_netzwerk_telefon_und_computer_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_netzwerk_telefon_und_computer') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Netzwerk Telefon und Computer - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_luftentfeuchter_und_befeuchter') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Luftentfeuchter und Befeuchter - mit PV - Abrechnung"
      - unique_id: euro_pro_stunde_heizung_partyraum_mit_pv_abrechnung
        unit_of_measurement: "€/h"
        state: >
          {{ (states('sensor.el_leistung_powercalc_heizung_partyraum') | float(0) * states('sensor.strompreis_aktuell_abrechnung_euro') | float(0)) / 1000 }}
        attributes:
          friendly_name: "Euro pro Stunde Heizung Partyraum - mit PV - Abrechnung"
      # ---------------------------------
      # ------ Einsparung durch PV ------
      # ---------------------------------
      # --- heute ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_daily') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_daily') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_heute
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_daily') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_daily') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt heute"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_daily') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_daily') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- gestern ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_gestern
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_daily','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_daily','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt gestern"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_daily','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_daily','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- aktueller Monat ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_aktueller_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_monthly') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt aktueller Monat"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_monthly') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- letzter Monat ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_letzter_monat
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_monthly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt letzter Monat"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_monthly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_monthly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- dieses Jahr ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_dieses_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_yearly') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt dieses Jahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_yearly') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- letztes Jahr ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_letztes_jahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_yearly','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt letztes Jahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_yearly','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_yearly','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- dieses Winterjahr ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_alle_lichter_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_alle_lichter_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_kuhlgerate_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_kuhlgerate_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_multimedia_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_multimedia_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_haustechnik_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_haustechnik_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_heizung_partyraum_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_heizung_partyraum_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_dieses_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_winteryear') %}
          {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt dieses Winterjahr"
          prozent: >
            {% set cost_with_pv = states('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_winteryear') %}
            {% set cost_without_pv = states('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      # --- letztes Winterjahr ---
      - unique_id: einsparung_bekannte_verbraucher_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung bekannte Verbraucher letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung alle Lichter letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Wärmepumpe gesamt letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Küchengeräte ohne Kühlschrank letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Kühlgeräte letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Multimedia letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Waschmaschine und Trockner letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Haustechnik letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Netzwerk Telefon und Computer letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Luftentfeuchter und Befeuchter letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Heizung Partyraum letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Unbekannte Verbraucher letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_abrechnung_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV Abrechnung Verbrauch gesamt letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_abrechnung_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_bekannte_verbraucher_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv bekannte Verbraucher letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_bekannte_verbraucher_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_bekannte_verbraucher_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_alle_lichter_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv alle Lichter letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_alle_lichter_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_alle_lichter_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_warmepumpe_gesamt_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Wärmepumpe gesamt letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waermepumpe_gesamt_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waermepumpe_gesamt_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuchengerate_ohne_kuhlschrank_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Küchengeräte ohne Kühlschrank letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_kuhlgerate_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Kühlgeräte letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_kuhlgerate_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_kuhlgerate_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_multimedia_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Multimedia letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_multimedia_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_multimedia_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_waschmaschine_und_trockner_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Waschmaschine und Trockner letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_waschmaschine_und_trockner_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_haustechnik_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Haustechnik letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_haustechnik_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_haustechnik_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_netzwerk_telefon_und_computer_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Netzwerk Telefon und Computer letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_luftentfeuchter_und_befeuchter_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Luftentfeuchter und Befeuchter letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_heizung_partyraum_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Heizung Partyraum letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_heizung_partyraum_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_heizung_partyraum_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_unbekannte_verbraucher_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Unbekannte Verbraucher letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_unbekannte_verbraucher_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_unbekannte_verbraucher_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}
      - unique_id: einsparung_verbrauch_gesamt_effektiv_letztes_winterjahr
        unit_of_measurement: "€"
        state: >
          {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_winteryear','last_period') %}
          {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear','last_period') %}
          {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) %}
            {{ 0 }}
          {% else %}
            {{ ((cost_without_pv | float(0)) - (cost_with_pv | float(0))) | round(2) }}
          {% endif %}
        attributes:
          friendly_name: "Einsparung PV effektiv Verbrauch gesamt letztes Winterjahr"
          prozent: >
            {% set cost_with_pv = state_attr('sensor.kosten_verbrauch_gesamt_mit_pv_effektiv_winteryear','last_period') %}
            {% set cost_without_pv = state_attr('sensor.kosten_verbrauch_gesamt_ohne_pv_winteryear','last_period') %}
            {% if (cost_without_pv in ['unavailable', 'unknown', 'none']) or (cost_with_pv in ['unavailable', 'unknown', 'none']) or ((cost_without_pv | float(0)) == 0) or ((cost_with_pv | float(0)) > (cost_without_pv | float(0))) %}
              {{ 0 }}
            {% else %}
              {{ (100 * (1 - (cost_with_pv | float(0) / cost_without_pv | float(1)))) | round(0) }}
            {% endif %}

utility_meter:
  # ------ Verbrauch Winterjahr ------
  stromzahler_powercalc_bekannte_verbraucher_winteryear:
    source: sensor.stromzahler_powercalc_bekannte_verbraucher
    cron: "0 0 1 7 *"
  stromzahler_powercalc_alle_lichter_winteryear:
    source: sensor.stromzahler_powercalc_alle_lichter
    cron: "0 0 1 7 *"
  stromzahler_powercalc_warmepumpe_gesamt_winteryear:
    source: sensor.stromzahler_powercalc_warmepumpe_gesamt
    cron: "0 0 1 7 *"
  stromzahler_powercalc_kuchengerate_ohne_kuhlschrank_winteryear:
    source: sensor.stromzahler_powercalc_kuchengerate_ohne_kuhlschrank
    cron: "0 0 1 7 *"
  stromzahler_powercalc_kuhlgerate_winteryear:
    source: sensor.stromzahler_powercalc_kuhlgerate
    cron: "0 0 1 7 *"
  stromzahler_powercalc_multimedia_winteryear:
    source: sensor.stromzahler_powercalc_multimedia
    cron: "0 0 1 7 *"
  stromzahler_powercalc_waschmaschine_und_trockner_winteryear:
    source: sensor.stromzahler_powercalc_waschmaschine_und_trockner
    cron: "0 0 1 7 *"
  stromzahler_powercalc_haustechnik_winteryear:
    source: sensor.stromzahler_powercalc_haustechnik
    cron: "0 0 1 7 *"
  stromzahler_powercalc_netzwerk_telefon_und_computer_winteryear:
    source: sensor.stromzahler_powercalc_netzwerk_telefon_und_computer
    cron: "0 0 1 7 *"
  stromzahler_powercalc_luftentfeuchter_und_befeuchter_winteryear:
    source: sensor.stromzahler_powercalc_luftentfeuchter_und_befeuchter
    cron: "0 0 1 7 *"
  stromzahler_powercalc_heizung_partyraum_winteryear:
    source: sensor.stromzahler_powercalc_heizung_partyraum
    cron: "0 0 1 7 *"
  stromzahler_powercalc_unbekannte_verbraucher_winteryear:
    source: sensor.stromzahler_powercalc_unbekannte_verbraucher
    cron: "0 0 1 7 *"
  stromzahler_powercalc_verbrauch_gesamt_winteryear:
    source: sensor.stromzahler_powercalc_verbrauch_gesamt
    cron: "0 0 1 7 *"
  stromzahler_powercalc_pv_leistung_winteryear:
    source: sensor.stromzahler_powercalc_pv_leistung
    cron: "0 0 1 7 *"
  stromzahler_powercalc_pv_einspeisung_winteryear:
    source: sensor.stromzahler_powercalc_pv_einspeisung
    cron: "0 0 1 7 *"
  # ------ Kosten ------
  # --- ohne PV ---
  # daily
  kosten_alle_lichter_ohne_pv_daily:
    source: sensor.kostenzaehler_alle_lichter_ohne_pv
    cycle: daily
  kosten_bekannte_verbraucher_ohne_pv_daily:
    source: sensor.kostenzaehler_bekannte_verbraucher_ohne_pv
    cycle: daily
  kosten_haustechnik_ohne_pv_daily:
    source: sensor.kostenzaehler_haustechnik_ohne_pv
    cycle: daily
  kosten_heizung_partyraum_ohne_pv_daily:
    source: sensor.kostenzaehler_heizung_partyraum_ohne_pv
    cycle: daily
  kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_daily:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_ohne_pv
    cycle: daily
  kosten_kuhlgerate_ohne_pv_daily:
    source: sensor.kostenzaehler_kuhlgerate_ohne_pv
    cycle: daily
  kosten_luftentfeuchter_und_befeuchter_ohne_pv_daily:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_ohne_pv
    cycle: daily
  kosten_multimedia_ohne_pv_daily:
    source: sensor.kostenzaehler_multimedia_ohne_pv
    cycle: daily
  kosten_netzwerk_telefon_und_computer_ohne_pv_daily:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_ohne_pv
    cycle: daily
  kosten_unbekannte_verbraucher_ohne_pv_daily:
    source: sensor.kostenzaehler_unbekannte_verbraucher_ohne_pv
    cycle: daily
  kosten_verbrauch_gesamt_ohne_pv_daily:
    source: sensor.kostenzaehler_verbrauch_gesamt_ohne_pv
    cycle: daily
  kosten_waermepumpe_gesamt_ohne_pv_daily:
    source: sensor.kostenzaehler_waermepumpe_gesamt_ohne_pv
    cycle: daily
  kosten_waschmaschine_und_trockner_ohne_pv_daily:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_ohne_pv
    cycle: daily
  # monthly
  kosten_alle_lichter_ohne_pv_monthly:
    source: sensor.kostenzaehler_alle_lichter_ohne_pv
    cycle: monthly
  kosten_bekannte_verbraucher_ohne_pv_monthly:
    source: sensor.kostenzaehler_bekannte_verbraucher_ohne_pv
    cycle: monthly
  kosten_haustechnik_ohne_pv_monthly:
    source: sensor.kostenzaehler_haustechnik_ohne_pv
    cycle: monthly
  kosten_heizung_partyraum_ohne_pv_monthly:
    source: sensor.kostenzaehler_heizung_partyraum_ohne_pv
    cycle: monthly
  kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_monthly:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_ohne_pv
    cycle: monthly
  kosten_kuhlgerate_ohne_pv_monthly:
    source: sensor.kostenzaehler_kuhlgerate_ohne_pv
    cycle: monthly
  kosten_luftentfeuchter_und_befeuchter_ohne_pv_monthly:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_ohne_pv
    cycle: monthly
  kosten_multimedia_ohne_pv_monthly:
    source: sensor.kostenzaehler_multimedia_ohne_pv
    cycle: monthly
  kosten_netzwerk_telefon_und_computer_ohne_pv_monthly:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_ohne_pv
    cycle: monthly
  kosten_unbekannte_verbraucher_ohne_pv_monthly:
    source: sensor.kostenzaehler_unbekannte_verbraucher_ohne_pv
    cycle: monthly
  kosten_verbrauch_gesamt_ohne_pv_monthly:
    source: sensor.kostenzaehler_verbrauch_gesamt_ohne_pv
    cycle: monthly
  kosten_waermepumpe_gesamt_ohne_pv_monthly:
    source: sensor.kostenzaehler_waermepumpe_gesamt_ohne_pv
    cycle: monthly
  kosten_waschmaschine_und_trockner_ohne_pv_monthly:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_ohne_pv
    cycle: monthly
  # yearly
  kosten_alle_lichter_ohne_pv_yearly:
    source: sensor.kostenzaehler_alle_lichter_ohne_pv
    cycle: yearly
  kosten_bekannte_verbraucher_ohne_pv_yearly:
    source: sensor.kostenzaehler_bekannte_verbraucher_ohne_pv
    cycle: yearly
  kosten_haustechnik_ohne_pv_yearly:
    source: sensor.kostenzaehler_haustechnik_ohne_pv
    cycle: yearly
  kosten_heizung_partyraum_ohne_pv_yearly:
    source: sensor.kostenzaehler_heizung_partyraum_ohne_pv
    cycle: yearly
  kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_yearly:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_ohne_pv
    cycle: yearly
  kosten_kuhlgerate_ohne_pv_yearly:
    source: sensor.kostenzaehler_kuhlgerate_ohne_pv
    cycle: yearly
  kosten_luftentfeuchter_und_befeuchter_ohne_pv_yearly:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_ohne_pv
    cycle: yearly
  kosten_multimedia_ohne_pv_yearly:
    source: sensor.kostenzaehler_multimedia_ohne_pv
    cycle: yearly
  kosten_netzwerk_telefon_und_computer_ohne_pv_yearly:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_ohne_pv
    cycle: yearly
  kosten_unbekannte_verbraucher_ohne_pv_yearly:
    source: sensor.kostenzaehler_unbekannte_verbraucher_ohne_pv
    cycle: yearly
  kosten_verbrauch_gesamt_ohne_pv_yearly:
    source: sensor.kostenzaehler_verbrauch_gesamt_ohne_pv
    cycle: yearly
  kosten_waermepumpe_gesamt_ohne_pv_yearly:
    source: sensor.kostenzaehler_waermepumpe_gesamt_ohne_pv
    cycle: yearly
  kosten_waschmaschine_und_trockner_ohne_pv_yearly:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_ohne_pv
    cycle: yearly
  # winteryear
  kosten_alle_lichter_ohne_pv_winteryear:
    source: sensor.kostenzaehler_alle_lichter_ohne_pv
    cron: "0 0 1 7 *"
  kosten_bekannte_verbraucher_ohne_pv_winteryear:
    source: sensor.kostenzaehler_bekannte_verbraucher_ohne_pv
    cron: "0 0 1 7 *"
  kosten_haustechnik_ohne_pv_winteryear:
    source: sensor.kostenzaehler_haustechnik_ohne_pv
    cron: "0 0 1 7 *"
  kosten_heizung_partyraum_ohne_pv_winteryear:
    source: sensor.kostenzaehler_heizung_partyraum_ohne_pv
    cron: "0 0 1 7 *"
  kosten_kuchengerate_ohne_kuhlschrank_ohne_pv_winteryear:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_ohne_pv
    cron: "0 0 1 7 *"
  kosten_kuhlgerate_ohne_pv_winteryear:
    source: sensor.kostenzaehler_kuhlgerate_ohne_pv
    cron: "0 0 1 7 *"
  kosten_luftentfeuchter_und_befeuchter_ohne_pv_winteryear:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_ohne_pv
    cron: "0 0 1 7 *"
  kosten_multimedia_ohne_pv_winteryear:
    source: sensor.kostenzaehler_multimedia_ohne_pv
    cron: "0 0 1 7 *"
  kosten_netzwerk_telefon_und_computer_ohne_pv_winteryear:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_ohne_pv
    cron: "0 0 1 7 *"
  kosten_unbekannte_verbraucher_ohne_pv_winteryear:
    source: sensor.kostenzaehler_unbekannte_verbraucher_ohne_pv
    cron: "0 0 1 7 *"
  kosten_verbrauch_gesamt_ohne_pv_winteryear:
    source: sensor.kostenzaehler_verbrauch_gesamt_ohne_pv
    cron: "0 0 1 7 *"
  kosten_waermepumpe_gesamt_ohne_pv_winteryear:
    source: sensor.kostenzaehler_waermepumpe_gesamt_ohne_pv
    cron: "0 0 1 7 *"
  kosten_waschmaschine_und_trockner_ohne_pv_winteryear:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_ohne_pv
    cron: "0 0 1 7 *"
  # --- mit PV - effektiv ---
  # daily
  kosten_alle_lichter_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_effektiv
    cycle: daily
  kosten_bekannte_verbraucher_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_effektiv
    cycle: daily
  kosten_haustechnik_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_haustechnik_mit_pv_effektiv
    cycle: daily
  kosten_heizung_partyraum_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_effektiv
    cycle: daily
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
    cycle: daily
  kosten_kuhlgerate_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_effektiv
    cycle: daily
  kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_effektiv
    cycle: daily
  kosten_multimedia_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_multimedia_mit_pv_effektiv
    cycle: daily
  kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_effektiv
    cycle: daily
  kosten_unbekannte_verbraucher_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_effektiv
    cycle: daily
  kosten_verbrauch_gesamt_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_effektiv
    cycle: daily
  kosten_waermepumpe_gesamt_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_effektiv
    cycle: daily
  kosten_waschmaschine_und_trockner_mit_pv_effektiv_daily:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_effektiv
    cycle: daily
  # monthly
  kosten_alle_lichter_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_effektiv
    cycle: monthly
  kosten_bekannte_verbraucher_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_effektiv
    cycle: monthly
  kosten_haustechnik_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_haustechnik_mit_pv_effektiv
    cycle: monthly
  kosten_heizung_partyraum_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_effektiv
    cycle: monthly
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
    cycle: monthly
  kosten_kuhlgerate_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_effektiv
    cycle: monthly
  kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_effektiv
    cycle: monthly
  kosten_multimedia_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_multimedia_mit_pv_effektiv
    cycle: monthly
  kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_effektiv
    cycle: monthly
  kosten_unbekannte_verbraucher_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_effektiv
    cycle: monthly
  kosten_verbrauch_gesamt_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_effektiv
    cycle: monthly
  kosten_waermepumpe_gesamt_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_effektiv
    cycle: monthly
  kosten_waschmaschine_und_trockner_mit_pv_effektiv_monthly:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_effektiv
    cycle: monthly
  # yearly
  kosten_alle_lichter_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_effektiv
    cycle: yearly
  kosten_bekannte_verbraucher_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_effektiv
    cycle: yearly
  kosten_haustechnik_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_haustechnik_mit_pv_effektiv
    cycle: yearly
  kosten_heizung_partyraum_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_effektiv
    cycle: yearly
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
    cycle: yearly
  kosten_kuhlgerate_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_effektiv
    cycle: yearly
  kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_effektiv
    cycle: yearly
  kosten_multimedia_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_multimedia_mit_pv_effektiv
    cycle: yearly
  kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_effektiv
    cycle: yearly
  kosten_unbekannte_verbraucher_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_effektiv
    cycle: yearly
  kosten_verbrauch_gesamt_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_effektiv
    cycle: yearly
  kosten_waermepumpe_gesamt_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_effektiv
    cycle: yearly
  kosten_waschmaschine_und_trockner_mit_pv_effektiv_yearly:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_effektiv
    cycle: yearly
  # winteryear
  kosten_alle_lichter_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_bekannte_verbraucher_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_haustechnik_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_haustechnik_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_heizung_partyraum_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_kuhlgerate_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_luftentfeuchter_und_befeuchter_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_multimedia_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_multimedia_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_netzwerk_telefon_und_computer_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_unbekannte_verbraucher_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_verbrauch_gesamt_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_waermepumpe_gesamt_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_effektiv
    cron: "0 0 1 7 *"
  kosten_waschmaschine_und_trockner_mit_pv_effektiv_winteryear:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_effektiv
    cron: "0 0 1 7 *"
  # --- mit PV - Abrechnung ---
  # daily
  kosten_alle_lichter_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_abrechnung
    cycle: daily
  kosten_bekannte_verbraucher_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_abrechnung
    cycle: daily
  kosten_haustechnik_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_haustechnik_mit_pv_abrechnung
    cycle: daily
  kosten_heizung_partyraum_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_abrechnung
    cycle: daily
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
    cycle: daily
  kosten_kuhlgerate_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_abrechnung
    cycle: daily
  kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
    cycle: daily
  kosten_multimedia_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_multimedia_mit_pv_abrechnung
    cycle: daily
  kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_abrechnung
    cycle: daily
  kosten_unbekannte_verbraucher_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_abrechnung
    cycle: daily
  kosten_verbrauch_gesamt_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_abrechnung
    cycle: daily
  kosten_waermepumpe_gesamt_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_abrechnung
    cycle: daily
  kosten_waschmaschine_und_trockner_mit_pv_abrechnung_daily:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_abrechnung
    cycle: daily
  # monthly
  kosten_alle_lichter_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_abrechnung
    cycle: monthly
  kosten_bekannte_verbraucher_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_abrechnung
    cycle: monthly
  kosten_haustechnik_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_haustechnik_mit_pv_abrechnung
    cycle: monthly
  kosten_heizung_partyraum_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_abrechnung
    cycle: monthly
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
    cycle: monthly
  kosten_kuhlgerate_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_abrechnung
    cycle: monthly
  kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
    cycle: monthly
  kosten_multimedia_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_multimedia_mit_pv_abrechnung
    cycle: monthly
  kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_abrechnung
    cycle: monthly
  kosten_unbekannte_verbraucher_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_abrechnung
    cycle: monthly
  kosten_verbrauch_gesamt_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_abrechnung
    cycle: monthly
  kosten_waermepumpe_gesamt_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_abrechnung
    cycle: monthly
  kosten_waschmaschine_und_trockner_mit_pv_abrechnung_monthly:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_abrechnung
    cycle: monthly
  # yearly
  kosten_alle_lichter_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_abrechnung
    cycle: yearly
  kosten_bekannte_verbraucher_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_abrechnung
    cycle: yearly
  kosten_haustechnik_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_haustechnik_mit_pv_abrechnung
    cycle: yearly
  kosten_heizung_partyraum_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_abrechnung
    cycle: yearly
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
    cycle: yearly
  kosten_kuhlgerate_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_abrechnung
    cycle: yearly
  kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
    cycle: yearly
  kosten_multimedia_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_multimedia_mit_pv_abrechnung
    cycle: yearly
  kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_abrechnung
    cycle: yearly
  kosten_unbekannte_verbraucher_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_abrechnung
    cycle: yearly
  kosten_verbrauch_gesamt_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_abrechnung
    cycle: yearly
  kosten_waermepumpe_gesamt_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_abrechnung
    cycle: yearly
  kosten_waschmaschine_und_trockner_mit_pv_abrechnung_yearly:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_abrechnung
    cycle: yearly
  # winteryear
  kosten_alle_lichter_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_alle_lichter_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_bekannte_verbraucher_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_bekannte_verbraucher_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_haustechnik_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_haustechnik_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_heizung_partyraum_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_heizung_partyraum_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_kuchengerate_ohne_kuhlschrank_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_kuhlgerate_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_kuhlgerate_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_luftentfeuchter_und_befeuchter_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_luftentfeuchter_und_befeuchter_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_multimedia_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_multimedia_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_netzwerk_telefon_und_computer_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_netzwerk_telefon_und_computer_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_unbekannte_verbraucher_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_unbekannte_verbraucher_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_verbrauch_gesamt_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_verbrauch_gesamt_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_waermepumpe_gesamt_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_waermepumpe_gesamt_mit_pv_abrechnung
    cron: "0 0 1 7 *"
  kosten_waschmaschine_und_trockner_mit_pv_abrechnung_winteryear:
    source: sensor.kostenzaehler_waschmaschine_und_trockner_mit_pv_abrechnung
    cron: "0 0 1 7 *"
