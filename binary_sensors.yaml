# --- Praesenz ---
# Küche
  - platform: knx
    state_address: '6/0/9'
    name: PM_E_KU_Küche
    device_class: motion
  - platform: knx
    state_address: '6/0/23'
    name: PM_E_KU_Bar_EZ
    device_class: motion
  - platform: knx
    state_address: '14/0/3'
    name: Wasser unter Spüle
    device_class: problem

# Esszimmer
  - platform: knx
    state_address: '6/0/137'
    name: PM_E_EZ_Bar_Küche
    device_class: motion
  - platform: knx
    state_address: '6/0/151'
    name: PM_E_EZ_Esstisch
    device_class: motion
  - platform: knx
    state_address: '11/0/0'
    name: HST offen
    device_class: door

# Wohnzimmer
  - platform: knx
    state_address: '6/1/9'
    name: PM_E_WZ_Durchgang
    device_class: motion
  - platform: knx
    state_address: '6/1/23'
    name: PM_E_WZ_Couch_links
    device_class: motion
  - platform: knx
    state_address: '6/1/37'
    name: PM_E_WZ_Couch_rechts
    device_class: motion

# Schlafzimmer
  - platform: knx
    state_address: '6/1/137'
    name: PM_E_SZ_Gang
    device_class: motion
  - platform: knx
    state_address: '6/1/151'
    name: PM_E_SZ_Bett
    device_class: motion

# Bad EG
  - platform: knx
    state_address: '6/2/9'
    name: PM_E_BA
    device_class: motion

# Flur EG
  - platform: knx
    state_address: '6/2/137'
    name: PM_E_FL_Flur
    device_class: motion
  - platform: knx
    state_address: '6/2/151'
    name: PM_E_FL_Treppe_OG
    device_class: motion
  - platform: knx
    state_address: '6/2/165'
    name: PM_E_FL_Windfang
    device_class: motion

# Windfang
  - platform: knx
    state_address: '6/3/9'
    name: PM_E_WF_Haustür
    device_class: motion
  - platform: knx
    state_address: '6/3/23'
    name: PM_E_WF_Garderobe
    device_class: motion
  - platform: knx
    state_address: '6/3/37'
    name: PM_E_WF_Flur
    device_class: motion

# WC
  - platform: knx
    state_address: '6/3/137'
    name: PM_E_WC
    device_class: motion

# Kellertreppe
  - platform: knx
    state_address: '8/0/1'
    name: PM_KTr_Treppe
    device_class: motion
  - platform: knx
    state_address: '8/0/0'
    name: PM_KTr_Flur
    device_class: motion

# La
  - platform: knx
    state_address: '7/0/9'
    name: PM_O_KO_La_Raum
    device_class: motion
  - platform: knx
    state_address: '7/0/23'
    name: PM_O_KO_La_Tuer
    device_class: motion

# Nähzimmer
  - platform: knx
    state_address: '7/0/137'
    name: PM_O_NZ
    device_class: motion

# Le
  - platform: knx
    state_address: '7/1/9'
    name: PM_O_KW_Le_Raum
    device_class: motion
  - platform: knx
    state_address: '7/1/23'
    name: PM_O_KW_Le_Tuer
    device_class: motion

# Gästezimmer
  - platform: knx
    state_address: '7/1/137'
    name: PM_O_GZ
    device_class: motion

# Flur OG
  - platform: knx
    state_address: '7/2/9'
    name: PM_O_FL_Flur
    device_class: motion
  - platform: knx
    state_address: '7/2/23'
    name: PM_O_FL_Treppe
    device_class: motion
  - platform: knx
    state_address: '15/0/41'
    name: O FL Logik Bewegung rund um Treppe
    device_class: motion
  - platform: knx
    state_address: '15/0/42'
    name: O FL Logik Min Ein Kind schläft

# Bad OG
  - platform: knx
    state_address: '7/2/137'
    name: PM_O_BA
    device_class: motion

# Keller
  - platform: knx
    state_address: '0/1/100'
    name: PM_K_FL
    device_class: motion
  - platform: knx
    state_address:  '0/1/120'
    name: PM_K_TE
    device_class: motion
  - platform: knx
    state_address: '14/0/1'
    name: Eimer Hebeanlage voll
    device_class: problem
  - platform: knx
    state_address: '14/0/2'
    name: Wasser Boden bei Hebeanlage
    device_class: problem
  - platform: knx
    state_address: '14/0/4'
    name: Sicherung Keller SD rausgeflogen
    device_class: problem

# Aussen
  - platform: knx
    state_address: '8/0/60'
    name: PM_A_EG
    device_class: motion
  - platform: knx
    state_address: '8/0/80'
    name: PM_A_CP
    device_class: motion
  - platform: knx
    state_address: '8/0/100'
    name: PM_A_AR
    device_class: motion

# --- Wetter ---
  - platform: knx
    state_address: '13/0/4'
    name: Windalarm 1
  - platform: knx
    state_address: '13/0/5'
    name: Windalarm 2
  - platform: knx
    state_address: '13/0/6'
    name: Windalarm 3
  - platform: knx
    state_address: '13/0/3'
    name: Tag-Nacht Wetterstation
  - platform: knx
    state_address: '13/0/7'
    name: Regenalarm
  - platform: knx
    state_address: '13/0/8'
    name: Temperaturalarm Wetterstation
    device_class: cold
  - platform: knx
    state_address: '13/0/13'
    name: Wetterstation Status GPS-Signal
    device_class: power
  - platform: knx
    state_address: '13/0/28'
    name: Status Waermeschutz
  - platform: knx
    state_address: '13/0/29'
    name: Status Waermegewinnung

# --- Heizung ---
  - platform: knx
    state_address: '10/7/1'
    name: Heizungsanforderung EG
  - platform: knx
    state_address: '10/7/2'
    name: Heizungsanforderung OG
  - platform: knx
    state_address: '10/7/4'
    name: Störung Heizaktor EG
    device_class: problem
  - platform: knx
    state_address: '10/7/5'
    name: Störung Heizaktor OG
    device_class: problem

# --- Dimm-Aktoren ---
  - platform: knx
    state_address: '1/7/201'
    name: Status 24V LED-Aktor 1
    device_class: power
  - platform: knx
    state_address: '1/7/202'
    name: Status 24V LED-Aktor 2
    device_class: power
  - platform: knx
    state_address: '1/7/203'
    name: Status 24V LED-Aktor 3
    device_class: power
  - platform: knx
    state_address: '1/7/204'
    name: Status 24V LED-Aktor 4
    device_class: power
  - platform: knx
    state_address: '1/7/205'
    name: Status 24V LED-Aktor 5
    device_class: power
  - platform: knx
    state_address: '1/7/206'
    name: Status 24V LED-Aktor 6
    device_class: power
  - platform: knx
    state_address: '1/7/207'
    name: Status 24V LED-Aktor 7
    device_class: power
  - platform: knx
    state_address: '1/7/211'
    name: Überstromalarm LED-Aktor 1
    device_class: problem
  - platform: knx
    state_address: '1/7/212'
    name: Überstromalarm LED-Aktor 2
    device_class: problem
  - platform: knx
    state_address: '1/7/213'
    name: Überstromalarm LED-Aktor 3
    device_class: problem
  - platform: knx
    state_address: '1/7/214'
    name: Überstromalarm LED-Aktor 4
    device_class: problem
  - platform: knx
    state_address: '1/7/215'
    name: Überstromalarm LED-Aktor 5
    device_class: problem
  - platform: knx
    state_address: '1/7/216'
    name: Überstromalarm LED-Aktor 6
    device_class: problem
  - platform: knx
    state_address: '1/7/217'
    name: Überstromalarm LED-Aktor 7
    device_class: problem
  - platform: knx
    state_address: '1/7/221'
    name: Übertemperaturalarm LED-Aktor 1
    device_class: problem
  - platform: knx
    state_address: '1/7/222'
    name: Übertemperaturalarm LED-Aktor 2
    device_class: problem
  - platform: knx
    state_address: '1/7/223'
    name: Übertemperaturalarm LED-Aktor 3
    device_class: problem
  - platform: knx
    state_address: '1/7/224'
    name: Übertemperaturalarm LED-Aktor 4
    device_class: problem
  - platform: knx
    state_address: '1/7/225'
    name: Übertemperaturalarm LED-Aktor 5
    device_class: problem
  - platform: knx
    state_address: '1/7/226'
    name: Übertemperaturalarm LED-Aktor 6
    device_class: problem
  - platform: knx
    state_address: '1/7/227'
    name: Übertemperaturalarm LED-Aktor 7
    device_class: problem

# --- connection ---
#  - platform: ping
#    host: 192.168.178.26
#    name: ping_bildschirm
#    count: 2
#    scan_interval: 2

# Time of Day
  - platform: tod
    name: TV Zeit Abend
    after: '19:00'
    before: '03:00'

# --- Template ---
  - platform: template
    sensors:
      la_und_le_schlafen:
        friendly_name: "Beide Mädels schlafen"
        value_template: >-
          {{ is_state('switch.la_schlaft', 'on')
             and is_state('switch.le_schlaft', 'on') }}
      la_oder_le_schlafen:
        friendly_name: "Min. 1 Kind schläft"
        value_template: >-
          {{ is_state('switch.la_schlaft', 'on')
             or is_state('switch.le_schlaft', 'on') }}
      alle_schlafen:
        friendly_name: "Alle schlafen"
        value_template: >-
          {{ is_state('switch.la_schlaft', 'on')
             and is_state('switch.le_schlaft', 'on')
             and is_state('switch.majo_schlafen', 'on') }}
      # On = in der letzten Stunde weniger als 10 Minuten wach
      schlafen_oder_aufwachphase_la:
        friendly_name: "Schlafen oder Aufwachphase La"
        value_template: "{{ states('sensor.anteil_la_wach_letzte_stunde')|float < 17 }}"
      schlafen_oder_aufwachphase_le:
        friendly_name: "Schlafen oder Aufwachphase Le"
        value_template: "{{ states('sensor.anteil_le_wach_letzte_stunde')|float < 17 }}"
      schlafen_oder_aufwachphase_majo:
        friendly_name: "Schlafen oder Aufwachphase MaJo"
        value_template: "{{ states('sensor.anteil_majo_wach_letzte_stunde')|float < 10 }}"
      tv_abends_an:
        friendly_name: "TV abends an"
        value_template: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('binary_sensor.tv_ist_an', 'on') }}
      tv_pizza_abend:
        friendly_name: "TV Pizza Abend"
        value_template: >-
          {{ is_state('binary_sensor.tv_abends_an', 'on')
             and is_state('binary_sensor.backofen_ist_an', 'on') }}
      kein_tv_pizza_abend: # Umkehrung von tv_pizza_abend für Panels Bar, Licht soll dann aus bleiben
        friendly_name: "kein TV Pizza Abend"
        value_template: >-
          {{ is_state('binary_sensor.tv_pizza_abend', 'off') }}
      tv_abend_ohne_pizza:
        friendly_name: "TV Abend ohne Pizza"
        value_template: >-
          {{ is_state('binary_sensor.tv_abends_an', 'on')
             and is_state('binary_sensor.backofen_ist_an', 'off') }}
      kodi_abends:
        friendly_name: "Kodi abends"
        value_template: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('media_player.kodi', 'playing') }}
      abends_und_min_ein_kind_im_bett:
        friendly_name: "abends und min. 1 Kind im Bett"
        value_template: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('binary_sensor.la_oder_le_schlafen', 'on') }}
      keine_gaeste:
        friendly_name: "keine Gäste"
        value_template: >-
          {{ is_state('input_boolean.gaeste_abends', 'off')
             and is_state('input_boolean.gaeste_gz', 'off') }}
      gaeste_nur_abends:
        friendly_name: "Gäste nur abends"
        value_template: >-
          {{ is_state('input_boolean.gaeste_abends', 'on')
             and is_state('input_boolean.gaeste_gz', 'off') }}
      jo_at_work:
        friendly_name: "Jo bei der Arbeit (binary)"
        value_template: "{{ is_state('input_text.location_jo_roh', 'Arbeit') }}"
      anwesenheit_bildschirm:
        friendly_name: "Anwesenheit Bildschirm"
        value_template: >-
          {{ is_state('binary_sensor.pm_e_ba', 'on')
             or is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
             or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
             or is_state('binary_sensor.pm_e_fl_flur', 'on')
             or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
             or is_state('binary_sensor.pm_e_ku_kuche', 'on')
             or is_state('binary_sensor.pm_e_wc', 'on')
             or is_state('binary_sensor.pm_e_wz_couch_links', 'on')
             or is_state('binary_sensor.pm_e_wz_couch_rechts', 'on')
             or is_state('binary_sensor.pm_e_wz_durchgang', 'on')
             or is_state('binary_sensor.pm_ktr_flur', 'on') }}
      anwesenheit_eg:
        friendly_name: "Anwesenheit EG"
        value_template: >-
          {{ is_state('binary_sensor.pm_e_ba', 'on')
             or is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
             or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
             or is_state('binary_sensor.pm_e_fl_flur', 'on')
             or is_state('binary_sensor.pm_e_fl_treppe_og', 'on')
             or is_state('binary_sensor.pm_e_fl_windfang', 'on')
             or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
             or is_state('binary_sensor.pm_e_ku_kuche', 'on')
             or is_state('binary_sensor.pm_e_sz_bett', 'on')
             or is_state('binary_sensor.pm_e_sz_gang', 'on')
             or is_state('binary_sensor.pm_e_wc', 'on')
             or is_state('binary_sensor.pm_e_wf_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_haustur', 'on')
             or is_state('binary_sensor.pm_e_wz_couch_links', 'on')
             or is_state('binary_sensor.pm_e_wz_couch_rechts', 'on')
             or is_state('binary_sensor.pm_e_wz_durchgang', 'on')
             or is_state('binary_sensor.pm_ktr_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_garderobe', 'on') }}
      anwesenheit_og:
        friendly_name: "Anwesenheit OG"
        value_template: >-
          {{ is_state('binary_sensor.pm_o_ba', 'on')
             or is_state('binary_sensor.pm_o_fl_flur', 'on')
             or is_state('binary_sensor.pm_o_fl_treppe', 'on')
             or is_state('binary_sensor.pm_o_gz', 'on')
             or is_state('binary_sensor.pm_o_ko_la_raum', 'on')
             or is_state('binary_sensor.pm_o_ko_la_tuer', 'on')
             or is_state('binary_sensor.pm_o_kw_le_raum', 'on')
             or is_state('binary_sensor.pm_o_kw_le_tuer', 'on')
             or is_state('binary_sensor.pm_o_nz', 'on') }}
      anwesenheit_haus:
        friendly_name: "Anwesenheit Haus"
        value_template: >-
          {{ is_state('binary_sensor.anwesenheit_eg', 'on')
             or is_state('binary_sensor.anwesenheit_og', 'on')
             or is_state('binary_sensor.pm_ktr_treppe', 'on') }}
      tv_ist_an:
        friendly_name: "TV an"
        value_template: "{{ states('sensor.el_leistung_tv')|float > 32 }}"
      mixi_ist_an:
        friendly_name: "Mixi an"
        value_template: "{{ states('sensor.el_leistung_mixi')|float > 5 }}"
      backofen_ist_an:
        friendly_name: "Backofen an"
        value_template: "{{ states('sensor.el_leistung_backofen')|float > 2 }}"
      waschmaschine_ist_an:
        friendly_name: "Waschmaschine läuft"
        value_template: "{{ states('sensor.el_leistung_waschmaschine')|float > 15 }}"
      trockner_ist_an:
        friendly_name: "Trockner läuft"
        value_template: "{{ states('sensor.el_leistung_trockner_float_average')|float > 80 }}"
      trockner_ist_geleert:
        friendly_name: "Trockner geleert"
        value_template: "{{ states('sensor.el_leistung_trockner')|float < 5 }}"
