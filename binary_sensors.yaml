# --- Praesenz ---
# Küche
  - platform: knx
    state_address: '6/0/9'
#    sync_state: False
    name: PM_E_KU_Küche
    device_class: motion
  - platform: knx
    state_address: '6/0/23'
#    sync_state: False
    name: PM_E_KU_Bar_EZ
    device_class: motion

# Esszimmer
  - platform: knx
    state_address: '6/0/137'
#    sync_state: False
    name: PM_E_EZ_Bar_Küche
    device_class: motion
  - platform: knx
    state_address: '6/0/151'
#    sync_state: False
    name: PM_E_EZ_Esstisch
    device_class: motion

# Wohnzimmer
  - platform: knx
    state_address: '6/1/9'
#    sync_state: False
    name: PM_E_WZ_Durchgang
    device_class: motion
  - platform: knx
    state_address: '6/1/23'
#    sync_state: False
    name: PM_E_WZ_Couch
    device_class: motion

# Schlafzimmer
  - platform: knx
    state_address: '6/1/137'
#    sync_state: False
    name: PM_E_SZ_Gang
    device_class: motion
  - platform: knx
    state_address: '6/1/151'
#    sync_state: False
    name: PM_E_SZ_Bett
    device_class: motion

# Bad EG
  - platform: knx
    state_address: '6/2/9'
#    sync_state: False
    name: PM_E_BA
    device_class: motion

# Flur EG
  - platform: knx
    state_address: '6/2/137'
#    sync_state: False
    name: PM_E_FL_Flur
    device_class: motion
  - platform: knx
    state_address: '6/2/151'
#    sync_state: False
    name: PM_E_FL_Treppe_OG
    device_class: motion
  - platform: knx
    state_address: '6/2/165'
#    sync_state: False
    name: PM_E_FL_Windfang
    device_class: motion

# Windfang
  - platform: knx
    state_address: '6/3/9'
#    sync_state: False
    name: PM_E_WF_Haustür
    device_class: motion
  - platform: knx
    state_address: '6/3/23'
#    sync_state: False
    name: PM_E_WF_Garderobe
    device_class: motion
  - platform: knx
    state_address: '6/3/37'
#    sync_state: False
    name: PM_E_WF_Flur
    device_class: motion

# WC
  - platform: knx
    state_address: '6/3/137'
#    sync_state: False
    name: PM_E_WC
    device_class: motion

# Kellertreppe
  - platform: knx
    state_address: '8/0/1'
#    sync_state: False
    name: PM_KTr_Treppe
    device_class: motion
  - platform: knx
    state_address: '8/0/0'
#    sync_state: False
    name: PM_KTr_Flur
    device_class: motion

# La
  - platform: knx
    state_address: '7/0/9'
#    sync_state: False
    name: PM_O_KO_La_Raum
    device_class: motion
  - platform: knx
    state_address: '7/0/23'
#    sync_state: False
    name: PM_O_KO_La_Tuer
    device_class: motion

# Nähzimmer
  - platform: knx
    state_address: '7/0/137'
#    sync_state: False
    name: PM_O_NZ
    device_class: motion

# Le
  - platform: knx
    state_address: '7/1/9'
#    sync_state: False
    name: PM_O_KW_Le_Raum
    device_class: motion
  - platform: knx
    state_address: '7/1/23'
#    sync_state: False
    name: PM_O_KW_Le_Tuer
    device_class: motion

# Gästezimmer
  - platform: knx
    state_address: '7/1/137'
#    sync_state: False
    name: PM_O_GZ
    device_class: motion

# Flur OG
  - platform: knx
    state_address: '7/2/9'
#    sync_state: False
    name: PM_O_FL_Flur
    device_class: motion
  - platform: knx
    state_address: '7/2/23'
#    sync_state: False
    name: PM_O_FL_Treppe
    device_class: motion
  - platform: knx
    state_address: '15/0/41'
#    sync_state: False
    name: O FL Logik Bewegung rund um Treppe
    device_class: motion
  - platform: knx
    state_address: '15/0/42'
#    sync_state: False
    name: O FL Logik Min Ein Kind schläft

# Bad OG
  - platform: knx
    state_address: '7/2/137'
#    sync_state: False
    name: PM_O_BA
    device_class: motion

# Keller
  - platform: knx
    state_address: '0/1/100'
#    sync_state: False
    name: PM_K_FL
    device_class: motion

# --- Wetter ---
  - platform: knx
    state_address: '13/0/4'
#    sync_state: False
    name: Windalarm 1
  - platform: knx
    state_address: '13/0/5'
#    sync_state: False
    name: Windalarm 2
  - platform: knx
    state_address: '13/0/6'
#    sync_state: False
    name: Windalarm 3
  - platform: knx
    state_address: '13/0/3'
#    sync_state: False
    name: Tag-Nacht Wetterstation
  - platform: knx
    state_address: '13/0/7'
#    sync_state: False
    name: Regenalarm
  - platform: knx
    state_address: '13/0/8'
#    sync_state: False
    name: Temperaturalarm Wetterstation
    device_class: cold
  - platform: knx
    state_address: '13/0/13'
#    sync_state: False
    name: Wetterstation Status GPS-Signal
    device_class: power
  - platform: knx
    state_address: '13/0/28'
#    sync_state: False
    name: Status Waermeschutz
  - platform: knx
    state_address: '13/0/29'
#    sync_state: False
    name: Status Waermegewinnung

# --- Heizung ---
  - platform: knx
    state_address: '10/7/1'
#    sync_state: False
    name: Heizungsanforderung EG
  - platform: knx
    state_address: '10/7/2'
#    sync_state: False
    name: Heizungsanforderung OG
  - platform: knx
    state_address: '10/7/4'
#    sync_state: False
    name: Störung Heizaktor EG
    device_class: problem
  - platform: knx
    state_address: '10/7/5'
#    sync_state: False
    name: Störung Heizaktor OG
    device_class: problem

# --- Dimm-Aktoren ---
  - platform: knx
    state_address: '1/7/201'
#    sync_state: False
    name: Status 24V LED-Aktor 1
    device_class: power
  - platform: knx
    state_address: '1/7/202'
#    sync_state: False
    name: Status 24V LED-Aktor 2
    device_class: power
  - platform: knx
    state_address: '1/7/203'
#    sync_state: False
    name: Status 24V LED-Aktor 3
    device_class: power
  - platform: knx
    state_address: '1/7/204'
#    sync_state: False
    name: Status 24V LED-Aktor 4
    device_class: power
  - platform: knx
    state_address: '1/7/205'
#    sync_state: False
    name: Status 24V LED-Aktor 5
    device_class: power
  - platform: knx
    state_address: '1/7/206'
#    sync_state: False
    name: Status 24V LED-Aktor 6
    device_class: power
  - platform: knx
    state_address: '1/7/207'
#    sync_state: False
    name: Status 24V LED-Aktor 7
    device_class: power
  - platform: knx
    state_address: '1/7/211'
#    sync_state: False
    name: Überstromalarm LED-Aktor 1
    device_class: problem
  - platform: knx
    state_address: '1/7/212'
#    sync_state: False
    name: Überstromalarm LED-Aktor 2
    device_class: problem
  - platform: knx
    state_address: '1/7/213'
#    sync_state: False
    name: Überstromalarm LED-Aktor 3
    device_class: problem
  - platform: knx
    state_address: '1/7/214'
#    sync_state: False
    name: Überstromalarm LED-Aktor 4
    device_class: problem
  - platform: knx
    state_address: '1/7/215'
#    sync_state: False
    name: Überstromalarm LED-Aktor 5
    device_class: problem
  - platform: knx
    state_address: '1/7/216'
#    sync_state: False
    name: Überstromalarm LED-Aktor 6
    device_class: problem
  - platform: knx
    state_address: '1/7/217'
#    sync_state: False
    name: Überstromalarm LED-Aktor 7
    device_class: problem
  - platform: knx
    state_address: '1/7/221'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 1
    device_class: problem
  - platform: knx
    state_address: '1/7/222'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 2
    device_class: problem
  - platform: knx
    state_address: '1/7/223'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 3
    device_class: problem
  - platform: knx
    state_address: '1/7/224'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 4
    device_class: problem
  - platform: knx
    state_address: '1/7/225'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 5
    device_class: problem
  - platform: knx
    state_address: '1/7/226'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 6
    device_class: problem
  - platform: knx
    state_address: '1/7/227'
#    sync_state: False
    name: Übertemperaturalarm LED-Aktor 7
    device_class: problem

# --- connection ---
#  - platform: ping
#    host: 192.168.178.26
#    name: ping_bildschirm
#    count: 2
#    scan_interval: 2

# Time of Day
  - platform: tod
    name: TV Zeit Abend
    after: '20:00'
    before: '03:00'

# --- Template ---
  - platform: template
    sensors:
      la_und_le_schlafen:
        friendly_name: "Beide Mädels schlafen"
        value_template: >-
          {{ is_state('switch.la_schlaft', 'on')
             and is_state('switch.le_schlaft', 'on') }}
      la_oder_le_schlafen:
        friendly_name: "Min. 1 Kind schläft"
        value_template: >-
          {{ is_state('switch.la_schlaft', 'on')
             or is_state('switch.le_schlaft', 'on') }}
      alle_schlafen:
        friendly_name: "Alle schlafen"
        value_template: >-
          {{ is_state('switch.la_schlaft', 'on')
             and is_state('switch.le_schlaft', 'on')
             and is_state('switch.majo_schlafen', 'on') }}
      # On = in der letzten Stunde weniger als 10 Minuten wach
      aufwachphase_la:
        friendly_name: "Aufwachphase La"
        value_template: "{{ states('sensor.anteil_la_wach_letzte_stunde')|float < 17
                            and is_state('switch.la_schlaft', 'off') }}"
      aufwachphase_le:
        friendly_name: "Aufwachphase Le"
        value_template: "{{ states('sensor.anteil_le_wach_letzte_stunde')|float < 17
                            and is_state('switch.le_schlaft', 'off') }}"
      aufwachphase_majo:
        friendly_name: "Aufwachphase MaJo"
        value_template: "{{ states('sensor.anteil_majo_wach_letzte_stunde')|float < 17
                            and is_state('switch.majo_schlafen', 'off') }}"
      tv_abends_an:
        friendly_name: "TV abends an"
        value_template: >-
          {{ is_state('binary_sensor.tv_zeit_abend', 'on')
             and is_state('binary_sensor.tv_ist_an', 'on') }}
      tv_pizza_abend:
        friendly_name: "TV Pizza Abend"
        value_template: >-
          {{ is_state('binary_sensor.tv_abends_an', 'on')
             and is_state('binary_sensor.backofen_ist_an', 'on') }}
      kein_tv_pizza_abend: # Umkehrung von tv_pizza_abend für Panels Bar, Licht soll dann aus bleiben
        friendly_name: "kein TV Pizza Abend"
        value_template: >-
          {{ is_state('binary_sensor.tv_pizza_abend', 'off') }}
      tv_abend_ohne_pizza:
        friendly_name: "TV Abend ohne Pizza"
        value_template: >-
          {{ is_state('binary_sensor.tv_abends_an', 'on')
             and is_state('binary_sensor.backofen_ist_an', 'off') }}
      anwesenheit_bildschirm:
        friendly_name: "Anwesenheit Bildschirm"
        value_template: >-
          {{ is_state('binary_sensor.pm_e_ba', 'on')
             or is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
             or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
             or is_state('binary_sensor.pm_e_fl_flur', 'on')
             or is_state('binary_sensor.pm_e_fl_treppe_og', 'on')
             or is_state('binary_sensor.pm_e_fl_windfang', 'on')
             or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
             or is_state('binary_sensor.pm_e_ku_kuche', 'on')
             or is_state('binary_sensor.pm_e_sz_gang', 'on')
             or is_state('binary_sensor.pm_e_wc', 'on')
             or is_state('binary_sensor.pm_e_wf_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_haustur', 'on')
             or is_state('binary_sensor.pm_e_wz_couch', 'on')
             or is_state('binary_sensor.pm_e_wz_durchgang', 'on')
             or is_state('binary_sensor.pm_ktr_flur', 'on')
             or is_state('binary_sensor.pm_ktr_treppe', 'on')
             or is_state('binary_sensor.pm_e_wf_garderobe', 'on') }}
      anwesenheit_eg:
        friendly_name: "Anwesenheit EG"
        value_template: >-
          {{ is_state('binary_sensor.pm_e_ba', 'on')
             or is_state('binary_sensor.pm_e_ez_bar_kuche', 'on')
             or is_state('binary_sensor.pm_e_ez_esstisch', 'on')
             or is_state('binary_sensor.pm_e_fl_flur', 'on')
             or is_state('binary_sensor.pm_e_fl_treppe_og', 'on')
             or is_state('binary_sensor.pm_e_fl_windfang', 'on')
             or is_state('binary_sensor.pm_e_ku_bar_ez', 'on')
             or is_state('binary_sensor.pm_e_ku_kuche', 'on')
             or is_state('binary_sensor.pm_e_sz_bett', 'on')
             or is_state('binary_sensor.pm_e_sz_gang', 'on')
             or is_state('binary_sensor.pm_e_wc', 'on')
             or is_state('binary_sensor.pm_e_wf_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_haustur', 'on')
             or is_state('binary_sensor.pm_e_wz_couch', 'on')
             or is_state('binary_sensor.pm_e_wz_durchgang', 'on')
             or is_state('binary_sensor.pm_ktr_flur', 'on')
             or is_state('binary_sensor.pm_e_wf_garderobe', 'on') }}
      anwesenheit_og:
        friendly_name: "Anwesenheit OG"
        value_template: >-
          {{ is_state('binary_sensor.pm_o_ba', 'on')
             or is_state('binary_sensor.pm_o_fl_flur', 'on')
             or is_state('binary_sensor.pm_o_fl_treppe', 'on')
             or is_state('binary_sensor.pm_o_gz', 'on')
             or is_state('binary_sensor.pm_o_ko_la_raum', 'on')
             or is_state('binary_sensor.pm_o_ko_la_tuer', 'on')
             or is_state('binary_sensor.pm_o_kw_le_raum', 'on')
             or is_state('binary_sensor.pm_o_kw_le_tuer', 'on')
             or is_state('binary_sensor.pm_o_nz', 'on') }}
      anwesenheit_haus:
        friendly_name: "Anwesenheit Haus"
        value_template: >-
          {{ is_state('binary_sensor.anwesenheit_eg', 'on')
             or is_state('binary_sensor.anwesenheit_og', 'on')
             or is_state('binary_sensor.pm_ktr_treppe', 'on') }}
      tv_ist_an:
        friendly_name: "TV an"
        value_template: "{{ states('sensor.el_leistung_tv')|float > 34 }}"
      mixi_ist_an:
        friendly_name: "Mixi an"
        value_template: "{{ states('sensor.el_leistung_mixi')|float > 5 }}"
      backofen_ist_an:
        friendly_name: "Backofen an"
        value_template: "{{ states('sensor.el_leistung_backofen')|float > 2 }}"
