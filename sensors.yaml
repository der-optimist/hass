#
# --------------------------------
# --                            --
# --          Template          --
# --                            --
# --------------------------------
#
  - platform: template
    sensors:
#
#     --------------------------------
#     --          Date              --
#     --------------------------------
#
      date_template:
        friendly_name: 'Datum'
        value_template: '{{ as_timestamp(now()) | timestamp_custom("%d.%m.%Y", True) }}'
#
#     --------------------------------
#     --    Temp. und Luftf.        --
#     --------------------------------
#
      temp_aussen:
        friendly_name: 'Temp. Außen'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.temp_wetterstation') }}"
        device_class: temperature
      luftfeuchtigkeit_aussen:
        friendly_name: 'Luftfeuchtigkeit Außen'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.humidity_outside_internet') }}"
        device_class: humidity
      luftfeuchtigkeit_kuche_aqara:
        friendly_name: 'Luftfeuchtigkeit Küche'
        unit_of_measurement: '%'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_humidity') | float) | round }}"
        device_class: humidity
      temp_kuche_aqara:
        friendly_name: 'Temp. Küche Aqara'
        unit_of_measurement: '°C'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_temperature') | float) | round(1) }}"
        device_class: temperature
      luftdruck_kuche_aqara:
        friendly_name: 'Luftdruck Küche Aqara'
        unit_of_measurement: 'hPa'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_pressure') | float) | round }}"
        device_class: pressure
      luftfeuchtigkeit_waschkuche:
        friendly_name: 'Luftfeuchtigkeit Waschküche'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.bme280_wemosd1_4_luftfeuchtigkeit') }}"
        device_class: humidity
      temp_waschkuche:
        friendly_name: 'Temp. Waschküche'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.bme280_wemosd1_4_temperatur') }}"
        device_class: temperature
      luftfeuchtigkeit_werkelraum:
        friendly_name: 'Luftfeuchtigkeit Werkelraum'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.bme280_wemosd1_7_luftfeuchtigkeit') }}"
        device_class: humidity
      temp_werkelraum:
        friendly_name: 'Temp. Werkelraum'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.bme280_wemosd1_7_temperatur') }}"
        device_class: temperature
      luftfeuchtigkeit_partyraum:
        friendly_name: 'Luftfeuchtigkeit Partyraum'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.bme280_wemosd1_6_luftfeuchtigkeit') }}"
        device_class: humidity
      temp_partyraum:
        friendly_name: 'Temp. Partyraum'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.bme280_wemosd1_6_temperatur') }}"
        device_class: temperature
      luftfeuchtigkeit_vorratsraum:
        friendly_name: 'Luftfeuchtigkeit Speis'
        unit_of_measurement: '%'
        value_template: "{{ (states('sensor.lumi_lumi_weather_humidity') | float -4.5) | round(1) }}"
        device_class: humidity
      temp_vorratsraum:
        friendly_name: 'Temp. Speis'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.lumi_lumi_weather_temperature') }}"
        device_class: temperature
      temp_outside_internet:
        friendly_name: "Temperatur außen Internet"
        value_template: "{{ state_attr('weather.lieblingshaus', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      humidity_outside_internet:
        friendly_name: "Luftfeuchtigkeit außen Internet"
        value_template: "{{ state_attr('weather.lieblingshaus', 'humidity') }}"
        unit_of_measurement: '%'
        device_class: humidity
#
#     --------------------------------
#     --     Stromverbrauch         --
#     --------------------------------
#
      stromzaehler_netzbezug:
        value_template: "{{ '%.1f'%(states('sensor.stromzahler_positive_active_energy_in_tariff_t1') | float /1000) | float }}"
        friendly_name: 'Stromzähler Netzbezug'
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
#
#       --------------------------------
#       --          Daily             --
#       --------------------------------
#
      stromverbrauch_netzbezug_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_netzbezug_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_backofen_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_backofen_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_bildschirm_theke_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_bildschirm_theke_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_gefrierschrank_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_gefrierschrank_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kochfeld_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_kochfeld_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_keller_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_keller_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_kuche_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_kuche_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_berechnete_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_berechnete_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_gesamt_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_gesamt_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_2_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_2_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_3_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_3_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_waschk_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_waschk_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_werkelraum_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_werkelraum_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_lg_anlage_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_lg_anlage_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftungsanlage_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftungsanlage_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_mixi_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_mixi_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_spulmaschine_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_spulmaschine_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_trockner_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_trockner_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_tv_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_tv_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_waschmaschine_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_waschmaschine_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_aussenteil_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_aussenteil_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_heizstab_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_heizstab_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_innenteil_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_innenteil_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_dauerverbraucher_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_dauerverbraucher_tag', 'last_period') | float + (now().day | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
#
#       --------------------------------
#       --         Monthly            --
#       --------------------------------
#
      stromverbrauch_netzbezug_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_netzbezug_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_backofen_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_backofen_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_bildschirm_theke_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_bildschirm_theke_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_gefrierschrank_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_gefrierschrank_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kochfeld_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_kochfeld_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_keller_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_keller_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_kuche_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_kuche_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_berechnete_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_berechnete_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_gesamt_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_gesamt_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_2_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_2_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_3_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_3_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_waschk_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_waschk_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_werkelraum_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_werkelraum_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_lg_anlage_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_lg_anlage_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftungsanlage_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftungsanlage_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_mixi_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_mixi_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_spulmaschine_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_spulmaschine_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_trockner_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_trockner_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_tv_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_tv_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_waschmaschine_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_waschmaschine_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_aussenteil_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_aussenteil_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_heizstab_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_heizstab_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_innenteil_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_innenteil_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_dauerverbraucher_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_dauerverbraucher_monat', 'last_period') | float + (now().month | float / 1000000) }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
#
#     --------------------------------
#     --   Elektrische Leistung     --
#     --------------------------------
#
#       --------------------------------
#       --       Netz und PV          --
#       --------------------------------
#
      el_leistung_stromzaehler_netzbezug:
        value_template: "{{ states('sensor.stromzahler_sum_active_instantaneous_power') }}"
        friendly_name: 'El. Leistung Stromzähler Netzbezug'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_netzbezug_vorzeichenbehaftet:
        value_template: "{{ (states('sensor.el_leistung_stromzaehler_netzbezug') | float ) * (-1) }}"
        friendly_name: 'El. Leistung Stromzähler Netzbezug Vorzeichen'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_pv_ac:
        value_template: "{{ states('input_number.temp_leistung_pv_test') }}"
        friendly_name: 'El. Leistung PV AC'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_netz_bilanz:
        value_template: "{{ (states('sensor.el_leistung_netzbezug_vorzeichenbehaftet') | float ) + (states('input_number.temp_leistung_pv_test') | float ) }}"
        friendly_name: 'El. Leistung Netz Bilanz'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_verbrauch_gesamt:
        value_template: "{{ (states('sensor.el_leistung_stromzaehler_netzbezug') | float ) }}"
        friendly_name: 'El. Leistung Netz Bilanz'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
#
#       --------------------------------
#       --   effektiver Strompreis    --
#       --------------------------------
#
      el_leistung_einspeiselimit:
        value_template: "{{ (states('input_number.pv_einspeisebegrenzung_prozent') | float ) * (states('input_number.pv_installierte_peakleistung') | float ) * 0.01 }}"
        friendly_name: 'El. Leistung Einspeiselimit'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_anteil_netzbezug:
        value_template: >-
          {% if (states('sensor.el_leistung_netz_bilanz') | float) < 0 %}
            {{ -1*(states('sensor.el_leistung_netz_bilanz') | float) / (states('sensor.el_leistung_verbrauch_gesamt') | float) }}
          {% else %}
            0.0
          {% endif %}
        friendly_name: 'El. Leistung Anteil Netzbezug'
        unit_of_measurement: 'Anteil'
        icon_template: mdi:chart-donut
      el_leistung_anteil_pv_nicht_einspeisbar:
        value_template: >-
          {% if (states('sensor.el_leistung_pv_ac') | float) > ((states('sensor.el_leistung_einspeiselimit') | float) + (states('sensor.el_leistung_verbrauch_gesamt') | float)) %}
            1.0
          {% elif (states('sensor.el_leistung_pv_ac') | float) > (states('sensor.el_leistung_einspeiselimit') | float) %}
            {{ ((states('sensor.el_leistung_pv_ac') | float) - (states('sensor.el_leistung_einspeiselimit') | float)) / (states('sensor.el_leistung_verbrauch_gesamt') | float) }}
          {% else %}
            0.0
          {% endif %}
        friendly_name: 'El. Leistung Anteil PV nicht einspeisbar'
        unit_of_measurement: 'Anteil'
        icon_template: mdi:chart-donut
      el_leistung_anteil_pv_einspeisbar:
        value_template: "{{ 1 - (states('sensor.el_leistung_anteil_netzbezug') | float ) - (states('sensor.el_leistung_anteil_pv_nicht_einspeisbar') | float ) }}"
        friendly_name: 'El. Leistung Anteil PV einspeisbar'
        unit_of_measurement: 'Anteil'
        icon_template: mdi:chart-donut
      strompreis_aktuell_effektiv_euro:
        value_template: "{{ (states('input_number.strompreis') | float ) * (states('sensor.el_leistung_anteil_netzbezug') | float ) + (states('input_number.pv_einspeiseverguetung') | float ) * (states('sensor.el_leistung_anteil_pv_einspeisbar') | float ) }}"
        friendly_name: 'Strompreis aktuell effektiv Euro'
        unit_of_measurement: '€'
        icon_template: mdi:currency-eur
      strompreis_aktuell_abrechnung_euro:
        value_template: "{{ (states('input_number.strompreis') | float ) * (states('sensor.el_leistung_anteil_netzbezug') | float ) }}"
        friendly_name: 'Strompreis aktuell effektiv Euro'
        unit_of_measurement: '€'
        icon_template: mdi:currency-eur
      strompreis_aktuell_effektiv_cent:
        value_template: "{{ ((states('sensor.strompreis_aktuell_effektiv_euro') | float) * 100) | round(0) }}"
        friendly_name: 'Strompreis aktuell effektiv Cent'
        unit_of_measurement: 'ct'
        icon_template: mdi:currency-eur
#
#       --------------------------------
#       --           Licht            --
#       --------------------------------
#
      el_leistung_berechnet_zigbee_licht_gaestezimmer:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_ww_decke_gastezimmer_level_on_off', 'brightness') | float / 255 * 5.3)| float }}"
        friendly_name: 'El. Leistung Licht Gästezimmer (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_stehlampe_le:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_tw_stehlampe_lea_level_light_color_on_off', 'brightness') | float / 255 * 5.8)| float }}"
        friendly_name: 'El. Leistung Stehlampe Le (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_stehlampe_la:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_ww_stehlampe_lara_level_on_off', 'brightness') | float / 255 * 5.3)| float }}"
        friendly_name: 'El. Leistung Stehlampe La (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_kugellampe_sz:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_tw_kugellampe_schlafzimmer_level_light_color_on_off', 'brightness') | float / 255 * 5.8)| float }}"
        friendly_name: 'El. Leistung Kugellampe SZ (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_ecke_gr:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e27_color_terrasse_ecke_gross_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Ecke groß (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_ecke_kl:
        value_template: "{{ '%.1f'%(state_attr('light.innr_rb_285_c_55f50405_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Ecke klein (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_feuerstelle:
        value_template: "{{ '%.1f'%(state_attr('light.innr_rb_285_c_7cc30105_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Feuerstelle (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_flur_keller:
        value_template: "{{ is_state('light.flur_keller','on') | float * 20 }}"
        friendly_name: 'El. Leistung Licht Flur Keller (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_technikraum:
        value_template: "{{ is_state('light.technikraum','on') | float * 20 }}"
        friendly_name: 'El. Leistung Licht Technikraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_vorratsraum:
        value_template: "{{ is_state('light.vorratsraum','on') | float * 20 }}"
        friendly_name: 'El. Leistung Licht Vorratsraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_werkelraum:
        value_template: "{{ is_state('light.werkelraum','on') | float * 60 }}"
        friendly_name: 'El. Leistung Licht Werkelraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_partyraum:
        value_template: "{{ is_state('light.lagerraum','on') | float * 22 }}"
        friendly_name: 'El. Leistung Licht Partyraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spots_carport:
        value_template: "{{ is_state('light.spots_carport','on') | float * 25 }}"
        friendly_name: 'El. Leistung Spots Carport (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_wandwuerfel_sued:
        value_template: "{{ is_state('light.wandwurfel_suden','on') | float * 21 }}"
        friendly_name: 'El. Leistung Wandwürfel Süd (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_wandwuerfel_west:
        value_template: "{{ is_state('light.wandwurfel_westen','on') | float * 21 }}"
        friendly_name: 'El. Leistung Wandwürfel West (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_abstellraum:
        value_template: "{{ is_state('light.abstellraum_carport','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Abstellraum CP (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_naehtisch_nz:
        value_template: "{{ '%.1f'%(state_attr('light.ikea_panel_arbeitszimmer_level_light_color_on_off', 'brightness') | float / 255 * 29)| float }}"
        friendly_name: 'El. Leistung Licht Decke Ma (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_schreibtisch_nz:
        value_template: "{{ is_state('light.schreibtisch_decke','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Decke Jo (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_bad_eg:
        value_template: "{{ is_state('light.spiegel_bad_eg','on') | float * 11.5 }}"
        friendly_name: 'El. Leistung Spiegel Bad EG (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_bad_og:
        value_template: "{{ is_state('light.spiegel_bad_og','on') | float * 11.5 }}"
        friendly_name: 'El. Leistung Spiegel Bad OG (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_wc:
        value_template: "{{ is_state('light.spiegel_wc','on') | float * 20 }}"
        friendly_name: 'El. Leistung Spiegel WC (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_sicherung_3_2:
        value_template: >-
          {% if states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 8 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (0.28 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 15 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (-0.017821) + 0.424589 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 20 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (-0.003710) + 0.169098 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 120 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * 0.005517 + 0.090330 + 0.01) }}
          {% else %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (0.8 + 0.01) }}
          {% endif %}
        friendly_name: 'El. Leistung Licht Sicherung 3.2'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_sicherung_3_3:
        value_template: >-
          {% if states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 35 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.003962 + 0.053906 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 100 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.003834 + 0.180579 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 300 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.001312 + 0.406724 + 0.01) }}
          {% else %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (0.8 + 0.01) }}
          {% endif %}
        friendly_name: 'El. Leistung Licht Sicherung 3.3'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnete_lichter:
        value_template: >-
          {{ states('sensor.el_leistung_berechnet_zigbee_licht_gaestezimmer') | float
           + states('sensor.el_leistung_berechnet_zigbee_stehlampe_le') | float
           + states('sensor.el_leistung_berechnet_zigbee_stehlampe_la') | float
           + states('sensor.el_leistung_berechnet_zigbee_kugellampe_sz') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_ecke_gr') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_ecke_kl') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_feuerstelle') | float
           + states('sensor.el_leistung_berechnet_licht_flur_keller') | float
           + states('sensor.el_leistung_berechnet_licht_technikraum') | float
           + states('sensor.el_leistung_berechnet_licht_vorratsraum') | float
           + states('sensor.el_leistung_berechnet_licht_werkelraum') | float
           + states('sensor.el_leistung_berechnet_licht_partyraum') | float
           + states('sensor.el_leistung_berechnet_spots_carport') | float
           + states('sensor.el_leistung_berechnet_wandwuerfel_sued') | float
           + states('sensor.el_leistung_berechnet_wandwuerfel_west') | float
           + states('sensor.el_leistung_berechnet_abstellraum') | float
           + states('sensor.el_leistung_berechnet_naehtisch_nz') | float
           + states('sensor.el_leistung_berechnet_schreibtisch_nz') | float
           + states('sensor.el_leistung_berechnet_spiegel_bad_eg') | float
           + states('sensor.el_leistung_berechnet_spiegel_bad_og') | float
           + states('sensor.el_leistung_berechnet_spiegel_wc') | float }}
        friendly_name: 'El. Leistung berechnete Lichter'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_gesamt:
        value_template: >-
          {{ states('sensor.el_leistung_berechnete_lichter') | float 
           + states('sensor.el_leistung_licht_sicherung_3_2') | float
           + states('sensor.el_leistung_licht_sicherung_3_3') | float
           + states('sensor.shellydimmer_d472fe_power') | float }}
        friendly_name: 'El. Leistung Licht gesamt'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
#
#       --------------------------------
#       --          Geräte            --
#       --------------------------------
#
      el_leistung_dauerverbraucher:
        # Werte:
            # USV:                          58 (gemessen)
            #     - Fritzbox
            #     - Kabel-Modem
            #     - Repeater Keller
            #     - Switch
            #     - KNX
            # Wasserabsperrhahn              0.5 (gemessen)
            # Onewirepi                      2   (1 gemessen)
            # Odroidxu4                      4.5 (gemessen)
            # Odroidxu4 Platte               5   (gemessen)
            # repeater wz                    4   (online-Test)
            # Raspi Bilderrahmen             2   (wie Onewirepi)
            # Klingel                        5   (geschätzt)
            # Babyphone                      6   (geschätzt)
            # Kodi                           3   (gemessen)
            # Kodi-Platte                    2   (gemessen. Standby 1-2W, Betrieb 9W)
            # Relais Sicherung Keller        1   (geschätzt)
            # Telefon                        0   (<1 gemessen bzw nicht messbar)
            # Drucker                        1.5 (an, gemessen)
            # Switch NZ
            # Radio Bad
            # Radio Theke
            # Enthärtungsanlage
            # Robbi
            # Digibit
        value_template: "{{ (now().minute | float / 1000000) + 58 + 0.5 + 2 + 4.5 + 5 + 4 + 2 + 5 + 6 + 3 + 2 + 1 + 1.5}}"
        friendly_name: 'El. Leistung Dauerverbraucher'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_waschmaschine:
        value_template: >-
          {% if states('sensor.el_leistung_waschmaschine_scheinleistung') | float < 15 %}
            0.4
          {% elif states('sensor.el_leistung_waschmaschine_scheinleistung') | float < 360 %}
            {{ '%.1f'%(states('sensor.el_leistung_waschmaschine_scheinleistung') | float * (states('sensor.el_leistung_waschmaschine_scheinleistung') | float * 0.000688 + 0.561576)) }}
          {% elif states('sensor.el_leistung_waschmaschine_scheinleistung') | float < 1000 %}
            {{ '%.1f'%(states('sensor.el_leistung_waschmaschine_scheinleistung') | float * 0.81) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_waschmaschine_scheinleistung') | float * 1) }}
          {% endif %}
        friendly_name: 'El. Leistung Waschmaschine'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_trockner:
        value_template: >-
          {% if states('sensor.el_leistung_trockner_scheinleistung') | float < 6 %}
            0.0
          {% elif states('sensor.el_leistung_trockner_scheinleistung') | float < 9 %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * (states('sensor.el_leistung_trockner_scheinleistung') | float * (-0.008991) + 0.072442)) }}
          {% elif states('sensor.el_leistung_trockner_scheinleistung') | float < 10 %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * 0.15) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * 1) }}
          {% endif %}
        friendly_name: 'El. Leistung Trockner'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_gefrierschrank:
        value_template: >-
          {% if states('sensor.el_leistung_gefrierschrank_scheinleistung') | float < 22 %}
            {{ '%.1f'%(states('sensor.el_leistung_gefrierschrank_scheinleistung') | float * 0.064) }}
          {% elif states('sensor.el_leistung_gefrierschrank_scheinleistung') | float < 80 %}
            {{ '%.1f'%(states('sensor.el_leistung_gefrierschrank_scheinleistung') | float * 0.73) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_gefrierschrank_scheinleistung') | float * 0.82) }}
          {% endif %}
        friendly_name: 'El. Leistung Gefrierschrank'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_kuhlschrank_kuche:
        value_template: >-
          {% if states('sensor.el_leistung_kuhlschrank_kuche_scheinleistung') | float < 10 %}
            0.0
          {% elif states('sensor.el_leistung_kuhlschrank_kuche_scheinleistung') | float < 20 %}
            {{ '%.1f'%(states('sensor.el_leistung_kuhlschrank_kuche_scheinleistung') | float * 0.95) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_kuhlschrank_kuche_scheinleistung') | float * 0.75) }}
          {% endif %}
        friendly_name: 'El. Leistung Kühlschrank Küche'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_spulmaschine:
        value_template: >-
          {% if states('sensor.el_leistung_spulmaschine_scheinleistung') | float < 6 %}
            0.0
          {% elif states('sensor.el_leistung_spulmaschine_scheinleistung') | float < 8 %}
            {{ '%.1f'%(states('sensor.el_leistung_spulmaschine_scheinleistung') | float * 0.2) }}
          {% elif states('sensor.el_leistung_spulmaschine_scheinleistung') | float < 20 %}
            {{ '%.1f'%(states('sensor.el_leistung_spulmaschine_scheinleistung') | float * 1.0) }}
          {% elif states('sensor.el_leistung_spulmaschine_scheinleistung') | float < 60 %}
            {{ '%.1f'%(states('sensor.el_leistung_spulmaschine_scheinleistung') | float * 0.55) }}
          {% elif states('sensor.el_leistung_spulmaschine_scheinleistung') | float < 200 %}
            {{ '%.1f'%(states('sensor.el_leistung_spulmaschine_scheinleistung') | float * 0.81) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_spulmaschine_scheinleistung') | float * 1.0) }}
          {% endif %}
        friendly_name: 'El. Leistung Spülmaschine'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_tv:
        value_template: >-
          {% if states('sensor.el_leistung_tv_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 15 %}
            0.3
          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 30 %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.5) }}
          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 70 %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.815) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.855) }}
          {% endif %}
        friendly_name: 'El. Leistung TV'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_bildschirm_theke:
        friendly_name: "El. Leistung Bildschirm Theke"
        value_template: >-
          {{ states("sensor.esp_sd_3_wirkleistung") }}
      el_leistung_lg_anlage:
        friendly_name: "El. Leistung LG Anlage"
        value_template: >-
          {% if is_state('binary_sensor.tv_ist_an', 'on') %}
            13.5
          {% else %}
            0.5
          {% endif %}
#
#       ------------------------------------------
#       --    Stromverbrauchskosten ohne PV €/h --
#       ------------------------------------------
#
      stromverbrauchskosten_licht_gesamt_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_licht_gesamt') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Gesamt ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_licht_sicherung_3_2_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_licht_sicherung_3_2') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Sicherung 3.2 ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_licht_sicherung_3_3_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_licht_sicherung_3_3') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Sicherung 3.3 ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_berechnete_lichter_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_berechnete_lichter') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht berechnete ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_backofen_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_backofen') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Backofen ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_bildschirm_theke_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_bildschirm_theke') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Bildschirm Theke ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_gefrierschrank_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_gefrierschrank') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Gefrierschrank ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_kuhlschrank_keller_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_kuhlschrank_keller') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Kühlschrank Keller ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_kuhlschrank_kuche_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_kuhlschrank_kuche') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Kühlschrank Küche ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_lg_anlage_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_lg_anlage') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten LG Anlage ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftungsanlage_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_luftungsanlage') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Lüftungsanlage ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_mixi_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_mixi') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Mixi ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_spulmaschine_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_spulmaschine') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Spülmaschine ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_trockner_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_trockner') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Trockner ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_tv_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_tv') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten TV ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_waschmaschine_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_waschmaschine') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Waschmaschine ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftentf_waschk_ohne_pv:
        value_template: "{{ (states('sensor.innr_sp_120_luftentfeuchter_waschkuche_electrical_measurement') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Luftentf. Waschk. ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftentf_werkelraum_ohne_pv:
        value_template: "{{ (states('sensor.innr_sp_120_test_electrical_measurement') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Luftentf. Werkelraum ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_dauerverbraucher_ohne_pv:
        value_template: "{{ (states('sensor.el_leistung_dauerverbraucher') | float) * (states('input_number.strompreis') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Dauerverbraucher ohne PV'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
#
#       ---------------------------------------------------
#       --    Stromverbrauchskosten mit PV, effektiv €/h --
#       ---------------------------------------------------
#
      stromverbrauchskosten_licht_gesamt_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_licht_gesamt') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Gesamt PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_licht_sicherung_3_2_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_licht_sicherung_3_2') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Sicherung 3.2 PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_licht_sicherung_3_3_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_licht_sicherung_3_3') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Sicherung 3.3 PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_berechnete_lichter_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_berechnete_lichter') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht berechnete PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_backofen_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_backofen') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Backofen PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_bildschirm_theke_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_bildschirm_theke') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Bildschirm Theke PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_gefrierschrank_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_gefrierschrank') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Gefrierschrank PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_kuhlschrank_keller_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_kuhlschrank_keller') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Kühlschrank Keller PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_kuhlschrank_kuche_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_kuhlschrank_kuche') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Kühlschrank Küche PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_lg_anlage_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_lg_anlage') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten LG Anlage PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftungsanlage_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_luftungsanlage') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Lüftungsanlage PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_mixi_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_mixi') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Mixi PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_spulmaschine_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_spulmaschine') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Spülmaschine PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_trockner_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_trockner') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Trockner PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_tv_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_tv') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten TV PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_waschmaschine_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_waschmaschine') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Waschmaschine PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftentf_waschk_pv_effektiv:
        value_template: "{{ (states('sensor.innr_sp_120_luftentfeuchter_waschkuche_electrical_measurement') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Luftentf. Waschk. PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftentf_werkelraum_pv_effektiv:
        value_template: "{{ (states('sensor.innr_sp_120_test_electrical_measurement') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Luftentf. Werkelraum PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_dauerverbraucher_pv_effektiv:
        value_template: "{{ (states('sensor.el_leistung_dauerverbraucher') | float) * (states('sensor.strompreis_aktuell_effektiv_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Dauerverbraucher PV effektiv'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
#
#       -----------------------------------------------------
#       --    Stromverbrauchskosten mit PV, Abrechnung €/h --
#       -----------------------------------------------------
#
      stromverbrauchskosten_licht_gesamt_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_licht_gesamt') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Gesamt PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_licht_sicherung_3_2_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_licht_sicherung_3_2') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Sicherung 3.2 PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_licht_sicherung_3_3_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_licht_sicherung_3_3') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht Sicherung 3.3 PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_berechnete_lichter_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_berechnete_lichter') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Licht berechnete PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_backofen_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_backofen') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Backofen PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_bildschirm_theke_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_bildschirm_theke') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Bildschirm Theke PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_gefrierschrank_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_gefrierschrank') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Gefrierschrank PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_kuhlschrank_keller_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_kuhlschrank_keller') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Kühlschrank Keller PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_kuhlschrank_kuche_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_kuhlschrank_kuche') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Kühlschrank Küche PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_lg_anlage_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_lg_anlage') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten LG Anlage PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftungsanlage_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_luftungsanlage') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Lüftungsanlage PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_mixi_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_mixi') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Mixi PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_spulmaschine_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_spulmaschine') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Spülmaschine PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_trockner_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_trockner') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Trockner PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_tv_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_tv') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten TV PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_waschmaschine_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_waschmaschine') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Waschmaschine PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftentf_waschk_pv_abrechnung:
        value_template: "{{ (states('sensor.innr_sp_120_luftentfeuchter_waschkuche_electrical_measurement') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Luftentf. Waschk. PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_luftentf_werkelraum_pv_abrechnung:
        value_template: "{{ (states('sensor.innr_sp_120_test_electrical_measurement') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Luftentf. Werkelraum PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
      stromverbrauchskosten_dauerverbraucher_pv_abrechnung:
        value_template: "{{ (states('sensor.el_leistung_dauerverbraucher') | float) * (states('sensor.strompreis_aktuell_abrechnung_euro') | float) / 1000 }}"
        friendly_name: 'Stromverbrauchskosten Dauerverbraucher PV Abrechnung'
        unit_of_measurement: '€/h'
        icon_template: mdi:currency-eur
#
#       --------------------------------
#       --     Nullung Zähler         --
#       --------------------------------
#
      stromzahler_licht_gesamt_genullt:
        value_template: >-
          {{ '%.2f'%(states("sensor.stromzahler_licht_gesamt") | float - 237.14) }}
        friendly_name: 'Stromzähler Licht gesamt (genullt)'
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
#
#       --------------------------------
#       --         Heizung            --
#       --------------------------------
#
      # max Stellwert Heizkreise Zeitverlauf
      stellwert_heizung_zeitverlauf_max:
        friendly_name: "Stellwert Heizung Zeitverlauf Max"
        value_template: "{{ state_attr('sensor.stellwert_heizung_zeitverlauf_mean', 'max_value') }}"
        unit_of_measurement: '%'
      # Heizung
      heating_room_target_temp:
        friendly_name: "Heizung Zieltemperatur Raum"
        value_template: "{{ state_attr('climate.hc1', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      # Warmwasser
      water_heater_target_temp:
        friendly_name: "Warmwasser Zieltemperatur"
        value_template: "{{ state_attr('water_heater.dhw1', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      water_heater_current_temp:
        friendly_name: "Warmwasser aktuelle Temperatur"
        value_template: "{{ state_attr('water_heater.dhw1', 'current_temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature

        #
# --------------------------------
# --                            --
# --            MQTT            --
# --                            --
# --------------------------------
#
# MQTT without mqtt-discovery
#
#   --------------------------------
#   --     Sonoff POW R2 1        --
#   --------------------------------
#
  - platform: mqtt
    name: "Sonoff POW R2 1 Scheinleistung"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Sonoff POW R2 1 Wirkleistung"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Sonoff POW R2 1 Leistungsfaktor"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Sonoff POW R2 1 Energie"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
#
#   --------------------------------
#   --     Sonoff POW R2 2        --
#   --------------------------------
#
  - platform: mqtt
    name: "Sonoff POW R2 2 Scheinleistung"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Sonoff POW R2 2 Wirkleistung"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Sonoff POW R2 2 Leistungsfaktor"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Sonoff POW R2 2 Energie"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
#
#   --------------------------------
#   --    Wemos D1 4 - BME280     --
#   --------------------------------
#
  - platform: mqtt
    name: "BME280 WemosD1 4 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ (value_json["BME280"]["Humidity"] | float - 1.0) | round(1) }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "BME280 WemosD1 4 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 4 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["DewPoint"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 4 Luftdruck"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["Pressure"] }}'
    unit_of_measurement: "hPa"
#
#   --------------------------------
#   --    Wemos D1 6 - BME280     --
#   --------------------------------
#
  - platform: mqtt
    name: "BME280 WemosD1 6 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_6/SENSOR"
    value_template: '{{ (value_json["BME280"]["Humidity"] | float - 1.6) | round(1)  }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "BME280 WemosD1 6 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_6/SENSOR"
    value_template: '{{ value_json["BME280"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 6 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_6/SENSOR"
    value_template: '{{ value_json["BME280"]["DewPoint"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 6 Luftdruck"
    state_topic: "tele/tasmota_wemos_d1_6/SENSOR"
    value_template: '{{ value_json["BME280"]["Pressure"] }}'
    unit_of_measurement: "hPa"
#
#   --------------------------------
#   --    Wemos D1 7 - BME280     --
#   --------------------------------
#
  - platform: mqtt
    name: "BME280 WemosD1 7 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_7/SENSOR"
    value_template: '{{ (value_json["BME280"]["Humidity"] | float - 0.1) | round(1) }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "BME280 WemosD1 7 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_7/SENSOR"
    value_template: '{{ value_json["BME280"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 7 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_7/SENSOR"
    value_template: '{{ value_json["BME280"]["DewPoint"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 7 Luftdruck"
    state_topic: "tele/tasmota_wemos_d1_7/SENSOR"
    value_template: '{{ value_json["BME280"]["Pressure"] }}'
    unit_of_measurement: "hPa"
#
#
# --------------------------------
# --                            --
# --        Integration         --
# --                            --
# --------------------------------
#
#   --------------------------------
#   --     Stromverbrauch         --
#   --------------------------------
#
  - platform: integration
    source: sensor.el_leistung_licht_gesamt
    name: Stromzähler Licht gesamt
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_licht_sicherung_3_2
    name: Stromzähler Licht Sicherung 3.2
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_licht_sicherung_3_3
    name: Stromzähler Licht Sicherung 3.3
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_berechnete_lichter
    name: Stromzähler Licht berechnete
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_backofen
    name: Stromzähler Backofen
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_bildschirm_theke
    name: Stromzähler Bildschirm Theke
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_gefrierschrank
    name: Stromzähler Gefrierschrank
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_kuhlschrank_keller
    name: Stromzähler Kühlschrank Keller
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_kuhlschrank_kuche
    name: Stromzähler Kühlschrank Küche
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_lg_anlage
    name: Stromzähler LG Anlage
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_luftungsanlage
    name: Stromzähler Lüftungsanlage
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_mixi
    name: Stromzähler Mixi
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_spulmaschine
    name: Stromzähler Spülmaschine
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_trockner
    name: Stromzähler Trockner
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_tv
    name: Stromzähler TV
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_waschmaschine
    name: Stromzähler Waschmaschine
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.innr_sp_120_luftentfeuchter_waschkuche_electrical_measurement
    name: Stromzähler Luftentf. Waschk.
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.innr_sp_120_test_electrical_measurement
    name: Stromzähler Luftentf. Werkelraum
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_dauerverbraucher
    name: Stromzähler Dauerverbraucher
    method: left
    unit_prefix: k
    round: 2
#
#   --------------------------------
#   --  Stromkosten ohne PV       --
#   --------------------------------
#
  - platform: integration
    source: sensor.stromkosten_licht_gesamt_ohne_pv
    name: Stromkosten Licht gesamt ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_licht_sicherung_3_2_ohne_pv
    name: Stromkosten Licht Sicherung 3.2 ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_licht_sicherung_3_3_ohne_pv
    name: Stromkosten Licht Sicherung 3.3 ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_berechnete_lichter_ohne_pv
    name: Stromkosten Licht berechnete ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_backofen_ohne_pv
    name: Stromkosten Backofen ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_bildschirm_theke_ohne_pv
    name: Stromkosten Bildschirm Theke ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_gefrierschrank_ohne_pv
    name: Stromkosten Gefrierschrank ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_kuhlschrank_keller_ohne_pv
    name: Stromkosten Kühlschrank Keller ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_kuhlschrank_kuche_ohne_pv
    name: Stromkosten Kühlschrank Küche ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_lg_anlage_ohne_pv
    name: Stromkosten LG Anlage ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftungsanlage_ohne_pv
    name: Stromkosten Lüftungsanlage ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_mixi_ohne_pv
    name: Stromkosten Mixi ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_spulmaschine_ohne_pv
    name: Stromkosten Spülmaschine ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_trockner_ohne_pv
    name: Stromkosten Trockner ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_tv_ohne_pv
    name: Stromkosten TV ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_waschmaschine_ohne_pv
    name: Stromkosten Waschmaschine ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftentf_waschk_ohne_pv
    name: Stromkosten Luftentf. Waschk. ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftentf_werkelraum_ohne_pv
    name: Stromkosten Luftentf. Werkelraum ohne PV
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_dauerverbraucher_ohne_pv
    name: Stromkosten Dauerverbraucher ohne PV
    method: left
    unit: €
    round: 6
#
#   ------------------------------------
#   --  Stromkosten mit PV, effektiv  --
#   ------------------------------------
#
  - platform: integration
    source: sensor.stromkosten_licht_gesamt_pv_effektiv
    name: Stromkosten Licht gesamt PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_licht_sicherung_3_2_pv_effektiv
    name: Stromkosten Licht Sicherung 3.2 PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_licht_sicherung_3_3_pv_effektiv
    name: Stromkosten Licht Sicherung 3.3 PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_berechnete_lichter_pv_effektiv
    name: Stromkosten Licht berechnete PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_backofen_pv_effektiv
    name: Stromkosten Backofen PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_bildschirm_theke_pv_effektiv
    name: Stromkosten Bildschirm Theke PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_gefrierschrank_pv_effektiv
    name: Stromkosten Gefrierschrank PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_kuhlschrank_keller_pv_effektiv
    name: Stromkosten Kühlschrank Keller PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_kuhlschrank_kuche_pv_effektiv
    name: Stromkosten Kühlschrank Küche PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_lg_anlage_pv_effektiv
    name: Stromkosten LG Anlage PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftungsanlage_pv_effektiv
    name: Stromkosten Lüftungsanlage PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_mixi_pv_effektiv
    name: Stromkosten Mixi PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_spulmaschine_pv_effektiv
    name: Stromkosten Spülmaschine PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_trockner_pv_effektiv
    name: Stromkosten Trockner PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_tv_pv_effektiv
    name: Stromkosten TV PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_waschmaschine_pv_effektiv
    name: Stromkosten Waschmaschine PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftentf_waschk_pv_effektiv
    name: Stromkosten Luftentf. Waschk. PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftentf_werkelraum_pv_effektiv
    name: Stromkosten Luftentf. Werkelraum PV effektiv
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_dauerverbraucher_pv_effektiv
    name: Stromkosten Dauerverbraucher PV effektiv
    method: left
    unit: €
    round: 6
#
#   --------------------------------------
#   --  Stromkosten mit PV, Abrechnung  --
#   --------------------------------------
#
  - platform: integration
    source: sensor.stromkosten_licht_gesamt_pv_abrechnung
    name: Stromkosten Licht gesamt PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_licht_sicherung_3_2_pv_abrechnung
    name: Stromkosten Licht Sicherung 3.2 PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_licht_sicherung_3_3_pv_abrechnung
    name: Stromkosten Licht Sicherung 3.3 PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_berechnete_lichter_pv_abrechnung
    name: Stromkosten Licht berechnete PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_backofen_pv_abrechnung
    name: Stromkosten Backofen PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_bildschirm_theke_pv_abrechnung
    name: Stromkosten Bildschirm Theke PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_gefrierschrank_pv_abrechnung
    name: Stromkosten Gefrierschrank PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_kuhlschrank_keller_pv_abrechnung
    name: Stromkosten Kühlschrank Keller PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_kuhlschrank_kuche_pv_abrechnung
    name: Stromkosten Kühlschrank Küche PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_lg_anlage_pv_abrechnung
    name: Stromkosten LG Anlage PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftungsanlage_pv_abrechnung
    name: Stromkosten Lüftungsanlage PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_mixi_pv_abrechnung
    name: Stromkosten Mixi PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_spulmaschine_pv_abrechnung
    name: Stromkosten Spülmaschine PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_trockner_pv_abrechnung
    name: Stromkosten Trockner PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_tv_pv_abrechnung
    name: Stromkosten TV PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_waschmaschine_pv_abrechnung
    name: Stromkosten Waschmaschine PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftentf_waschk_pv_abrechnung
    name: Stromkosten Luftentf. Waschk. PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_luftentf_werkelraum_pv_abrechnung
    name: Stromkosten Luftentf. Werkelraum PV Abrechnung
    method: left
    unit: €
    round: 6
  - platform: integration
    source: sensor.stromkosten_dauerverbraucher_pv_abrechnung
    name: Stromkosten Dauerverbraucher PV Abrechnung
    method: left
    unit: €
    round: 6
#
# --------------------------------
# --                            --
# --           History          --
# --                            --
# --------------------------------
#
  - platform: history_stats
    name: Jo at work
    entity_id: binary_sensor.jo_at_work
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
  - platform: history_stats
    name: Anteil La wach letzte Stunde
    entity_id: switch.la_schlaft
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil Le wach letzte Stunde
    entity_id: switch.le_schlaft
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil MaJo wach letzte Stunde
    entity_id: switch.majo_schlafen
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil Kinder wach letzte Stunde
    entity_id: binary_sensor.la_oder_le_schlafen
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1

#
# --------------------------------
# --                            --
# --         Min / Max          --
# --                            --
# --------------------------------
#
  - platform: min_max
    type: max
    name: Stellwert Heizung aktueller MaxWert
    entity_ids:
      - sensor.stellwert_heizung_bad_eg
      - sensor.stellwert_heizung_bad_og
      - sensor.stellwert_heizung_esszimmer
      - sensor.stellwert_heizung_flur_og
      - sensor.stellwert_heizung_gastezimmer
      - sensor.stellwert_heizung_kuche
      - sensor.stellwert_heizung_la
      - sensor.stellwert_heizung_le
      - sensor.stellwert_heizung_nahzimmer
      - sensor.stellwert_heizung_schlafzimmer
      - sensor.stellwert_heizung_windfang_wc
      - sensor.stellwert_heizung_wohnzimmer
#
# --------------------------------
# --                            --
# --         Statistics         --
# --                            --
# --------------------------------
#
  - platform: statistics
    name: Stellwert Heizung Zeitverlauf Mean
    entity_id: sensor.stellwert_heizung_aktueller_maxwert
    sampling_size: 2000
    max_age:
      minutes: 30
  - platform: statistics
    name: El. Leistung Verbrauch gesamt letzte Minuten
    entity_id: sensor.stellwert_heizung_aktueller_maxwert
    sampling_size: 1000
    max_age:
      minutes: 5
#
# --------------------------------
# --                            --
# --       Time / Date          --
# --                            --
# --------------------------------
#
  - platform: time_date
    display_options:
      - 'time'
      - 'date'

#
# --------------------------------
# --                            --
# --        Stromzähler         --
# --                            --
# --------------------------------
#
  - platform: edl21
    name: Stromzähler
    serial_port: /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AR0JH225-if00-port0
#
# --------------------------------
# --                            --
# --          solcast           --
# --                            --
# --------------------------------
#
  - platform: rest
    resource: !secret solcast_url
    value_template: '{{ value_json.forecasts.0.pv_estimate }}'
    json_attributes:
      - "forecasts"
    name: 'solcast forecast REST'
    unit_of_measurement: "kW"
    scan_interval: 10800
#
# --------------------------------
# --                            --
# --    Fully Kiosk Browser     --
# --                            --
# --------------------------------
#
  - platform: rest
    name: Kiosk Browser Bildschirm Theke
    resource: 'http://192.168.178.42:2323/?cmd=deviceInfo&type=json&password=nopw'
    json_attributes:
    - screenBrightness
    - screenOn
    - ip4
    - ip6
    - deviceId
    value_template: 'OK'
#
# --------------------------------
# --                            --
# --           Server           --
# --                            --
# --------------------------------
#
  - platform: systemmonitor
    resources:
      - type: processor_use
      - type: disk_use_percent
        arg: "/"
      - type: last_boot
      - type: memory_use_percent
  - platform: command_line
    name: CPU Temperatur
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "°C"
    value_template: '{{ value | multiply(0.001) | round(1) }}'
