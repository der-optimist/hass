# --- Template ---
  - platform: template
    sensors:
      date_template:
        friendly_name: 'Datum'
        value_template: '{{ as_timestamp(now()) | timestamp_custom("%d.%m.%Y", True) }}'
      luftfeuchtigkeit_kuche_aqara:
        friendly_name: 'Luftfeuchtigkeit Küche'
        unit_of_measurement: '%'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_humidity') | float) | round }}"
        device_class: humidity
      temp_kuche_aqara:
        friendly_name: 'Temp. Küche Aqara'
        unit_of_measurement: '°C'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_temperature') | float) | round(1) }}"
        device_class: temperature
      luftdruck_kuche_aqara:
        friendly_name: 'Luftdruck Küche Aqara'
        unit_of_measurement: 'hPa'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_pressure') | float) | round }}"
        device_class: pressure
      luftfeuchtigkeit_waschkuche:
        friendly_name: 'Luftfeuchtigkeit Waschküche'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.dht21_wemosd1_2_luftfeuchtigkeit') }}"
        device_class: humidity
      temp_waschkuche:
        friendly_name: 'Temp. Waschküche'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.dht21_wemosd1_2_temperatur') }}"
        device_class: temperature
      luftfeuchtigkeit_werkelraum:
        friendly_name: 'Luftfeuchtigkeit Werkelraum'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.dht21_wemosd1_3_luftfeuchtigkeit') }}"
        device_class: humidity
      temp_werkelraum:
        friendly_name: 'Temp. Werkelraum'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.dht21_wemosd1_3_temperatur') }}"
        device_class: temperature
      luftfeuchtigkeit_partyraum:
        friendly_name: 'Luftfeuchtigkeit Partyraum'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.dht21_wemosd1_1_luftfeuchtigkeit') }}"
        device_class: humidity
      temp_partyraum:
        friendly_name: 'Temp. Partyraum'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.dht21_wemosd1_1_temperatur') }}"
        device_class: temperature
      luftfeuchtigkeit_vorratsraum:
        friendly_name: 'Luftfeuchtigkeit Speis'
        unit_of_measurement: '%'
        value_template: "{{ states('sensor.lumi_lumi_weather_humidity') }}"
        device_class: humidity
      temp_vorratsraum:
        friendly_name: 'Temp. Speis'
        unit_of_measurement: '°C'
        value_template: "{{ states('sensor.lumi_lumi_weather_temperature') }}"
        device_class: temperature
      temp_outside_internet:
        friendly_name: "Temperatur außen Internet"
        value_template: "{{ state_attr('weather.lieblingshaus', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      humidity_outside_internet:
        friendly_name: "Luftfeuchtigkeit außen Internet"
        value_template: "{{ state_attr('weather.lieblingshaus', 'humidity') }}"
        unit_of_measurement: '%'
        device_class: humidity

      # --- Stromverbrauch ---
      stromzaehler_netzbezug:
        value_template: "{{ '%.1f'%(states('sensor.stromzahler_positive_active_energy_in_tariff_t1') | float /1000) | float }}"
        friendly_name: 'Stromzähler Netzbezug'
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      # Daily
      stromverbrauch_netzbezug_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_netzbezug_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_backofen_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_backofen_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_bildschirm_theke_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_bildschirm_theke_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_gefrierschrank_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_gefrierschrank_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kochfeld_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_kochfeld_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_keller_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_keller_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_kuche_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_kuche_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_berechnete_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_berechnete_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_gesamt_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_gesamt_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_2_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_2_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_3_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_3_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_waschk_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_waschk_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_werkelraum_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_werkelraum_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_lg_anlage_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_lg_anlage_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftungsanlage_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftungsanlage_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_mixi_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_mixi_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_spulmaschine_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_spulmaschine_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_trockner_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_trockner_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_tv_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_tv_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_waschmaschine_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_waschmaschine_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_aussenteil_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_aussenteil_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_heizstab_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_heizstab_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_innenteil_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_innenteil_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_dauerverbraucher_vortag:
        value_template: "{{ state_attr('sensor.stromverbrauch_dauerverbraucher_tag', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      # Monthly
      stromverbrauch_netzbezug_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_netzbezug_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_backofen_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_backofen_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_bildschirm_theke_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_bildschirm_theke_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_gefrierschrank_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_gefrierschrank_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kochfeld_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_kochfeld_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_keller_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_keller_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_kuhlschrank_kuche_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_kuhlschrank_kuche_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_berechnete_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_berechnete_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_gesamt_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_gesamt_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_2_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_2_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_licht_sicherung_3_3_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_licht_sicherung_3_3_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_waschk_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_waschk_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftentf_werkelraum_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftentf_werkelraum_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_lg_anlage_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_lg_anlage_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_luftungsanlage_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_luftungsanlage_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_mixi_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_mixi_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_spulmaschine_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_spulmaschine_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_trockner_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_trockner_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_tv_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_tv_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_waschmaschine_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_waschmaschine_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_aussenteil_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_aussenteil_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_heizstab_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_heizstab_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_wp_innenteil_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_wp_innenteil_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      stromverbrauch_dauerverbraucher_vormonat:
        value_template: "{{ state_attr('sensor.stromverbrauch_dauerverbraucher_monat', 'last_period') }}"
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter

      # --- Elektrische Leistung ---
      # Backofen
      el_leistung_stromzaehler_netzbezug:
        value_template: "{{ states('sensor.stromzahler_sum_active_instantaneous_power') }}"
        friendly_name: 'El. Leistung Stromzähler Netzbezug'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Backofen
      el_leistung_backofen_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_backofen') | float) | float }}"
        friendly_name: 'El. Leistung Backofen (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Dauerverbraucher
      el_leistung_dauerverbraucher_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_dauerverbraucher') | float) | float }}"
        friendly_name: 'El. Leistung Dauerverbraucher (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Kühlschrank Küche
      el_leistung_kuhlschrank_kuche_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_kuhlschrank_kuche') | float) | float }}"
        friendly_name: 'El. Leistung Kühlschrank Küche (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Spülmaschine
      el_leistung_spulmaschine_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_spulmaschine') | float) | float }}"
        friendly_name: 'El. Leistung Spülmaschine (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Mixi
      el_leistung_mixi_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_mixi') | float) | float }}"
        friendly_name: 'El. Leistung Mixi (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # TV
#      el_leistung_tv_round:
#        value_template: "{{ '%.1f'%(states('sensor.el_leistung_tv') | float) | float }}"
#        friendly_name: 'El. Leistung TV (gerundet)'
#        unit_of_measurement: 'W'
#        icon_template: mdi:speedometer
      # Waschmaschine
#      el_leistung_waschmaschine_round:
#        value_template: "{{ '%.1f'%(states('sensor.el_leistung_waschmaschine') | float) | float }}"
#        friendly_name: 'El. Leistung Waschmaschine (gerundet)'
#        unit_of_measurement: 'W'
#        icon_template: mdi:speedometer
      # Trockner
#      el_leistung_trockner_round:
#        value_template: "{{ '%.1f'%(states('sensor.el_leistung_trockner') | float) | float }}"
#        friendly_name: 'El. Leistung Trockner (gerundet)'
#        unit_of_measurement: 'W'
#        icon_template: mdi:speedometer
      # Kühlschrank Keller
      el_leistung_kuhlschrank_keller_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_kuhlschrank_keller') | float) | float }}"
        friendly_name: 'El. Leistung Kühlschrank Keller (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Gefrierschrank
      el_leistung_gefrierschrank_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_gefrierschrank') | float) | float }}"
        friendly_name: 'El. Leistung Gefrierschrank (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Lüftungsanlage
      el_leistung_luftungsanlage_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_luftungsanlage') | float) | float }}"
        friendly_name: 'El. Leistung Lüftungsanlage (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Licht
      el_leistung_berechnet_zigbee_licht_gaestezimmer:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_ww_decke_gastezimmer_level_on_off', 'brightness') | float / 255 * 5.3)| float }}"
        friendly_name: 'El. Leistung Licht Gästezimmer (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_stehlampe_le:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_tw_stehlampe_lea_level_light_color_on_off', 'brightness') | float / 255 * 5.8)| float }}"
        friendly_name: 'El. Leistung Stehlampe Le (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_stehlampe_la:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_ww_stehlampe_lara_level_on_off', 'brightness') | float / 255 * 5.3)| float }}"
        friendly_name: 'El. Leistung Stehlampe La (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_kugellampe_sz:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_tw_kugellampe_schlafzimmer_level_light_color_on_off', 'brightness') | float / 255 * 5.8)| float }}"
        friendly_name: 'El. Leistung Kugellampe SZ (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_ecke_gr:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e27_color_terrasse_ecke_gross_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Ecke groß (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_ecke_kl:
        value_template: "{{ '%.1f'%(state_attr('light.innr_rb_285_c_55f50405_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Ecke klein (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_feuerstelle:
        value_template: "{{ '%.1f'%(state_attr('light.innr_rb_285_c_7cc30105_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Feuerstelle (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_flur_keller:
        value_template: "{{ is_state('light.flur_keller','on') | float * 75 }}"
        friendly_name: 'El. Leistung Licht Flur Keller (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_technikraum:
        value_template: "{{ is_state('light.technikraum','on') | float * 116 }}"
        friendly_name: 'El. Leistung Licht Technikraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_vorratsraum:
        value_template: "{{ is_state('light.vorratsraum','on') | float * 75 }}"
        friendly_name: 'El. Leistung Licht Vorratsraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_werkelraum:
        value_template: "{{ is_state('light.werkelraum','on') | float * 85 }}"
        friendly_name: 'El. Leistung Licht Werkelraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_partyraum:
        value_template: "{{ is_state('light.lagerraum','on') | float * 65 }}"
        friendly_name: 'El. Leistung Licht Partyraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spots_carport:
        value_template: "{{ is_state('light.spots_carport','on') | float * 25 }}"
        friendly_name: 'El. Leistung Spots Carport (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_wandwuerfel_sued:
        value_template: "{{ is_state('light.wandwurfel_suden','on') | float * 21 }}"
        friendly_name: 'El. Leistung Wandwürfel Süd (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_wandwuerfel_west:
        value_template: "{{ is_state('light.wandwurfel_westen','on') | float * 21 }}"
        friendly_name: 'El. Leistung Wandwürfel West (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_abstellraum:
        value_template: "{{ is_state('light.abstellraum_carport','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Abstellraum CP (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_naehtisch_nz:
        value_template: "{{ is_state('light.nahtisch_decke','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Nähtisch Decke(berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_schreibtisch_nz:
        value_template: "{{ is_state('light.schreibtisch_decke','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Schreibtisch Decke (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_bad_eg:
        value_template: "{{ is_state('light.spiegel_bad_eg','on') | float * 11.5 }}"
        friendly_name: 'El. Leistung Spiegel Bad EG (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_bad_og:
        value_template: "{{ is_state('light.spiegel_bad_og','on') | float * 11.5 }}"
        friendly_name: 'El. Leistung Spiegel Bad OG (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_wc:
        value_template: "{{ is_state('light.spiegel_wc','on') | float * 20 }}"
        friendly_name: 'El. Leistung Spiegel WC (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_sicherung_3_2:
        value_template: >-
          {% if states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 8 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (0.28 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 15 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (-0.017821) + 0.424589 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 20 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (-0.003710) + 0.169098 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 120 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * 0.005517 + 0.090330 + 0.01) }}
          {% else %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (0.8 + 0.01) }}
          {% endif %}
        friendly_name: 'El. Leistung Licht Sicherung 3.2'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_sicherung_3_3:
        value_template: >-
          {% if states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 35 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.003962 + 0.053906 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 100 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.003834 + 0.180579 + 0.01) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 300 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.001312 + 0.406724 + 0.01) }}
          {% else %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (0.8 + 0.01) }}
          {% endif %}
        friendly_name: 'El. Leistung Licht Sicherung 3.3'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnete_lichter:
        value_template: >-
          {{ states('sensor.el_leistung_berechnet_zigbee_licht_gaestezimmer') | float
           + states('sensor.el_leistung_berechnet_zigbee_stehlampe_le') | float
           + states('sensor.el_leistung_berechnet_zigbee_stehlampe_la') | float
           + states('sensor.el_leistung_berechnet_zigbee_kugellampe_sz') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_ecke_gr') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_ecke_kl') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_feuerstelle') | float
           + states('sensor.el_leistung_berechnet_licht_flur_keller') | float
           + states('sensor.el_leistung_berechnet_licht_technikraum') | float
           + states('sensor.el_leistung_berechnet_licht_vorratsraum') | float
           + states('sensor.el_leistung_berechnet_licht_werkelraum') | float
           + states('sensor.el_leistung_berechnet_licht_partyraum') | float
           + states('sensor.el_leistung_berechnet_spots_carport') | float
           + states('sensor.el_leistung_berechnet_wandwuerfel_sued') | float
           + states('sensor.el_leistung_berechnet_wandwuerfel_west') | float
           + states('sensor.el_leistung_berechnet_abstellraum') | float
           + states('sensor.el_leistung_berechnet_naehtisch_nz') | float
           + states('sensor.el_leistung_berechnet_schreibtisch_nz') | float
           + states('sensor.el_leistung_berechnet_spiegel_bad_eg') | float
           + states('sensor.el_leistung_berechnet_spiegel_bad_og') | float
           + states('sensor.el_leistung_berechnet_spiegel_wc') | float }}
        friendly_name: 'El. Leistung berechnete Lichter'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_gesamt:
        value_template: >-
          {{ states('sensor.el_leistung_berechnete_lichter') | float 
           + states('sensor.el_leistung_licht_sicherung_3_2') | float
           + states('sensor.el_leistung_licht_sicherung_3_3') | float
           + states('sensor.shellydimmer_d472fe_power') | float }}
        friendly_name: 'El. Leistung Licht gesamt'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_dauerverbraucher:
        # Werte:
            # USV:                          58 (gemessen)
            #     - Fritzbox
            #     - Kabel-Modem
            #     - Repeater Keller
            #     - Switch
            #     - KNX
            # Wasserabsperrhahn              0.5 (gemessen)
            # Onewirepi                      2   (1 gemessen)
            # Odroidxu4                      4.5 (gemessen)
            # Odroidxu4 Platte               5   (gemessen)
            # repeater wz                    4   (online-Test)
            # Raspi Bilderrahmen             2   (wie Onewirepi)
            # Klingel                        5   (geschätzt)
            # Babyphone                      6   (geschätzt)
            # Kodi                           3   (gemessen)
            # Relais Sicherung Keller        1   (geschätzt)
            # Telefon
            # Drucker                        1.5 (an, gemessen)
        value_template: "{{ (now().hour | float / 1000000) + 58 + 0.5 + 2 + 4.5 + 5 + 4 + 2 + 5 + 6 + 3 + 1 + 1.5}}"
        friendly_name: 'El. Leistung Dauerverbraucher'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_waschmaschine:
        value_template: >-
          {% if states('sensor.el_leistung_waschmaschine_scheinleistung') | float < 15 %}
            0.4
          {% elif states('sensor.el_leistung_waschmaschine_scheinleistung') | float < 360 %}
            {{ '%.1f'%(states('sensor.el_leistung_waschmaschine_scheinleistung') | float * (states('sensor.el_leistung_waschmaschine_scheinleistung') | float * 0.000688 + 0.561576)) }}
          {% elif states('sensor.el_leistung_waschmaschine_scheinleistung') | float < 1000 %}
            {{ '%.1f'%(states('sensor.el_leistung_waschmaschine_scheinleistung') | float * 0.81) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_waschmaschine_scheinleistung') | float * 1) }}
          {% endif %}
        friendly_name: 'El. Leistung Waschmaschine'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_trockner:
        value_template: >-
          {% if states('sensor.el_leistung_trockner_scheinleistung') | float < 6 %}
            0.0
          {% elif states('sensor.el_leistung_trockner_scheinleistung') | float < 9 %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * (states('sensor.el_leistung_trockner_scheinleistung') | float * (-0.008991) + 0.072442)) }}
          {% elif states('sensor.el_leistung_trockner_scheinleistung') | float < 10 %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * 0.15) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * 1) }}
          {% endif %}
        friendly_name: 'El. Leistung Trockner'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_tv:
        value_template: >-
          {% if states('sensor.el_leistung_tv_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 15 %}
            0.3
          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 30 %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.5) }}
          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 70 %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.815) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.855) }}
          {% endif %}
        friendly_name: 'El. Leistung TV'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_bildschirm_theke:
        friendly_name: "El. Leistung Bildschirm Theke"
        value_template: >-
          {% if is_state('binary_sensor.anwesenheit_bildschirm', 'on') %}
            10
          {% else %}
            6
          {% endif %}
      el_leistung_lg_anlage:
        friendly_name: "El. Leistung LG Anlage"
        value_template: >-
          {% if is_state('binary_sensor.tv_ist_an', 'on') %}
            13.5
          {% else %}
            0.5
          {% endif %}
      stromzahler_licht_gesamt_genullt:
        value_template: >-
          {{ '%.2f'%(states("sensor.stromzahler_licht_gesamt") | float - 237.14) }}
        friendly_name: 'Stromzähler Licht gesamt (genullt)'
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter
      # max Stellwert Heizkreise Zeitverlauf
      stellwert_heizung_zeitverlauf_max:
        friendly_name: "Stellwert Heizung Zeitverlauf Max"
        value_template: "{{ state_attr('sensor.stellwert_heizung_zeitverlauf_mean', 'max_value') }}"
        unit_of_measurement: '%'
      # Heizung
      heating_room_target_temp:
        friendly_name: "Heizung Zieltemperatur Raum"
        value_template: "{{ state_attr('climate.hc1', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      # Warmwasser
      water_heater_target_temp:
        friendly_name: "Warmwasser Zieltemperatur"
        value_template: "{{ state_attr('water_heater.dhw1', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      water_heater_current_temp:
        friendly_name: "Warmwasser aktuelle Temperatur"
        value_template: "{{ state_attr('water_heater.dhw1', 'current_temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature

# MQTT without mqtt-discovery
# Sonoff POW R2 1
  - platform: mqtt
    name: "Sonoff POW R2 1 Scheinleistung"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Sonoff POW R2 1 Wirkleistung"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Sonoff POW R2 1 Leistungsfaktor"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Sonoff POW R2 1 Energie"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Sonoff POW R2 2
  - platform: mqtt
    name: "Sonoff POW R2 2 Scheinleistung"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Sonoff POW R2 2 Wirkleistung"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Sonoff POW R2 2 Leistungsfaktor"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Sonoff POW R2 2 Energie"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Tasmota SD 2
  - platform: mqtt
    name: "Tasmota SD 2 Scheinleistung"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Tasmota SD 2 Wirkleistung"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Tasmota SD 2 Leistungsfaktor"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Tasmota SD 2 Energie"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Tasmota SD 3
  - platform: mqtt
    name: "Tasmota SD 3 Scheinleistung"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Tasmota SD 3 Wirkleistung"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Tasmota SD 3 Leistungsfaktor"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: " "
  - platform: mqtt
    name: "Tasmota SD 3 Energie"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Wemos D1 1 - DHT21
  - platform: mqtt
    name: "DHT21 WemosD1 1 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_1/SENSOR"
    value_template: '{{ value_json["AM2301"]["Humidity"] }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "DHT21 WemosD1 1 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_1/SENSOR"
    value_template: '{{ value_json["AM2301"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "DHT21 WemosD1 1 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_1/SENSOR"
    value_template: '{{ value_json["AM2301"]["DewPoint"] }}'
    unit_of_measurement: "°C"
# Wemos D1 2 - DHT21
  - platform: mqtt
    name: "DHT21 WemosD1 2 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_2/SENSOR"
    value_template: '{{ value_json["AM2301"]["Humidity"] }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "DHT21 WemosD1 2 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_2/SENSOR"
    value_template: '{{ value_json["AM2301"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "DHT21 WemosD1 2 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_2/SENSOR"
    value_template: '{{ value_json["AM2301"]["DewPoint"] }}'
    unit_of_measurement: "°C"
# Wemos D1 3 - DHT21
  - platform: mqtt
    name: "DHT21 WemosD1 3 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_3/SENSOR"
    value_template: '{{ (value_json["AM2301"]["Humidity"] | float - 3.5) | round(1) }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "DHT21 WemosD1 3 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_3/SENSOR"
    value_template: '{{ value_json["AM2301"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "DHT21 WemosD1 3 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_3/SENSOR"
    value_template: '{{ value_json["AM2301"]["DewPoint"] }}'
    unit_of_measurement: "°C"
# Wemos D1 4 - BME280
  - platform: mqtt
    name: "BME280 WemosD1 4 Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["Humidity"] }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "BME280 WemosD1 4 Temperatur"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 4 Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["DewPoint"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "BME280 WemosD1 4 Luftdruck"
    state_topic: "tele/tasmota_wemos_d1_4/SENSOR"
    value_template: '{{ value_json["BME280"]["Pressure"] }}'
    unit_of_measurement: "hPa"

# Riemann sum - Integration (Energy Consumption)
  - platform: integration
    source: sensor.el_leistung_licht_gesamt
    name: Stromzähler Licht gesamt
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_licht_sicherung_3_2
    name: Stromzähler Licht Sicherung 3.2
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_licht_sicherung_3_3
    name: Stromzähler Licht Sicherung 3.3
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_berechnete_lichter
    name: Stromzähler Licht berechnete
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_backofen
    name: Stromzähler Backofen
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_bildschirm_theke
    name: Stromzähler Bildschirm Theke
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_gefrierschrank
    name: Stromzähler Gefrierschrank
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_kuhlschrank_keller
    name: Stromzähler Kühlschrank Keller
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_kuhlschrank_kuche
    name: Stromzähler Kühlschrank Küche
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_lg_anlage
    name: Stromzähler LG Anlage
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_luftungsanlage
    name: Stromzähler Lüftungsanlage
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_mixi
    name: Stromzähler Mixi
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_spulmaschine
    name: Stromzähler Spülmaschine
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_trockner
    name: Stromzähler Trockner
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_tv
    name: Stromzähler TV
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_waschmaschine
    name: Stromzähler Waschmaschine
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.innr_sp_120_luftentfeuchter_waschkuche_electrical_measurement
    name: Stromzähler Luftentf. Waschk.
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.innr_sp_120_test_electrical_measurement
    name: Stromzähler Luftentf. Werkelraum
    method: left
    unit_prefix: k
    round: 2
  - platform: integration
    source: sensor.el_leistung_dauerverbraucher
    name: Stromzähler Dauerverbraucher
    method: left
    unit_prefix: k
    round: 2


# --- Sonstiges ---
# History
  - platform: history_stats
    name: Jo at work
    entity_id: binary_sensor.jo_at_work
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
  - platform: history_stats
    name: Anteil La wach letzte Stunde
    entity_id: switch.la_schlaft
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil Le wach letzte Stunde
    entity_id: switch.le_schlaft
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil MaJo wach letzte Stunde
    entity_id: switch.majo_schlafen
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil Kinder wach letzte Stunde
    entity_id: binary_sensor.la_oder_le_schlafen
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1

# Max. Stellung Heizkreisventile
  - platform: min_max
    type: max
    name: Stellwert Heizung aktueller MaxWert
    entity_ids:
      - sensor.stellwert_heizung_bad_eg
      - sensor.stellwert_heizung_bad_og
      - sensor.stellwert_heizung_esszimmer
      - sensor.stellwert_heizung_flur_og
      - sensor.stellwert_heizung_gastezimmer
      - sensor.stellwert_heizung_kuche
      - sensor.stellwert_heizung_la
      - sensor.stellwert_heizung_le
      - sensor.stellwert_heizung_nahzimmer
      - sensor.stellwert_heizung_schlafzimmer
      - sensor.stellwert_heizung_windfang_wc
      - sensor.stellwert_heizung_wohnzimmer
  - platform: statistics
    name: Stellwert Heizung Zeitverlauf Mean
    entity_id: sensor.stellwert_heizung_aktueller_maxwert
    sampling_size: 2000
    max_age:
      minutes: 30

# Zeit und Datum
  - platform: time_date
    display_options:
      - 'time'
      - 'date'

# Stromzaehler
  - platform: edl21
    name: Stromzähler
    serial_port: /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AR0JH225-if00-port0

# Bank
#  - platform: fints
#    bank_identification_number: !secret bank_blz
#    username: !secret bank_username
#    pin: !secret bank_pin
#    url: !secret bank_url

# System 
  - platform: systemmonitor
    resources:
      - type: processor_use
      - type: disk_use_percent
        arg: "/"
      - type: last_boot
      - type: memory_use_percent
  - platform: command_line
    name: CPU Temperatur
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "°C"
    value_template: '{{ value | multiply(0.001) | round(1) }}'

# Covid
  - platform: rest
    resource: "https://services7.arcgis.com/mOBPykOjAyBO2ZKk/arcgis/rest/services/RKI_Landkreisdaten/FeatureServer/0/query?where=county%20%3D%20%27LK%20RAVENSBURG%27&outFields=cases,deaths,cases_per_100k,cases_per_population,BL,BL_ID,county,last_update,cases7_per_100k,recovered,cases7_bl_per_100k,EWZ_BL&returnGeometry=false&outSR=4326&f=json"
    name: "7-Tage-Inzidenz RV"
    value_template: "{{ '%.1f'%(value_json.features.0.attributes.cases7_per_100k | float) }}"
    unit_of_measurement: 'Menschen'
  - platform: rest
    resource: "https://services7.arcgis.com/mOBPykOjAyBO2ZKk/arcgis/rest/services/RKI_Landkreisdaten/FeatureServer/0/query?where=county%20%3D%20%27LK%20RAVENSBURG%27&outFields=cases,deaths,cases_per_100k,cases_per_population,BL,BL_ID,county,last_update,cases7_per_100k,recovered,cases7_bl_per_100k,EWZ_BL&returnGeometry=false&outSR=4326&f=json"
    name: "7-Tage-Inzidenz BaWü"
    value_template: "{{ '%.1f'%(value_json.features.0.attributes.cases7_bl_per_100k | float) }}"
    unit_of_measurement: 'Menschen'
  - platform: rest
    resource: "https://services7.arcgis.com/mOBPykOjAyBO2ZKk/arcgis/rest/services/RKI_Landkreisdaten/FeatureServer/0/query?where=county%20%3D%20%27LK%20WITTENBERG%27&outFields=cases,deaths,cases_per_100k,cases_per_population,BL,BL_ID,county,last_update,cases7_per_100k,recovered,cases7_bl_per_100k,EWZ_BL&returnGeometry=false&outSR=4326&f=json"
    name: "7-Tage-Inzidenz Jessen"
    value_template: "{{ '%.1f'%(value_json.features.0.attributes.cases7_bl_per_100k | float) }}"
    unit_of_measurement: 'Menschen'
  - platform: rest
    resource: "https://services7.arcgis.com/mOBPykOjAyBO2ZKk/arcgis/rest/services/Coronaf%C3%A4lle_in_den_Bundesl%C3%A4ndern/FeatureServer/0/query?where=1%3D1&outFields=Fallzahl,LAN_ew_GEN&returnGeometry=false&outSR=4326&f=json"
    name: Fallzahlen gesamt D
#    scan_interval: 3600
    value_template: "{{ (value_json.features.0.attributes.Fallzahl | float) 
                      + (value_json.features.1.attributes.Fallzahl | float) 
                      + (value_json.features.2.attributes.Fallzahl | float) 
                      + (value_json.features.3.attributes.Fallzahl | float) 
                      + (value_json.features.4.attributes.Fallzahl | float) 
                      + (value_json.features.5.attributes.Fallzahl | float) 
                      + (value_json.features.6.attributes.Fallzahl | float) 
                      + (value_json.features.7.attributes.Fallzahl | float) 
                      + (value_json.features.8.attributes.Fallzahl | float) 
                      + (value_json.features.9.attributes.Fallzahl | float) 
                      + (value_json.features.10.attributes.Fallzahl | float) 
                      + (value_json.features.11.attributes.Fallzahl | float) 
                      + (value_json.features.12.attributes.Fallzahl | float) 
                      + (value_json.features.13.attributes.Fallzahl | float) 
                      + (value_json.features.14.attributes.Fallzahl | float) 
                      + (value_json.features.15.attributes.Fallzahl | float) }}"
    unit_of_measurement: 'Menschen'
    
