# --- Template ---
  - platform: template
    sensors:
      date_template:
        friendly_name: 'Datum'
        value_template: '{{ as_timestamp(now()) | timestamp_custom("%d.%m.%Y", True) }}'
      luftfeuchtigkeit_kuche_aqara:
        friendly_name: 'Luftfeuchtigkeit Küche'
        unit_of_measurement: '%'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_humidity') | float) | round }}"
        device_class: humidity
      temp_kuche_aqara:
        friendly_name: 'Temp. Küche Aqara'
        unit_of_measurement: '°C'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_temperature') | float) | round(1) }}"
        device_class: temperature
      luftdruck_kuche_aqara:
        friendly_name: 'Luftdruck Küche Aqara'
        unit_of_measurement: 'hPa'
        value_template: "{{ (states('sensor.lumi_lumi_weather_57dc3d03_pressure') | float) | round }}"
        device_class: pressure
      temp_outside_internet:
        friendly_name: "Temperatur außen Internet"
        value_template: "{{ state_attr('weather.lieblingshaus', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      humidity_outside_internet:
        friendly_name: "Luftfeuchtigkeit außen Internet"
        value_template: "{{ state_attr('weather.lieblingshaus', 'humidity') }}"
        unit_of_measurement: '%'
        device_class: humidity

      # --- Stromverbrauch ---
      stromzaehler_netzbezug:
        value_template: "{{ '%.1f'%(states('sensor.stromzahler_positive_active_energy_in_tariff_t1') | float /1000) | float }}"
        friendly_name: 'Stromzähler Netzbezug'
        unit_of_measurement: 'kWh'
        icon_template: mdi:counter

      # --- Elektrische Leistung ---
      # Backofen
      el_leistung_stromzaehler_netzbezug:
        value_template: "{{ states('sensor.stromzahler_sum_active_instantaneous_power') }}"
        friendly_name: 'El. Leistung Stromzähler Netzbezug'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Backofen
      el_leistung_backofen_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_backofen') | float) | float }}"
        friendly_name: 'El. Leistung Backofen (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Kühlschrank Küche
      el_leistung_kuhlschrank_kuche_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_kuhlschrank_kuche') | float) | float }}"
        friendly_name: 'El. Leistung Kühlschrank Küche (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Spülmaschine
      el_leistung_spulmaschine_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_spulmaschine') | float) | float }}"
        friendly_name: 'El. Leistung Spülmaschine (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Mixi
      el_leistung_mixi_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_mixi') | float) | float }}"
        friendly_name: 'El. Leistung Mixi (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # TV
      el_leistung_tv_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_tv') | float) | float }}"
        friendly_name: 'El. Leistung TV (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Waschmaschine
      el_leistung_waschmaschine_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_waschmaschine') | float) | float }}"
        friendly_name: 'El. Leistung Waschmaschine (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Trockner
#      el_leistung_trockner_round:
#        value_template: "{{ '%.1f'%(states('sensor.el_leistung_trockner') | float) | float }}"
#        friendly_name: 'El. Leistung Trockner (gerundet)'
#        unit_of_measurement: 'W'
#        icon_template: mdi:speedometer
      # Kühlschrank Keller
      el_leistung_kuhlschrank_keller_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_kuhlschrank_keller') | float) | float }}"
        friendly_name: 'El. Leistung Kühlschrank Keller (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Gefrierschrank
      el_leistung_gefrierschrank_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_gefrierschrank') | float) | float }}"
        friendly_name: 'El. Leistung Gefrierschrank (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Lüftungsanlage
      el_leistung_luftungsanlage_round:
        value_template: "{{ '%.1f'%(states('sensor.el_leistung_luftungsanlage') | float) | float }}"
        friendly_name: 'El. Leistung Lüftungsanlage (gerundet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      # Licht
      el_leistung_berechnet_zigbee_licht_gaestezimmer:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_ww_decke_gastezimmer_level_on_off', 'brightness') | float / 255 * 5.3)| float }}"
        friendly_name: 'El. Leistung Licht Gästezimmer (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_stehlampe_le:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_tw_stehlampe_lea_level_light_color_on_off', 'brightness') | float / 255 * 5.8)| float }}"
        friendly_name: 'El. Leistung Stehlampe Le (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_stehlampe_la:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_ww_stehlampe_lara_level_on_off', 'brightness') | float / 255 * 5.3)| float }}"
        friendly_name: 'El. Leistung Stehlampe La (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_kugellampe_sz:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e14_tw_kugellampe_schlafzimmer_level_light_color_on_off', 'brightness') | float / 255 * 5.8)| float }}"
        friendly_name: 'El. Leistung Kugellampe SZ (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_ecke_gr:
        value_template: "{{ '%.1f'%(state_attr('light.innr_e27_color_terrasse_ecke_gross_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Ecke groß (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_ecke_kl:
        value_template: "{{ '%.1f'%(state_attr('light.innr_rb_285_c_55f50405_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Ecke klein (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_zigbee_terrasse_feuerstelle:
        value_template: "{{ '%.1f'%(state_attr('light.innr_rb_285_c_7cc30105_level_light_color_on_off', 'brightness') | float / 255 * 9.5)| float }}"
        friendly_name: 'El. Leistung Würfel Terrasse Feuerstelle (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_flur_keller:
        value_template: "{{ is_state('light.flur_keller','on') | float * 75 }}"
        friendly_name: 'El. Leistung Licht Flur Keller (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_technikraum:
        value_template: "{{ is_state('light.technikraum','on') | float * 116 }}"
        friendly_name: 'El. Leistung Licht Technikraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_vorratsraum:
        value_template: "{{ is_state('light.vorratsraum','on') | float * 75 }}"
        friendly_name: 'El. Leistung Licht Vorratsraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_werkelraum:
        value_template: "{{ is_state('light.werkelraum','on') | float * 85 }}"
        friendly_name: 'El. Leistung Licht Werkelraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_licht_partyraum:
        value_template: "{{ is_state('light.lagerraum','on') | float * 65 }}"
        friendly_name: 'El. Leistung Licht Partyraum (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spots_carport:
        value_template: "{{ is_state('light.spots_carport','on') | float * 25 }}"
        friendly_name: 'El. Leistung Spots Carport (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_wandwuerfel_sued:
        value_template: "{{ is_state('light.wandwurfel_suden','on') | float * 21 }}"
        friendly_name: 'El. Leistung Wandwürfel Süd (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_wandwuerfel_west:
        value_template: "{{ is_state('light.wandwurfel_westen','on') | float * 21 }}"
        friendly_name: 'El. Leistung Wandwürfel West (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_abstellraum:
        value_template: "{{ is_state('light.abstellraum_carport','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Abstellraum CP (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_naehtisch_nz:
        value_template: "{{ is_state('light.nahtisch_decke','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Nähtisch Decke(berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_schreibtisch_nz:
        value_template: "{{ is_state('light.schreibtisch_decke','on') | float * 24 }}"
        friendly_name: 'El. Leistung Licht Schreibtisch Decke (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_bad_eg:
        value_template: "{{ is_state('light.spiegel_bad_eg','on') | float * 11.5 }}"
        friendly_name: 'El. Leistung Spiegel Bad EG (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_bad_og:
        value_template: "{{ is_state('light.spiegel_bad_og','on') | float * 11.5 }}"
        friendly_name: 'El. Leistung Spiegel Bad OG (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnet_spiegel_wc:
        value_template: "{{ is_state('light.spiegel_wc','on') | float * 20 }}"
        friendly_name: 'El. Leistung Spiegel WC (berechnet)'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_sicherung_3_2:
        value_template: >-
          {% if states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 8 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * 0.28 }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 15 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (-0.017821) + 0.424589) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 20 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (-0.003710) + 0.169098) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float < 120 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * 0.005517 + 0.090330) }}
          {% else %}
            {{ states('sensor.el_leistung_licht_sicherung_3_2_scheinleistung') | float * 0.8 }}
          {% endif %}
        friendly_name: 'El. Leistung Licht Sicherung 3.2'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_sicherung_3_3:
        value_template: >-
          {% if states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float == 0 %}
            0.0
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 35 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.003962 + 0.053906) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 100 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.003834 + 0.180579) }}
          {% elif states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float < 300 %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * (states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.001312 + 0.406724) }}
          {% else %}
            {{ states('sensor.el_leistung_licht_sicherung_3_3_scheinleistung') | float * 0.8 }}
          {% endif %}
        friendly_name: 'El. Leistung Licht Sicherung 3.3'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_berechnete_lichter:
        value_template: >-
          {{ states('sensor.el_leistung_berechnet_zigbee_licht_gaestezimmer') | float
           + states('sensor.el_leistung_berechnet_zigbee_stehlampe_le') | float
           + states('sensor.el_leistung_berechnet_zigbee_stehlampe_la') | float
           + states('sensor.el_leistung_berechnet_zigbee_kugellampe_sz') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_ecke_gr') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_ecke_kl') | float
           + states('sensor.el_leistung_berechnet_zigbee_terrasse_feuerstelle') | float
           + states('sensor.el_leistung_berechnet_licht_flur_keller') | float
           + states('sensor.el_leistung_berechnet_licht_technikraum') | float
           + states('sensor.el_leistung_berechnet_licht_vorratsraum') | float
           + states('sensor.el_leistung_berechnet_licht_werkelraum') | float
           + states('sensor.el_leistung_berechnet_licht_partyraum') | float
           + states('sensor.el_leistung_berechnet_spots_carport') | float
           + states('sensor.el_leistung_berechnet_wandwuerfel_sued') | float
           + states('sensor.el_leistung_berechnet_wandwuerfel_west') | float
           + states('sensor.el_leistung_berechnet_abstellraum') | float
           + states('sensor.el_leistung_berechnet_naehtisch_nz') | float
           + states('sensor.el_leistung_berechnet_schreibtisch_nz') | float
           + states('sensor.el_leistung_berechnet_spiegel_bad_eg') | float
           + states('sensor.el_leistung_berechnet_spiegel_bad_og') | float
           + states('sensor.el_leistung_berechnet_spiegel_wc') | float }}
        friendly_name: 'El. Leistung berechnete Lichter'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_licht_gesamt:
        value_template: >-
          {{ '%.1f'%(states('sensor.el_leistung_berechnete_lichter') | float 
           + states('sensor.el_leistung_licht_sicherung_3_2') | float
           + states('sensor.el_leistung_licht_sicherung_3_3') | float
           + states('sensor.shellydimmer_d472fe_power') | float) | float }}
        friendly_name: 'El. Leistung Licht gesamt'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_trockner:
        value_template: >-
          {% if states('sensor.el_leistung_trockner_scheinleistung') | float < 6 %}
            0.0
          {% elif states('sensor.el_leistung_trockner_scheinleistung') | float < 9 %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * (states('sensor.el_leistung_trockner_scheinleistung') | float * (-0.008991) + 0.072442)) }}
          {% elif states('sensor.el_leistung_trockner_scheinleistung') | float < 10 %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * 0.15) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_trockner_scheinleistung') | float * 1) }}
          {% endif %}
        friendly_name: 'El. Leistung Trockner'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_tv:
        value_template: >-
          {% if states('sensor.el_leistung_tv_scheinleistung') | float < 6 %}
            0.0
#          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 9 %}
#            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * (states('sensor.el_leistung_tv_scheinleistung') | float * (-0.008991) + 0.072442)) }}
#          {% elif states('sensor.el_leistung_tv_scheinleistung') | float < 10 %}
#            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 0.15) }}
          {% else %}
            {{ '%.1f'%(states('sensor.el_leistung_tv_scheinleistung') | float * 1) }}
          {% endif %}
        friendly_name: 'El. Leistung Trockner'
        unit_of_measurement: 'W'
        icon_template: mdi:speedometer
      el_leistung_bildschirm_theke:
        friendly_name: "El. Leistung Bildschirm Theke"
        value_template: >-
          {% if is_state('binary_sensor.anwesenheit_bildschirm', 'on') %}
            10
          {% else %}
            6
          {% endif %}
      # max Stellwert Heizkreise Zeitverlauf
      stellwert_heizung_zeitverlauf_max:
        friendly_name: "Stellwert Heizung Zeitverlauf Max"
        value_template: "{{ state_attr('sensor.stellwert_heizung_zeitverlauf_mean', 'max_value') }}"
        unit_of_measurement: '%'
      # Heizung
      heating_room_target_temp:
        friendly_name: "Heizung Zieltemperatur Raum"
        value_template: "{{ state_attr('climate.hc1', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      # Warmwasser
      water_heater_target_temp:
        friendly_name: "Warmwasser Zieltemperatur"
        value_template: "{{ state_attr('water_heater.dhw1', 'temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature
      water_heater_current_temp:
        friendly_name: "Warmwasser aktuelle Temperatur"
        value_template: "{{ state_attr('water_heater.dhw1', 'current_temperature') }}"
        unit_of_measurement: '°C'
        device_class: temperature

# MQTT without mqtt-discovery
# Sonoff POW R2 1
  - platform: mqtt
    name: "Sonoff POW R2 1 Scheinleistung"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Sonoff POW R2 1 Wirkleistung"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Sonoff POW R2 1 Leistungsfaktor"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Sonoff POW R2 1 Energie"
    state_topic: "tele/tasmota_pow_r2_1/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Sonoff POW R2 2
  - platform: mqtt
    name: "Sonoff POW R2 2 Scheinleistung"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Sonoff POW R2 2 Wirkleistung"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Sonoff POW R2 2 Leistungsfaktor"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Sonoff POW R2 2 Energie"
    state_topic: "tele/tasmota_pow_r2_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Tasmota SD 2
  - platform: mqtt
    name: "Tasmota SD 2 Scheinleistung"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Tasmota SD 2 Wirkleistung"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Tasmota SD 2 Leistungsfaktor"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: "None"
  - platform: mqtt
    name: "Tasmota SD 2 Energie"
    state_topic: "tele/tasmota_sd_2/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Tasmota SD 3
  - platform: mqtt
    name: "Tasmota SD 3 Scheinleistung"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["ApparentPower"] }}'
    unit_of_measurement: "VA"
  - platform: mqtt
    name: "Tasmota SD 3 Wirkleistung"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Power"] }}'
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Tasmota SD 3 Leistungsfaktor"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Factor"] }}'
    unit_of_measurement: " "
  - platform: mqtt
    name: "Tasmota SD 3 Energie"
    state_topic: "tele/tasmota_sd_3/SENSOR"
    value_template: '{{ value_json["ENERGY"]["Total"] }}'
    unit_of_measurement: "kWh"
# Wemos D1 1 - DHT21 Partyraum
  - platform: mqtt
    name: "DHT21 Partyraum Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_1/SENSOR"
    value_template: '{{ value_json["AM2301"]["Humidity"] }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "DHT21 Partyraum Temperatur"
    state_topic: "tele/tasmota_wemos_d1_1/SENSOR"
    value_template: '{{ value_json["AM2301"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "DHT21 Partyraum Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_1/SENSOR"
    value_template: '{{ value_json["AM2301"]["DewPoint"] }}'
    unit_of_measurement: "°C"
# Wemos D1 2 - DHT21 Werkelraum
  - platform: mqtt
    name: "DHT21 Werkelraum Luftfeuchtigkeit"
    state_topic: "tele/tasmota_wemos_d1_2/SENSOR"
    value_template: '{{ value_json["AM2301"]["Humidity"] }}'
    unit_of_measurement: "%"
  - platform: mqtt
    name: "DHT21 Werkelraum Temperatur"
    state_topic: "tele/tasmota_wemos_d1_2/SENSOR"
    value_template: '{{ value_json["AM2301"]["Temperature"] }}'
    unit_of_measurement: "°C"
  - platform: mqtt
    name: "DHT21 Werkelraum Taupunkt"
    state_topic: "tele/tasmota_wemos_d1_2/SENSOR"
    value_template: '{{ value_json["AM2301"]["DewPoint"] }}'
    unit_of_measurement: "°C"
    
# --- Sonstiges ---
# History
  - platform: history_stats
    name: Jo at work
    entity_id: binary_sensor.jo_at_work
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
  - platform: history_stats
    name: Anteil La wach letzte Stunde
    entity_id: switch.la_schlaft
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil Le wach letzte Stunde
    entity_id: switch.le_schlaft
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil MaJo wach letzte Stunde
    entity_id: switch.majo_schlafen
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1
  - platform: history_stats
    name: Anteil Kinder wach letzte Stunde
    entity_id: binary_sensor.la_oder_le_schlafen
    state: 'off'
    type: ratio
    end: '{{ now() }}'
    duration:
      hours: 1

# Max. Stellung Heizkreisventile
  - platform: min_max
    type: max
    name: Stellwert Heizung aktueller MaxWert
    entity_ids:
      - sensor.stellwert_heizung_bad_eg
      - sensor.stellwert_heizung_bad_og
      - sensor.stellwert_heizung_esszimmer
      - sensor.stellwert_heizung_flur_og
      - sensor.stellwert_heizung_gastezimmer
      - sensor.stellwert_heizung_kuche
      - sensor.stellwert_heizung_la
      - sensor.stellwert_heizung_le
      - sensor.stellwert_heizung_nahzimmer
      - sensor.stellwert_heizung_schlafzimmer
      - sensor.stellwert_heizung_windfang_wc
      - sensor.stellwert_heizung_wohnzimmer
  - platform: statistics
    name: Stellwert Heizung Zeitverlauf Mean
    entity_id: sensor.stellwert_heizung_aktueller_maxwert
    sampling_size: 2000
    max_age:
      minutes: 30

# Zeit und Datum
  - platform: time_date
    display_options:
      - 'time'
      - 'date'

# Stromzaehler
  - platform: edl21
    name: Stromzähler
    serial_port: /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_AR0JH225-if00-port0

# Bank
  - platform: fints
    bank_identification_number: !secret bank_blz
    username: !secret bank_username
    pin: !secret bank_pin
    url: !secret bank_url

# System 
  - platform: systemmonitor
    resources:
      - type: processor_use
      - type: disk_use_percent
        arg: "/"
      - type: last_boot
      - type: memory_use_percent
  - platform: command_line
    name: CPU Temperatur
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "°C"
    value_template: '{{ value | multiply(0.001) | round(1) }}'
